<!DOCTYPE  HTML>
<html lang="en">
	<head>
		<title>用户管理</title>
		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3" />
		<meta http-equiv="description" content="this is my page" />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<link rel="stylesheet" href="../../../css/bootstrap.min.css" type="text/css"></link>
		<link rel="stylesheet" href="../../../css/bootstrap-responsive.min.css"type="text/css"></link>
		<link rel="stylesheet" href="../../../js/dataTables/css/jquery.dataTables.css" type="text/css"></link>
		<!-- bootstrap 与 datatable结合 -->
		<link rel="stylesheet" href="../../../js/dataTables/css/DT_bootstrap.css"	type="text/css"></link>
		<!-- 工具 -->
		<link rel="stylesheet" href="../../../js/dataTables/css/dataTables.tableTools.min.css" type="text/css"></link>
		<!-- 动态列CSS -->
		<link rel="stylesheet" href="../../../demo/unicorn.main.css" type="text/css"></link>
		<link rel="stylesheet" href="../../../js/dataTables/css/font-awesome.css"></link>
		<link rel="stylesheet" href="../../../js/dataTables/css/dataTables.colVis.min.css" type="text/css"></link>
		<script type="text/javascript" src="../../../js/jquery.js"></script>
		<script type="text/javascript" src="../../../js/bootstrap.js"></script>
		<script type="text/javascript" src="../../../js/dataTables/js/jquery.dataTables.js"></script>
		<script type="text/javascript" src="../../../js/dataTables/js/dataTables.colReorder.js"></script>
		<script type="text/javascript" src="../../../js/dataTables/js/dataTables.colVis.js"></script>
		<script type="text/javascript" src="../../../js/dataTables/js/dataTables.tableTools.min.js"></script>
		<script type="text/javascript" src="../../../js/dataTables/js/DT_bootstrap.js"></script>
		<script type="text/javascript" src="../../../js/common_utils.js"></script>
		<script type="text/javascript" src="../../../js/appCommonUtil.js"></script>
		<script type="text/javascript" src="../../../js/appCommonCurdUtils.js"></script>
		<script type="text/javascript" src="../../../js/common_validation.js"></script>
		<script type="text/javascript" src="userInfo.js"></script>
<style type="text/css">
#test tr td:first-child {
	text-align: center;
}

/* fa-square-o */
#test tr td:first-child:before {
	content: "\f096";
	font-family: FontAwesome;
}

#test tr.active td:first-child:before {
	content: "\f046"; /* fa-check-square-o */
}

.dataTables_scrollBody {
	overflow-x: auto !important;
}

.container {
	margin: 0;
	padding: 0;
	width: 1280px;
}

dl {
	margin: 0;
	margin-left: -15px;
	font-size: 12px;
}
dl dt {
	line-height: 30px;
}
</style>

	</head>
	<body style="overflow: auto;">
		<!-- 头 -->
		<div class="widget-box collapsible">
			<div class="widget-title" style="height: 40px; line-height: 40px; overflow: hidden;" id="t">
				<span class="icon" style="float: left; padding: 0px 10px;"> <i
					class="icon-search"></i> </span>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
				<input id="shaixuan" name="shaixuan" type="text" maxlength="500"
					class="input-medium search-query" value="" />
				&nbsp;&nbsp;&nbsp;
				<!-- <button id="btn_suSecurityUser_sousuo" type="button" class="btn" onclick="tableSearch();">
					<i class="icon-search"></i> 搜 索
				</button> -->
				&nbsp;&nbsp;&nbsp;每页显示条数：
				<select name="pageSize" id="pageSize"
					style="width: 80px; margin-bottom: 0px;"
					onchange="setPageNum(this)">
					<option selected="selected" value="10">
						10
					</option>
					<option value="30">
						30
					</option>
					<option value="50">
						50
					</option>
					<option value="100">
						100
					</option>
					<option value="-1">
						全部
					</option>
				</select>
				<div id="cols"></div>
			</div>
		</div>
		<!-- class 或 = display -->
		<table width="100%" class="table table-striped table-bordered"
				id="test" cellspacing="0"></table>
		<!-- 头 -->
		<div class="widget-box collapsible">
			<div class="widget-title"
				style="height: 40px; line-height: 40px; overflow: hidden;">
				<span class="icon" style="float: left; padding: 0px 10px;">
					<i class="icon-cog"></i>
				</span>&nbsp;&nbsp;&nbsp;
				<a id="btn_suSecurityUser_tianjiayonghu" class="btn" onclick="openAddForm()"><i class="icon-plus"></i>添加用户</a>
				<button id="btn_suSecurityUser_shanchuyonghu" type="button" class="btn" onclick="fnGetSelected()">
					<i class="icon-remove"></i>删除用户
				</button>
				<button id="btn_suSecurityUser_shuaxin" type="button" class="btn" onclick="refresh()">
					<i class="icon-refresh"></i>刷新
				</button>
				<span id="showInfo" class="hide">
					<button id="btn_suSecurityUser_xiugai" type="button" class="btn" onclick="doUpdateOrSubmit()" style="width: 120px;">
						<i class="icon-pencil"></i>修改
					</button>
				</span>
				<span id="addInfo" class="hide">
					<button id="btn_suSecurityUser_baocun" type="button" class="btn" onclick="doUpdateOrSubmit()">
						<i class="icon-ok"></i>保存
					</button>
					<button id="btn_suSecurityUser_chongzhi" type="reset" class="btn" onclick="clearForm('updateForm');">
						<i class="icon-repeat"></i>重置
					</button>
				</span>
				<button id="btn_suSecurityUser_huidaodingbu" type="button" class="btn"
					onclick="shou()">
					<i class="icon-eject"></i>回到顶部
				</button>
			</div>
		</div>
		<div id="update">
			<form id="updateForm">
				<div class="container">
					<div style="text-align: center;">
						<input type="hidden" id="id" name="id" />
						<h4>
							<span id="addUser" class="hide">添加</span><span id="showUser" class="hide">查看(修改)</span>用户信息
						</h4>
						<hr>
					</div>
					<dl class="dl-horizontal pull-left">
						<dt>
							登录名称:
						</dt>
						<dd>
							<div id="chkLoginName" class="control-group" style="padding: 0;margin: 0;"> 
							<input type="text" id="loginName" name="loginName"> 
							</div>
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left">
						<dt>
							用户姓名:
						</dt>
						<dd>
							<div id="chkName" class="control-group" style="padding: 0;margin: 0;"> 
							<input type="text" id="name" name="name" class="error"> </div>
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left">
						<dt>
							工号:
						</dt>
						<dd>
							<input type="text" id="job_number" name="job_number">
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left">
						<dt>
							分机号:
						</dt>
						<dd>
							<div id="chkPhone" class="control-group" style="padding: 0;margin: 0;"> 
							<input type="text" id="phone_number" name="phone_number"> </div>
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left hide" id="addInfo">
						<dt>
							密码:
						</dt>
						<dd>
							<div id="chkPwd" class="control-group" style="padding: 0;margin: 0;"> 
							<input type="password" id="pwd" name="pwd"> </div>
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left">
						<dt>
							坐席号:
						</dt>
						<dd>
							<input type="text" id="seat_number" name="seat_number">
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left">
						<dt>
							排序字段:
						</dt>
						<dd>
							<input type="text" id="viewIndex" name="viewIndex">
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left hide" id="showInfo">
						<dt>
							用户当前状态:
						</dt>
						<dd>
							<input type="text" id="startus" name="startus" readonly>
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left hide" id="showInfo">
						<dt>
							所属组织:
						</dt>
						<dd>
							<div class="input-append">
								<input type="text" class="input-medium" id="orgs" name="orgs" readonly>
								<span id="btn_suSecurityUser_xiugai"><input type="button" class="btn" onclick="addOrgForUser()" value="修改"></span>
							</div>
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left hide" id="addInfo">
						<dt>
							添加组织:
						</dt>
						<dd>
							<div class="input-append">
								<input type="text" id="companyTextList" name="companyTextList" class="input-medium" readonly>
								<span id="btn_suSecurityUser_xuanze"><input type="button" class="btn" onclick="addOrg()" value="选择"></span>
							</div>
							<input type="hidden" id="companyCodeList">
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left hide" id="showInfo">
						<dt>
							拥有角色:
						</dt>
						<dd>
							<div class="input-append">
								<input type="text" class="input-medium" id="roles" name="roles" readonly>
								<span id="btn_suSecurityUser_xiugai"><input type="button" class="btn" onclick="addRoleForUser()" value="修改"></span>
							</div>
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left hide" id="addInfo">
						<dt>
							添加角色:
						</dt>
						<dd>
							<div class="input-append">
								<input type="text" id="roleNameList" name="roleNameList" class="input-medium" readonly>
								<span id="btn_suSecurityUser_xuanze"><input type="button" class="btn" onclick="addRole()" value="选择"></span>
							</div>
							<input type="hidden" id="roleIdList">
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left hide" id="showInfo">
						<dt>
							用户建立时间:
						</dt>
						<dd>
							<input type="text" id="createDate" name="createDate" readonly>
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left hide" id="showInfo">
						<dt>
							用户最后登录时间:
						</dt>
						<dd>
							<input type="text" id="lastLoginDate" name="lastLoginDate" readonly>
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left hide" id="showInfo">
						<dt>
							最后修改密码时间:
						</dt>
						<dd>
							<input type="text" id="lastModifyPassword" name="lastModifyPassword" readonly>
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left">
						<dt>
							附加信息:
						</dt>
						<dd>
							<textarea id="agent_information" name="agent_information"
								style="width: 206px; height: 68px;"></textarea>
						</dd>
					</dl>
					<dl class="dl-horizontal pull-left">
						<dt>
							等级:
						</dt>
						<dd>
							<input type="text" id="agent_level" name="agent_level">
						</dd>
					</dl>
				</div>
			</form>
		</div>
		<script type="text/javascript">
var updateFromData;
var closeDialog;
$(document).ready(function() {
  clearForm('updateForm');
  var data = doSearch();
  $('#test').dataTable({	
  		bProcessing : true, //是否启用正在加载中...
		bPaginate: true, //翻页功能
		bLengthChange: false, //改变每页显示数据数量
		bFilter: true, //过滤功能
		bSort: true, //排序功能
		bInfo: true,//页脚信息
		bAutoWidth: false, //自动宽度
		sPaginationType: "bootstrap",//分页样式
		//数据赋值
		data:data,
	    //dom: 'Rlfrtip',
	    dom: 'RlrtipT',
	    "aaSorting":[[2,'asc']],
		//"sScrollX": "100%",
		//"sScrollXInner": "100%",
		"bScrollCollapse": true,
	    //dom: 'T<"clear">lfrtip',
	    //自定义列插件
       // colVis: {
       //    order: 'alpha',
       //    buttonText: "自定义显示列"
       // },
        order: [ 1, 'desc' ],
		columns: [
		 /*{ "title": 
		   "<input type='checkbox' id='selectall' onclick='toggleChecks(this);' ></input>",
		    "mDataProp": null, 
		    "sWidth": "20px", 
		    "sDefaultContent": "<input type='checkbox' class='case' onChange='setSelect()' ></input>",
		     "bSortable": false 
	
		     },*/
			{ title:"<input type='checkbox' id='selectall' onclick='toggleChecks(this);'>",data: null, defaultContent: '', orderable: false,width:15},
			{ 
			  title:"id" ,
			  data: 'id',
			  visible: false,
			  searchable: true
			},
			/**title 表头  data json 对应key **/
			{"title": "工号",data: 'job_number',visible: false},
	        {"title":"登录名称" ,data: 'loginName',className: "my_class"},
	        {"title":"用户姓名",data:'name'},
	        {"title": "用户当前状态",data: 'startus',visible: false},
	        {"title": "分机号",data: 'phone_number'},
	        {"title": "坐席号",data: 'seat_number'},
	        {"title": "所属组织",data:'orgs'},
	        {"title": "拥有角色",data:'roles'},
	        {"title": "等级",data: 'agent_level'},
	        {"title": "附加信息",data: 'agent_information',visible: false},
	        {"title": "排序字段",data: 'viewIndex',visible: false},
	        {"title":"用户建立时间",data:'createDate',visible: false},
	        {"title": "用户最后登录时间",data: 'lastLoginDate',visible: false},
	        {"title": "最后修改密码的时间",data: 'lastModifyPassword',visible: false}
        ],
        oLanguage: {
			"sLengthMenu": "每页显示 _MENU_条",
			"sZeroRecords": "没有找到符合条件的数据",
			"sProcessing": "&lt;imgsrc=’./loading.gif’ /&gt;",
			"sInfo": "当前第 _START_ - _END_ 条　共计 _TOTAL_ 条",
			"sInfoEmpty": "木有记录",
			"sInfoFiltered": "(从 _MAX_ 条记录中过滤)",
			"sSearch": "搜索：",
			"oPaginate": {
			"sFirst": "首页",
			"sPrevious": "前一页",
			"sNext": "后一页",
			"sLast": "尾页"
		    }
        }, tableTools: {
          //single 单选 multi 多选  os 可以按ctrl 选择
            sRowSelect:'os',
           //回调 单选
            fnRowSelected: function ( nodes ) {
               var index=nodes[0]._DT_RowIndex;	
               var data = table.row(index).data();
               updateFromData='';
			   updateFromData=data;
			   $('#test tbody tr').dblclick('click',function(e){
					scroll2data("updateForm");
				});
               //$("#update").slideDown(200);
               initForm(data);
               //scroll2data("updateForm");
               //alert(JSON.stringify(data));
            },
             //sRowSelect:'multi',
            //sRowSelector:'td:first-child',
            aButtons:     [ /*{
                "sExtends":    "select_all",
                "sButtonText": "选择全部",
                "target":      "#select"
              } , 'select_none' */]
        }
    }); 
     //绑定事件 on
     var table=$('#test').DataTable();
	 /*$('#test tbody').on( 'click', 'button', function (obj) {
	    var data = table.row( $(this).parents('tr') ).data();
        //alert(JSON.stringify(data));
	} );*/
   /*$('#test tbody tr').dblclick('click',function(e){
		scroll2data("updateForm");
	});*/
	 
	
    //工具栏与bootstarp 结合
   // var tt = new $.fn.dataTable.TableTools(table);
  //  $(tt.fnContainer()).insertBefore('#tools');
    
  //筛选绑定
   $('#shaixuan').on( 'keyup', function () {
       table.search( this.value ).draw();
    });
    //自定义列插件绑定
       
     var colvis = new $.fn.dataTable.ColVis(table,{ buttonText: '自定义显示列',exclude: [ 0 ,1] });
     $( colvis.button()).insertBefore('#cols');  
});

//获取选中行
function fnGetSelected(){
    //注意DataTable大写 或者 $('#test').dataTable().api();
     var table=$('#test').DataTable();
 //   var data =table.column().data();
    //获取选中行 通过dataTable查找
     var cell=table.rows(".active").data();
    //通过table TableTools插件 查找
     var tt = new $.fn.dataTable.TableTools(table);
     var selectData=tt.fnGetSelectedData();
     if(selectData.length==0){
     	//$.alert("提示","请选择要删除的数据");
     	zinglabs.i18n.alert("system_selectDataForDelete");
     }else{
     	zinglabs.confirm(zinglabs.i18n.getText("system_deleteConfirmation"),function(){
     		doDelete(selectData);
     	});
     }
    //alert( JSON.stringify(selectData) );
    console.log( JSON.stringify(selectData));
}
//全选
function toggleChecks(obj){
       var table=$('#test').DataTable();
       var tableTools = new $.fn.dataTable.TableTools(table);
       var ischeck=$("#selectall").is(':checked');
       if(ischeck){
         tableTools.fnSelectAll();
       }else{
         tableTools.fnSelectNone();
       }
}
//每页显示条数
function setPageNum(obj){
  var table=$('#test').DataTable();
  table.page.len(obj.value).draw();
  //alert(obj.value);
}    
function initForm(data){
				removeHide("#showInfo,#showUser");
   	  			addHide("#addInfo,#addUser");
				hideTooltip("chkLoginName,#chkName,#chkPhone,#chkPwd,#chkRpdw");
				var cfs=$("#updateForm input[name],textarea[name]");
				for(var i=0;i<cfs.length;i++){
					var e=cfs[i];					
					var v=data[e.name];
					if(v==undefined || v==null){
						v='';
					}
					$(e).val(v);
				}
}
function openAddForm(){
   	  clearForm('updateForm');
   	  removeHide("#addInfo,#addUser");
   	  addHide("#showInfo,#showUser");
	  scroll2data("updateForm");
}
//刷新
function refresh(){
	 addHide("#showInfo,#addInfo,#showUser,#addUser");
	 clearForm('updateForm');
	 var table=$('#test').DataTable();
     //清空筛选
     table.columns().search("").draw();
	 clearForm("searchWorkOrderForm");
     //清空数据
     table.clear().draw();
     //重新加载数据
     var data=doSearch(); 
     table.rows.add(data).draw(true);
     shou();
}

//清空表单
function clearForm(formName){
  var cfs=$("#"+formName+" input[name],#"+formName+" select[name] ");
  cfs.val('');
  $("#"+formName+" textarea").val('');
  hideTooltip("chkLoginName,#chkName,#chkPhone,#chkPwd,#chkRpdw");
}
    </script>
	</body>
</html>
