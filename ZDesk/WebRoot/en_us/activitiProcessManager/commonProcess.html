<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<title>commonProcess.html</title>

		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
		<meta http-equiv="description" content="this is my page">
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" href="../../css/bootstrap.min.css"
			type="text/css"></link>
		<link rel="stylesheet"
			href="../../js/dataTables/css/jquery.dataTables.css" type="text/css"></link>
		<!-- bootstrap 与 datatable结合 -->
		<link rel="stylesheet" href="../../js/dataTables/css/DT_bootstrap.css"
			type="text/css"></link>
		<!-- 工具 -->
		<link rel="stylesheet"
			href="../../js/dataTables/css/dataTables.tableTools.min.css"
			type="text/css"></link>
		<!-- 动态列CSS -->
		<link rel="stylesheet" href="../../js/dataTables/css/font-awesome.css"></link>
		<link rel="stylesheet"
			href="../../js/dataTables/css/dataTables.colVis.min.css"
			type="text/css"></link>
	</head>

	<body>
		<div style="width: 1105px; margin-left: 3px; padding: 2px"
			cellspacing="0">
			<div class="widget-box collapsible" style="width: 1100px;">
				<div class="widget-title" style="height: 40px;">
					<span class="icon"><i class="icon-search"></i> </span>
					<div id="cols"></div>
					<div style="padding-top: 5px; margin-left: 45px">
						<button type="button" id="btn_add" class="btn"
							onclick="doRepeat();">
							<i class="icon-repeat"></i> 刷 新
						</button>  
					</div>
				</div>
			</div>
			<div style="width: 1100px; margin-left: 2px; padding-right: 2px">
				<table style="overflow-x: hidden"
					class="table table-striped table-bordered " id="activitibody"
					cellspacing="0"></table>
			</div>
		</div>
		<div id="iframePage" style="min-height: 260px; display: none" height="">
			<iframe scrolling="no" frameborder="0" src=""
				style="border: 0; width: 1270px; height: 260px!important;"
				class="hide"></iframe>
		</div>
		
<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/bootstrap.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/jquery.dataTables.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.colReorder.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.colVis.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.tableTools.min.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/DT_bootstrap.js"></script>
		<script type="text/javascript" src="../../js/common_utils.js"></script>
		<script type="text/javascript" src="../../js/appCommonUtil.js"></script>
		<script type="text/javascript" src="../../js/golbal_params.js"></script>
		<script type="text/javascript" src="../../js/common_validation.js"></script>
		<script type="text/javascript"
			src="../activitiModelsManager/activiti.js"></script>
		<!--<link rel="stylesheet" type="text/css" href="./styles.css">-->
		<script>
var dataGrid = {} ;  //datatable 初始化参数
var getActivitiTasksUrl = "/ZDesk/activitiManager/activityCommon/getTasks.action";  //获取流程数据action路径
var PROCESSDEFINTION_ID = "" ;  //流程标识
var activitiParameterAndData ;  //流程配置和获取来的流程数据
dataGrid ={
	'bPaginate':true,//分页器
	'bLengthChange': false,
	'bStateSave':true, //保留状态
	'bSort':true,//按列排序
	'bInfo':true,//页脚信息
	'bAutoWidth':false, //自动宽度
//	'sScrollX':'1600',//垂直滚动条,滚动区域
	"scrollY": "400px",
//  "scrollCollapse": "true",
	'sPaginationType': 'bootstrap',//分页样式
	'dom': 'TRlrtip',
	'data':'',
	"oLanguage": {
  		"sSearch": "搜索:",
  		"sLengthMenu": "每页显示 _MENU_ 条记录",
 		"sZeroRecords": "Nothing found - 没有记录",
  		"sInfo": "显示第  _START_ 条到第  _END_ 条记录,一共  _TOTAL_ 条记录",
  		"sInfoEmpty": "显示0条记录",
  		"scrollY": false,
  		"scrollX": false,
  		"scrollCollapse": false,
  		"oPaginate": {
  			"sFirst": "首页",
   			"sPrevious": " 上一页 ",
   			"sNext":     " 下一页 ",
   			"sLast": "尾页"
   		}
  	}, tableTools: {
       	//single 单选 multi 多选  os 可以按ctrl 选择
       	// sRowSelect:'multi',
        //回调 单选
    	fnRowSelected: function ( nodes ) {
    		var index=nodes[0]._DT_RowIndex;	
			var data = $('#activitibody').DataTable().row(index).data();
//			window.top.activitiCommonRowIndex = data.length;
			window.top.activitiCommonRowData = data;
      		openForm();
        //alert(JSON.stringify(data));
        },
    sRowSelect:'os',
    //sRowSelector:'td:first-child',
    aButtons:     [ /*{
      "sExtends":    "select_all",
      "sButtonText": "选择全部",
      "target":      "#select"
    } , 'select_none' */]
	}
}
$(document).ready(function(){
	PROCESSDEFINTION_ID=getQueryString("PROCESSDEFINTION_ID");
	initTable();
});

function initTable(){
	activitiParameterAndData=getNoSignOfObtainingData();
	dataGrid.columns = eval(activitiParameterAndData.clumns);
	$('#activitibody').dataTable(dataGrid);
	var table= $('#activitibody').DataTable();
	table.page.len('10').draw();
	$('#activitibody tbody').on( 'click', 'button', function (obj) {
		var data = table.row( $(this).parents('tr') ).data();
	});
	var colvis = new $.fn.dataTable.ColVis(table,{ buttonText: '自定义显示列',exclude: [ 0 ,-1] });
    $( colvis.button()).insertBefore('#cols');   
    
    drawTable(activitiParameterAndData.taskData);
}

/**获取通用列表配置和待办数据**/
function getNoSignOfObtainingData(){
	var param = {};
	var retData = {};
	param.processDefinitionId =PROCESSDEFINTION_ID;
	var height = getQueryString("height");
	if(height==""||height==undefined||height==null){
		height = 200;
	}
	$("#activitiFormPage").attr("height",height);
	putLoginNameToParam(param);
	ajaxFunction(getActivitiTasksUrl,param,false,function(data){
		if(data.data){
			retData = data.data;
 		}
	});
	return retData;
}

function drawTable(data){
	var table=$('#activitibody').DataTable();
	table.search("").draw();
	table.clear().draw();
	table.rows.add(data).draw(true);	
}

/**刷新**/

function doRepeat(){
	var table=$('#activitibody').DataTable();
	var repeatData=getNoSignOfObtainingData();
	drawTable(repeatData.taskData);
}

/**打开工单页面**/
function openForm(){

	try {
		var url = activitiParameterAndData.path+"?&PROCESSDEFINTION_ID="+PROCESSDEFINTION_ID+"&TYPE=commonProcess";
		$("#iframePage").show();
		$('#iframePage iframe').attr('src',url).removeClass('hide');
	} catch (e) {
		alert('未选择数据');
	};
}
</script>
	</body>
</html>
