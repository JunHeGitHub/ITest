<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>修改角色下用户</title>

		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3" />
		<meta http-equiv="description" content="this is my page" />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=9;IE=8;IE=EDGE" />
		<link rel="stylesheet" href="../../../css/bootstrap.min.css" type="text/css"></link>
		<link rel="stylesheet" href="../../../css/bootstrap-responsive.min.css" type="text/css"></link>
		<style type="text/css">
			#select1 option {
				border-bottom-style: double;
				border-bottom-color: blue;
			}
			
			.btn {
				width: 50px;
				height: 30px;
				margin-top: 10px;
				cursor: pointer;
			}
		</style>
	</head>
	<body>
		<br />
		<br />
		<table width="700" align="center" border="0" cellpadding="0"
			cellspacing="0" class="newContTab">
			<tr>
				<th>
				</th>
				<td>
					<div>
						<div>
							<select multiple="multiple" id="select1"
								style="width: 300px; height: 200px; float: left;">
							</select>
						</div>
						<div style="float: left">
							<br />
							<br />
							<br />
							<span id="add"> <input type="button" class="btn"
									value="》》" /> </span>
							<br />
							<span id="remove"> <input type="button" class="btn"
									value="《《" /> </span>
							<br />
						</div>
						<div>
							<select multiple="multiple" name="s" id="select2"
								style="width: 300px; height: 200px; float: left;">
							</select>
						</div>
					</div>
				</td>
			</tr>
			<tr>
				<th>
				</th>
				<td>
					<div>
						<div>
							<span style="width: 300px; height: 30px; float: left;"> </span>
						</div>
						<div style="float: left">
							<span>
								<button type="button" class="btn btn-default"
									style="width: 70px" data-toggle="modal" onclick="doSave()"
									id="tijiao">
									提交
								</button> </span>
						</div>
						<div>
							<span style="width: 300px; height: 30px; float: left;"> </span>
						</div>
					</div>
				</td>
			</tr>
		</table>
		<script type="text/javascript" src="../../../js/jquery.js"></script>
		<script type="text/javascript" src="../../../js/bootstrap.js"></script>
		<script type="text/javascript" src="../../../js/common_utils.js"></script>
		<script type="text/javascript" src="../../../js/appCommonCurdUtils.js"></script>
		<script type="text/javascript" src="../../../js/appCommonUtil.js"></script>
		<script type="text/javascript">
			var data_getUserByRoleId;
			var roleId;
			var pwin = window.parent;
			var ZKM = "ZKM";
			var path = "/" + window.top.PRJ_PATH + "/" +ZKM+ "/UserInfo" + "/";
			//下拉框交换JQuery
			$(document).ready(function(){
			     var data_all=doSearch();
			     var select1 = $("#select1"); 
			      select1.empty();//清空select下拉框
			    for(var i=0;i<data_all.length;i++){
			        $("<option value='" + data_all[i].loginName + "'>" + data_all[i].loginName + "</option>").appendTo(select1)//动态添加Option子项
			    }
			     data_getUserByRoleId=doSearch_getUserByRoleId();
			     var select2 = $("#select2"); 
			      select2.empty();//清空select下拉框
			
			    for(var i=0;i<data_getUserByRoleId.length;i++){
			        $("<option value='" + data_getUserByRoleId[i].loginName + "'>" + data_getUserByRoleId[i].loginName + "</option>").appendTo(select2)//动态添加Option子项
			    }
			       
			    //移到右边
			    $('#add').click(function() {
			      //获取选中的选项，删除并追加给对方
			        var array = new Array(); //定义数组
			        $("#select2 option").each(function(){ //遍历全部option
			        	var txt = $(this).val(); //获取option的内容
			            array.push(txt); //添加到数组中
			        });
			       var sid=$('#select1 option:selected').val();
			       if($.inArray(sid, array)==-1){
			          $('#select1 option:selected').appendTo('#select2');
			       }
			        
			    });
			    //删除
			    $('#remove').click(function() {
			        var array = new Array(); //定义数组
			        $("#select1 option").each(function(){ //遍历全部option
			        	var txt = $(this).val(); //获取option的内容
			            array.push(txt); //添加到数组中
			        });	
			       var sid= $('#select2 option:selected').val();
			       if($.inArray(sid,array)==-1){
			       	$('#select2 option:selected').appendTo('#select1');
			       }else{
			       	$('#select2 option:selected').remove();
			       }
			    });
			    $('#select1').dblclick(function(){ //绑定双击事件
			        //获取全部的选项,删除并追加给对方
			        $("option:selected",this).appendTo('#select2'); //追加给对方
			    });
			    /**
			    //全部移到右边
			    $('#add_all').click(function() {
			        //获取全部的选项,删除并追加给对方
			        $('#select1 option').appendTo('#select2');
			    });
			    //全部移到左边
			    $('#remove_all').click(function() {
			        $('#select2 option').appendTo('#select1');
			    });
			    //双击选项
			    $('#select1').dblclick(function(){ //绑定双击事件
			        //获取全部的选项,删除并追加给对方
			        $("option:selected",this).appendTo('#select2'); //追加给对方
			    });
			    //双击选项
			    $('#select2').dblclick(function(){
			       $("option:selected",this).appendTo('#select1');
			    });**/             
			});

			function doSearch(){	
				//通用查询action路径
				   var url = path+"getUserByScreen.action";	
				   var params={};
				   roleId=getQueryString("roleId");
				   params.roleId=roleId;
				   var rdata=[];
				   	$.ajax({
						async :false,
						type : "post",
						url : url,
						dataType : "json",
						data : params,
						success : function(data) {
							if (data) {
				              rdata=data.data.rows;
							}
						},
						error : function(r){
						   $("#myModal10").modal('show');			
						}
						});
				     return rdata;
				}
						
				function doSearch_getUserByRoleId(){	
					roleId=getQueryString("roleId");
					//通用查询action路径
					var url = path + "getLoginNameList.action";		
					var params={};
					params.roleId=roleId;
					var rdata=[];
					$.ajax({
						async :false,
						type : "post",
						url : url,
						dataType : "json",
						data : params,
						success : function(data) {
							if (data) {
				              rdata=data.loginNameList;
							}
						}
					});
					return rdata;
				}
		
		
				function doSave(){
					var array = new Array(); //定义数组
			        $("#select2 option").each(function(){ //遍历全部option
			        var txt = $(this).val(); //获取option的内容
			            array.push(txt); //添加到数组中
			        });
					var loginNameArray=array.join(",");
					var pat={};
					pat.tableName='suSecurityUserRole';
					pat.primaryKey = 'roleId';
					pat.primaryKeyValue=roleId;
					commonDelete(pat,function(){
						var url = path + "saveUserRole.action";
						var params={};
						params.roleId = roleId;
						params.loginNameArray = loginNameArray;
						if(loginNameArray.length>0){
						  ajaxFunction(url,params,false,function(data){
							if(data.success){
								var reFillFn = getQueryString("reFillFn");
								pwin[reFillFn](data);
								//window.parent.closeDialog.close();
							}else{
								
							}
						  });
						}else{
							
							zinglabs.i18n.alert('role_user_noGrantedForUser');		
							
						}
					});
			}
		</script>
	</body>
</html>