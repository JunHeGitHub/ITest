<!DOCTYPE  HTML>
<html>
	<head>
		<title>页面功能授权</title>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=9;IE=8;IE=EDGE" />
		
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/bootstarp/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/bootstarp/bootstrap-responsive.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/css/zinglabs.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/jquery.dataTables.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/DT_bootstrap.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/dataTables.tableTools.min.css"/>
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/font-awesome.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/dataTables.colVis.min.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/dataTables.responsive.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/artdialog/ui-dialog.css" />
	</head>
	<body>
		<!-- 容器 -->
		<div class="z_container">
			<!-- datatable部分 包含筛选项 -->
			<div class="head">
				<!-- dataTable筛选项部分 -->
				<div class="widget-box collapsible">
					<div class="widget-title">
						<span class="icon"> <i class="icon-search"></i> </span>
						<h5>
							配置项搜索
						</h5>
						<div class="buttons">
							<button class="btn btn-mini"
								onclick="jQuery.fx.off = false;$('#collapseOne').slideToggle(200);">
								<i class="icon-retweet"></i>展开/关闭
							</button>
						</div>
					</div>
					<div class="collapse in" id="collapseOne">
						<!--TODO 里面写查询项表单布局 -->
						<div class="widget-content container">
							<form action="" id="searchDataForm">
								<div style="height: 20px;"></div>
								<div class="row-fluid zing_row">
									<div class="span2 zing_span2"></div>
									<div class="span8 zing_span8">
										<div class="form-horizontal zing_form_horizontal">
											<!-- 日期 布局会遮住后面选择日期的按钮  临时同减小input宽度解决 -->
											<div class="control-group zing_control-group">
												<label class="control-label zing_control-label" for="generateTimetimebegin">
													角色名称:
												</label>
												<div class="controls zing_controls">
													<input type="text" class="zing_input_span6_append_icon" id="name" name="name">
													<button type="button" id="btn_search" class="btn"
														onclick="tableSearch()">
														<i class="icon-search"></i> 搜索
													</button>
													<button type="button" id="btn_clean" class="btn"
														onclick="cleanSearchForm()">
														<i class="icon-remove"></i> 清空
													</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
				<!-- dataTable 部分 -->
				<div class="widget-box">
					<div class="widget-title">
						<span class="icon"> <i class="icon-th"></i> </span>
						<h5>
							角色授权
						</h5>
						<!--TODO 里面可加一些按钮 -->
						<div class="buttons" style="float: right;">
							<button class="btn btn-mini btn-primary"
								onclick="navigate(this,'menuPermission.html','menu')">
								菜单功能授权
							</button>
							<button class="btn btn-mini btn-primary"
								onclick="navigate(this,'basePermission.html','base')">
								基础权限
							</button>
							<button class="btn btn-mini btn-primary"
								onclick="navigate(this,'zkmPermission.html','ZKM')">
								知识库权限
							</button>
							<button class="btn btn-mini btn-primary"
								onclick="navigate(this,'pagePermission.html','page')">
								页面功能授权
							</button>
							<button class="btn btn-mini btn-primary"
								onclick="navigate(this,'tabPermission.html','tab')">
								选项卡
							</button>
						</div>
					</div>
					<div class="widget-content nopadding">
						<table id="roleList" class="table table-striped table-hover dt-responsive" width="100%" style="width: 100%;"></table>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="../../../js/jquery.js"></script>
		<script type="text/javascript" src="../../../js/bootstrap.js"></script>
		<script type="text/javascript"
			src="../../../js/dataTables/js/jquery.dataTables.js"></script>
		<script type="text/javascript"
			src="../../../js/dataTables/js/dataTables.colReorder.js"></script>
		<script type="text/javascript"
			src="../../../js/dataTables/js/dataTables.colVis.js"></script>
		<script type="text/javascript"
			src="../../../js/dataTables/js/dataTables.tableTools.min.js"></script>
		<script type="text/javascript" src="../../../js/common_utils.js"></script>
		<script type="text/javascript" src="../../../js/appCommonUtil.js"></script>
		<script type="text/javascript"
			src="../../../js/appCommonCurdUtils_new.js"></script>
		<script type="text/javascript"
			src="../../../js/dataTables/js/DT_bootstrap.js"></script>
		<script type="text/javascript"
			src="../../../js/My97DatePicker/WdatePicker.js"></script>
		<script type="text/javascript" src="../../../js/log2.js"></script>
		<!-- 遮罩产插件 -->
		<script type="text/javascript" src="../../../js/jquery.blockUI.js"></script>
		<!-- 验证及提示组件 -->
		<script type="text/javascript"
			src="../../../js/jqueryValidate/jquery.validate.js"></script>
		<script type="text/javascript">
			var isLoadData = false;	
			//遮罩属性		
			var maskContent = {
				css : {
					border : 'none',
					padding : '15px',
					backgroundColor : '#000',
					'-webkit-border-radius' : '10px',
					'-moz-border-radius' : '10px',
					opacity : .5,
					color : '#fff',
					font : '14px'
				},
				message : '<img src="../../../img/wait.gif" border="0" />  正在加载中，请稍候...'
			};
			var roleTable=false;
			var roleCode="";
			var tab_type="";	
			var rowSelTr=false;
			$(document).ready(function() {
		    	$.blockUI(maskContent);
		    	var table = $('#roleList').DataTable({
		    	//滚动条
		    	//scrollY: 500,
		        //scrollX: false,
		        //延迟加载
		        deferRender: true,
		        processing: false,  
		         //开启服务端分页
		        serverSide: true,
		         //服务器端分页ajax请求 可抽离出一个方法
		     	ajax:doSearch,
				pagingType: "full_numbers",
		        pageLength: 10,
		        bPaginate: true, //翻页功能
		        bLengthChange: true, //改变每页显示数据数量
		        bFilter: true, //过滤功能
		        bSort: true, //排序功能
		        bInfo: true,//页脚信息
		        bAutoWidth: false, //自动宽度
		        sPaginationType: "bootstrap",//分页样式
		        dom: 'TRlrtip',
		        columns: [
		              {title:"序号",data: "DT_RowNumber", defaultContent: '', width:'15%',orderable: false },
		              {title:"角色名称" ,data: 'name',visible: true}
		             ],
		        columnDefs: [ {
		            "searchable": false,
		            "orderable": false,
		            "targets": 0
		        } ],
		        oLanguage: {
		             infoFiltered:function(){
		             },
		            "sLengthMenu": "每页显示 _MENU_条",
		            "sZeroRecords": "没有找到符合条件的数据",
		            "sProcessing": "&lt;imgsrc=’./loading.gif’ /&gt;",
		            "sInfo": "当前第 _START_ - _END_ 条　共计 _TOTAL_ 条",
		            "sInfoEmpty": "没有记录",
		            "sInfoFiltered": "(从 _MAX_ 条记录中过滤)",
		            "sSearch": "搜索：",
		            "oPaginate": {
		                "sFirst": "首页",
		                "sPrevious": "前一页",
		                "sNext": "后一页",
		                "sLast": "尾页"
		            }
		        }, tableTools: {
		            fnRowSelected: function ( nodes ) {
		                   var index=nodes[0]._DT_RowIndex;	
		                   rowSelTr=index;
			               var data = table.row(index).data();
			               roleCode=data.name;
			               var contsrc=$('#content').attr('src');
						   if(contsrc!=""&&contsrc!=undefined&&contsrc!=null){
						       $('#content').attr('src',contsrc);
						   }
			             },
			            sRowSelect:'single',
			            aButtons: []
			        }
			    });
			    
			    //自定义列插件绑定
			    //绑定事件 on
			    table= $('#roleList').DataTable();
			    roleTable=table;
			   /* table.on( 'order.dt search.dt', function () {
			        table.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
			            cell.innerHTML = i+1;
			        } );
			    } ).draw(true);*/
			    $.unblockUI();
			});
			/*
				筛选
			*/
			function tableSearch(){
				isLoadData = true;
			    var table=$('#roleList').DataTable();
			    table.draw(true);
			}
	
			function doSearch(data,callback,settings){
					if(!isLoadData){
						return;
					}
	                var params=spellSelectParams("searchDataForm");
				    params.tableName="suSecurityRole";
				    params.columns = "name";
				    //params.columnValues.msgId="@cookie_zhi";
				    params.rows=settings._iDisplayLength;
				    params.offset=settings._iDisplayStart;
				    $.blockUI(maskContent);
				    commonSelect(params,true,function(data){
				          try{
				              if(data&&data.data){
				                  var pdata={};
				                  var size=data.data.length;
				                  for(var i=0;i<size;i++){
				                    data.data[i].DT_RowNumber=i+1;
				                  }
				                  //数据
				                  pdata.data=data.data;
				                  //总条数
				                  pdata.recordsTotal=data.total||0;
				                   //过滤没有使用到总条数
				                  pdata.recordsFiltered=data.total||0;
				                  // 代表第几次画页面  如pdata.draw 不能删 如删掉不会翻页  
				                  pdata.draw=settings.iDraw;
				                  callback(pdata);
				               }
				          }catch(ex){
				             logErr("查询失败 failed "+ex.name + ": " + ex.message);
				          }  
				          $.unblockUI();    
						    });
			};
			/***
			 * 必须处理的严重错误，测试阶段可以alert 生产环境特殊标识写入日志
			 * 发现就要分析原因
			 * @param err
			 */
			function logErr(errMsg) {
			    log.debug(errMsg);
			};
			
			
			/**
			  导航切换
			**/
			function navigate(obj,src,type){
			    var selectData=roleTable.rows(".active").data();
			    if(selectData.length<=0){
			       //$.alert("提示","请选择角色");
			       zinglabs.i18n.alert("permission_role");
			       return ;
			    }
			   //var  tabMenu =$(obj).parent();
			   // $(tabMenu).siblings().each(function(){
			       //$(this).removeClass("active");
			    //});
			    //$(tabMenu).addClass("active");
			    //$('#content').attr('src',src);
			    tab_type=type;
			    var n_title = "";
			    var width = "";
			    var height = "";
			  	switch(type){
					case 'menu':
					  n_title = "菜单功能授权";
					  width = "300";
					  height = "300";
					  break;
					case 'base':
					  n_title = "基础权限";
					  width = "400";
					  height = "300";
					  break;
					case 'ZKM':
					  n_title = "知识库权限";
					  width = "600";
					  height = "300";
					  break;
					case 'page':
					  n_title = "页面功能授权";
					  width = "800";
					  height = "350";
					  break;
					case 'tab':
					  n_title = "选项卡";
					  width = "400";
					  height = "300";
					  break;      
					default:
					  return;
				}
			    var dig = dialog({
					title : '角色授权>'+n_title,
					content : '<iframe src=' + src + ' style="border: 0; width: 100%; height: 100%;"  frameborder="0"/>',
						width : width,
						height : height
					});
				dig.show();
			}
			function  getRoleCodeAndType(){
			    return {
			      "roleCode":roleCode,
			      "type":tab_type
			    }
			}
			function cleanSearchForm(){
			    $("#searchDataForm")[0].reset();
			}
		</script>
	</body>
</html>
