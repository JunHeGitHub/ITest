
<!DOCTYPE  HTML>
<html>
<head>
<title>已接收信息</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" href="../css/bootstrap.min.css" type="text/css"/>
<link rel="stylesheet" href="../css/bootstrap-responsive.min.css" type="text/css"/>
<link rel="stylesheet" href="../js/bootstrap-datetimepicker/css/datepicker.css" type="text/css"></link>

<link rel="stylesheet" href="../js/dataTables/css/jquery.dataTables.css" type="text/css"/>
<!--[if lt IE 9]>
<script type="text/javascript" src="../js/html5shiv.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="../js/dataTables/css/DT_bootstrap.css" type="text/css"/>
<link rel="stylesheet" href="../js/dataTables/css/dataTables.tableTools.min.css" type="text/css"/>
<link rel="stylesheet" href="unicorn.main.css" type="text/css"/>
<link rel="stylesheet" href="../js/dataTables/css/font-awesome.css"/>
<link rel="stylesheet" href="../js/dataTables/css/dataTables.colVis.min.css" type="text/css"/>

<script type="text/javascript" src="../js/jquery.js"></script>
<script type="text/javascript" src="../js/bootstrap.js"></script>
<script type="text/javascript" src="../js/dataTables/js/jquery.dataTables.js"></script>
<script type="text/javascript" src="../js/dataTables/js/dataTables.colReorder.js"></script>
<script type="text/javascript" src="../js/dataTables/js/dataTables.colVis.js"></script>
<script type="text/javascript" src="../js/dataTables/js/dataTables.tableTools.min.js"></script>

<script type="text/javascript" src="../js/common_utils.js"></script>
<script type="text/javascript" src="../js/appCommonCurdUtils_new.js"></script>
<script type="text/javascript" src="../js/dataTables/js/DT_bootstrap.js"></script>

<script type="text/javascript" src="../js/bootstrap-datetimepicker.min.js"></script>

<script type="text/javascript" src="../js/log2.js"></script>


<style type="text/css" class="init">
    td.red {
        font-weight: bold;
        color: red;
    }
    .form-inline .btn-group {
        display: none;
    }

    /*解决时间控件在模式对话框中的显示问题*/
    .datetimepicker{z-index:99999 !important;}
    .bootstrap-datetimepicker-widget {
        z-index:99999 !important;
    }


/*临时解决datatable单元格变形问题  为保证宽度不变，ie兼容模式显示效果为换行 其它浏览器省略号
  需要通过只显示部分原文解决此问题
*/
    .dataTable th, .dataTable td {
        width: 120px;
        max-width: 120px;
        /*min-width: 120px;*/
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }


    /*tr td:first-child {*/
    /*text-align: center;*/
    /*}*/
    /* fa-square-o */
    /*tr td:first-child:before {*/
    /*content: "\f096";*/
    /*font-family: FontAwesome;*/
    /*}*/

    /*tr.active td:first-child:before {*/
    /*content: "\f046"; *//* fa-check-square-o */
    /*}*/
</style>
<script type="text/javascript">


// Register an API method that will empty the pipelined data, forcing an Ajax
// fetch on the next draw (i.e. `table.clearPipeline().draw()`)
$.fn.dataTable.Api.register( 'clearPipeline()', function () {
    return this.iterator( 'table', function ( settings ) {
        settings.clearCache = true;
    } );
} );

var yijieshouxinxiCurdStatus="false";

var xmlJsonMap ={};


var fullName="false";
var selStr="select ";

var insertStr=" insert into ";


    fullName="Z_MsgReceive";
    insertStr+="Z_MsgReceive ( ";
    xmlJsonMap["Z_MsgReceive"]={};
    
    xmlJsonMap["Z_MsgReceive"]["id"]={};
    xmlJsonMap["Z_MsgReceive"]["id"]["attrName"]="id";
    xmlJsonMap["Z_MsgReceive"]["id"]["dbType"]="int";
    xmlJsonMap["Z_MsgReceive"]["id"]["visible"]="false";
    xmlJsonMap["Z_MsgReceive"]["id"]["fullName"]="Z_MsgReceive";
    xmlJsonMap["Z_MsgReceive"]["id"]["timeFormat"]="";
    xmlJsonMap["Z_MsgReceive"]["id"]["fieldType"]="1";

    selStr+="id";
    insertStr+="id";

    selStr+=",";
    //        还是有最后一个带,的情况最后一个canEdit==false时。doAdd中有特殊处理

    insertStr+=",";
    
    

    
    xmlJsonMap["Z_MsgReceive"]["generateTime"]={};
    xmlJsonMap["Z_MsgReceive"]["generateTime"]["attrName"]="generateTime";
    xmlJsonMap["Z_MsgReceive"]["generateTime"]["dbType"]="TIMESTAMP";
    xmlJsonMap["Z_MsgReceive"]["generateTime"]["visible"]="true";
    xmlJsonMap["Z_MsgReceive"]["generateTime"]["fullName"]="Z_MsgReceive";
    xmlJsonMap["Z_MsgReceive"]["generateTime"]["timeFormat"]="Y-m-d H:i:s";
    xmlJsonMap["Z_MsgReceive"]["generateTime"]["fieldType"]="3";

    selStr+="generateTime";

    
        selStr+=",";
    //        还是有最后一个带,的情况最后一个canEdit==false时。doAdd中有特殊处理

    
    

    
    xmlJsonMap["Z_MsgReceive"]["msgTitle"]={};
    xmlJsonMap["Z_MsgReceive"]["msgTitle"]["attrName"]="msgTitle";
    xmlJsonMap["Z_MsgReceive"]["msgTitle"]["dbType"]="TEXT";
    xmlJsonMap["Z_MsgReceive"]["msgTitle"]["visible"]="true";
    xmlJsonMap["Z_MsgReceive"]["msgTitle"]["fullName"]="Z_MsgReceive";
    xmlJsonMap["Z_MsgReceive"]["msgTitle"]["timeFormat"]="";
    xmlJsonMap["Z_MsgReceive"]["msgTitle"]["fieldType"]="3";

    selStr+="msgTitle";

        insertStr+="msgTitle";
    
        selStr+=",";
    //        还是有最后一个带,的情况最后一个canEdit==false时。doAdd中有特殊处理

        insertStr+=",";
    
    

    
    xmlJsonMap["Z_MsgReceive"]["msgReceiver"]={};
    xmlJsonMap["Z_MsgReceive"]["msgReceiver"]["attrName"]="msgReceiver";
    xmlJsonMap["Z_MsgReceive"]["msgReceiver"]["dbType"]="TEXT";
    xmlJsonMap["Z_MsgReceive"]["msgReceiver"]["visible"]="true";
    xmlJsonMap["Z_MsgReceive"]["msgReceiver"]["fullName"]="Z_MsgReceive";
    xmlJsonMap["Z_MsgReceive"]["msgReceiver"]["timeFormat"]="";
    xmlJsonMap["Z_MsgReceive"]["msgReceiver"]["fieldType"]="3";

    selStr+="msgReceiver";

        insertStr+="msgReceiver";
    
        selStr+=",";
    //        还是有最后一个带,的情况最后一个canEdit==false时。doAdd中有特殊处理

        insertStr+=",";
    
    

    
    xmlJsonMap["Z_MsgReceive"]["msgImportLevel"]={};
    xmlJsonMap["Z_MsgReceive"]["msgImportLevel"]["attrName"]="msgImportLevel";
    xmlJsonMap["Z_MsgReceive"]["msgImportLevel"]["dbType"]="char";
    xmlJsonMap["Z_MsgReceive"]["msgImportLevel"]["visible"]="true";
    xmlJsonMap["Z_MsgReceive"]["msgImportLevel"]["fullName"]="Z_MsgReceive";
    xmlJsonMap["Z_MsgReceive"]["msgImportLevel"]["timeFormat"]="";
    xmlJsonMap["Z_MsgReceive"]["msgImportLevel"]["fieldType"]="3";

    selStr+="msgImportLevel";

        insertStr+="msgImportLevel";
    
        selStr+=",";
    //        还是有最后一个带,的情况最后一个canEdit==false时。doAdd中有特殊处理

        insertStr+=",";
    
    

    
    xmlJsonMap["Z_MsgReceive"]["readFlag"]={};
    xmlJsonMap["Z_MsgReceive"]["readFlag"]["attrName"]="readFlag";
    xmlJsonMap["Z_MsgReceive"]["readFlag"]["dbType"]="char";
    xmlJsonMap["Z_MsgReceive"]["readFlag"]["visible"]="true";
    xmlJsonMap["Z_MsgReceive"]["readFlag"]["fullName"]="Z_MsgReceive";
    xmlJsonMap["Z_MsgReceive"]["readFlag"]["timeFormat"]="";
    xmlJsonMap["Z_MsgReceive"]["readFlag"]["fieldType"]="3";

    selStr+="readFlag";

        insertStr+="readFlag";
    
        selStr+=",";
    //        还是有最后一个带,的情况最后一个canEdit==false时。doAdd中有特殊处理

        insertStr+=",";
    
    

    
    xmlJsonMap["Z_MsgReceive"]["msgEndTime"]={};
    xmlJsonMap["Z_MsgReceive"]["msgEndTime"]["attrName"]="msgEndTime";
    xmlJsonMap["Z_MsgReceive"]["msgEndTime"]["dbType"]="TIMESTAMP";
    xmlJsonMap["Z_MsgReceive"]["msgEndTime"]["visible"]="true";
    xmlJsonMap["Z_MsgReceive"]["msgEndTime"]["fullName"]="Z_MsgReceive";
    xmlJsonMap["Z_MsgReceive"]["msgEndTime"]["timeFormat"]="Y-m-d H:i:s";
    xmlJsonMap["Z_MsgReceive"]["msgEndTime"]["fieldType"]="3";

    selStr+="msgEndTime";

        insertStr+="msgEndTime";
    
        selStr+=",";
    //        还是有最后一个带,的情况最后一个canEdit==false时。doAdd中有特殊处理

        insertStr+=",";
    
    

    
    xmlJsonMap["Z_MsgReceive"]["msgId"]={};
    xmlJsonMap["Z_MsgReceive"]["msgId"]["attrName"]="msgId";
    xmlJsonMap["Z_MsgReceive"]["msgId"]["dbType"]="varchar";
    xmlJsonMap["Z_MsgReceive"]["msgId"]["visible"]="true";
    xmlJsonMap["Z_MsgReceive"]["msgId"]["fullName"]="Z_MsgReceive";
    xmlJsonMap["Z_MsgReceive"]["msgId"]["timeFormat"]="";
    xmlJsonMap["Z_MsgReceive"]["msgId"]["fieldType"]="3";

    selStr+="msgId";

        insertStr+="msgId";
    
        selStr+=",";
    //        还是有最后一个带,的情况最后一个canEdit==false时。doAdd中有特殊处理

        insertStr+=",";
    
    

    
    xmlJsonMap["Z_MsgReceive"]["msgContent"]={};
    xmlJsonMap["Z_MsgReceive"]["msgContent"]["attrName"]="msgContent";
    xmlJsonMap["Z_MsgReceive"]["msgContent"]["dbType"]="TEXT";
    xmlJsonMap["Z_MsgReceive"]["msgContent"]["visible"]="true";
    xmlJsonMap["Z_MsgReceive"]["msgContent"]["fullName"]="Z_MsgReceive";
    xmlJsonMap["Z_MsgReceive"]["msgContent"]["timeFormat"]="";
    xmlJsonMap["Z_MsgReceive"]["msgContent"]["fieldType"]="3";

    selStr+="msgContent";

    insertStr+="msgContent";
    
    selStr+=",";
    //        还是有最后一个带,的情况最后一个canEdit==false时。doAdd中有特殊处理

    insertStr+=",";
    
    

    
    xmlJsonMap["Z_MsgReceive"]["msgBeginTime"]={};
    xmlJsonMap["Z_MsgReceive"]["msgBeginTime"]["attrName"]="msgBeginTime";
    xmlJsonMap["Z_MsgReceive"]["msgBeginTime"]["dbType"]="TIMESTAMP";
    xmlJsonMap["Z_MsgReceive"]["msgBeginTime"]["visible"]="true";
    xmlJsonMap["Z_MsgReceive"]["msgBeginTime"]["fullName"]="Z_MsgReceive";
    xmlJsonMap["Z_MsgReceive"]["msgBeginTime"]["timeFormat"]="Y-m-d H:i:s";
    xmlJsonMap["Z_MsgReceive"]["msgBeginTime"]["fieldType"]="3";

    selStr+="msgBeginTime";

    insertStr+="msgBeginTime";
    
    selStr+=",";
    //        还是有最后一个带,的情况最后一个canEdit==false时。doAdd中有特殊处理

   insertStr+=",";
    
    

    
    xmlJsonMap["Z_MsgReceive"]["msgSender"]={};
    xmlJsonMap["Z_MsgReceive"]["msgSender"]["attrName"]="msgSender";
    xmlJsonMap["Z_MsgReceive"]["msgSender"]["dbType"]="varchar";
    xmlJsonMap["Z_MsgReceive"]["msgSender"]["visible"]="true";
    xmlJsonMap["Z_MsgReceive"]["msgSender"]["fullName"]="Z_MsgReceive";
    xmlJsonMap["Z_MsgReceive"]["msgSender"]["timeFormat"]="";
    xmlJsonMap["Z_MsgReceive"]["msgSender"]["fieldType"]="3";

    selStr+="msgSender";

    insertStr+="msgSender";
    
    
    

selStr+=" from "+fullName+" where 1=1 ";

$(document).ready(function() {
//    var data=doSearch();
  
   $('#yijieshouxinxiGrid').DataTable({
        //滚动条
        //scrollY: 500,
        //scrollX: false,
        //延迟加载
         deferRender: true,
        //开启服务端分页
         processing: false,
         serverSide: true,
         //服务器端分页
         ajax: function (data, callback, settings) {
                var params=commonFrom2Json("yijieshouxinxiSearchForm");
			    
			    params.tableName="Z_MsgReceive";
			    params.rows=settings._iDisplayLength;
			    params.offset=settings._iDisplayStart;
			    commonSelect(params,true,function(data){
			                if(data&&data.data){
			                  var pdata={};
			                  //数据
			                  pdata.data=data.data;
			                  //总条数
			                  pdata.recordsTotal=data.total;
			                   //过滤没有使用到总条数
			                  pdata.recordsFiltered=data.total;
			                  // 代表第几次画页面  如pdata.draw 不能删 如删掉不会翻页  
			                  pdata.draw=settings.iDraw;
			                  callback(pdata);
			                }
			    });
		 
		 },
		pagingType: "full_numbers",
        pageLength: 2,
        bPaginate: true, //翻页功能
        bLengthChange: false, //改变每页显示数据数量
        bFilter: true, //过滤功能
        bSort: true, //排序功能
        bInfo: true,//页脚信息
        bAutoWidth: false, //自动宽度
        sPaginationType: "bootstrap",//分页样式
        dom: 'TRlrtip',
        columns: [
              {title:"序号",data: null, defaultContent: '', orderable: false },
              {title:"数据标识" ,data: 'id',width:'6%', visible: false},
              {title:"生成时间" ,data: 'generateTime',width:'6%', visible: true},
              {title:"消息标题" ,data: 'msgTitle',width:'6%', visible: true},
              {title:"收信人" ,data: 'msgReceiver',width:'6%', visible: true},
              {title:"重要程度" ,data: 'msgImportLevel',width:'6%', visible: true},
              {title:"是否阅读" ,data: 'readFlag',width:'6%', visible: true},
              {title:"消息失效时间" ,data: 'msgEndTime',width:'6%', visible: true},
              {title:"消息标识" ,data: 'msgId',width:'6%', visible: true},
              {title:"消息正文" ,data: 'msgContent',width:'6%', visible: true},
              {title:"消息生效时间" ,data: 'msgBeginTime',width:'6%', visible: true},
              {title:"发信人" ,data: 'msgSender' ,width:'6%', visible: true},                                 
              {
                    title:"操作",
                    "sClass": "center",
                    "bSearchable": false,
                    "defaultContent": "<button class=\"yijieshouxinxiEdit\" >编辑</button>|<button class=\"yijieshouxinxiDelete\"  >删除</button>",
                    "bStorable": false
                }
               ],
        oLanguage: {
             infoFiltered:function(){
             
             },
            "sLengthMenu": "每页显示 _MENU_条",
            "sZeroRecords": "没有找到符合条件的数据",
            "sProcessing": "&lt;imgsrc=’./loading.gif’ /&gt;",
            "sInfo": "当前第 _START_ - _END_ 条　共计 _TOTAL_ 条",
            "sInfoEmpty": "没有记录",
            "sInfoFiltered": "(从 _MAX_ 条记录中过滤)",
            "sSearch": "搜索：",
            "oPaginate": {
                "sFirst": "首页",
                "sPrevious": "前一页",
                "sNext": "后一页",
                "sLast": "尾页"
            }
        }, tableTools: {
            fnRowSelected: function ( nodes ) {
            },
            sRowSelect:'os',
            
            aButtons: []
        }
    });
    //绑定事件 on
   var table= $('#yijieshouxinxiGrid').DataTable();

   table.on( 'order.dt search.dt', function () {
        table.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
            cell.innerHTML = i+1;
        } );
    }).draw();




    /**
     *
     * 查询、添加页面中的数据清理,因为延迟、数据异步处理等原因由各自功能控制。
     *
     * */

    $('#yijieshouxinxiSearch').on('hide',function(obj){

    });

    $('#yijieshouxinxiSearch').on('show',function(obj){

    });

    $('#yijieshouxinxiAdd').on('hide',function(obj){
//        编辑、增加页面状态清理。一定要确保页面数据已经不再使用。
//        不能
    });

    $('#yijieshouxinxiAdd').on('show',function(obj){

    });

    $('.yijieshouxinxiBtnAdd').on('click',function(){
        var paramTmp={};
        paramTmp["id"]="yijieshouxinxiAdd";
        paramTmp["isClear"]="true";
        setPanelVal(paramTmp);
        yijieshouxinxiCurdStatus="add";
        $('#yijieshouxinxiAdd').modal('show');
    });
    $('.yijieshouxinxiBtnSearch').on('click',function(){
        var paramTmp={};
        paramTmp["id"]="yijieshouxinxiSearch";
        paramTmp["isClear"]="true";
        setPanelVal(paramTmp);
        $('#yijieshouxinxiSearch').modal('show');
    });
    $('.yijieshouxinxiBtnSearchSubmit').on('click',function(){
        var Param={};
        tParam["id"]="#yijieshouxinxi";
        tParam["tableName"]=fullName;
        tParam["dbId"]="ZDesk";
        tParam["url"]="/ZDesk/ZDesk/XmlDBAction.do";
        tParam["selStr"]=selStr;
        var data=doSearch(tParam);
        $('#yijieshouxinxiSearch').modal('hide');
    });

    $('.yijieshouxinxiBtnAddSubmit').on('click',function(){
        try{
            log.debug("BtnAddSubmit click begin CurdStatus:"+yijieshouxinxiCurdStatus+" "+getSelRowNo());
            if(yijieshouxinxiCurdStatus=="add"){
                var Param={};
                tParam["id"]="#yijieshouxinxi";
                tParam["tableName"]=fullName;
                tParam["dbId"]="ZDesk";
                tParam["url"]="/ZDesk/ZDesk/XmlDBAction.do";
                tParam["insertStr"]=insertStr;
                tParam["selStr"]=selStr;
                doAdd(tParam);

            }else if(yijieshouxinxiCurdStatus=="edit"){
                var tableTmp= $('#yijieshouxinxiGrid').DataTable();
                var selRowData=tableTmp.row('.selected').data();
                var attrsTmp=BGetConditionConfVal(fullName,"fieldType","1");
                if(attrsTmp!=null && "attrName" in attrsTmp){
                    var editIdName=attrsTmp["attrName"];

                    var editIdVal=selRowData[editIdName];

                    var editWhere=" where "+editIdName+"="+editIdVal;
                    var paramEdit={};
                    paramEdit["id"]="#yijieshouxinxi";
                    paramEdit["tableName"]=fullName;
                    paramEdit["dbId"]="ZDesk";
                    paramEdit["url"]="/ZDesk/ZDesk/XmlDBAction.do";
                    paramEdit["editWhere"]=editWhere;
                    paramEdit["editIdName"]=editIdName;
                    paramEdit["editIdVal"]=editIdVal;
                    paramEdit["selStr"]=selStr;
                    doEdit(paramEdit);
                }
            }
            //        编辑、增加页面状态清理。一定要确保页面数据已经不再使用。
            yijieshouxinxiCurdStatus="false";
        }catch(e){
            //        编辑、增加页面状态清理。一定要确保页面数据已经不再使用。
            yijieshouxinxiCurdStatus="false";
            logErr("Exception BtnAddSubmit need see log "+e.name + ": " + e.message);
        }
    });

    $('.yijieshouxinxiBtnSearchClose').on('click',function(){
        log.debug(" tnSearchClose del selected "+getSelRowNo());
        table.$('tr.selected').removeClass('selected');
        $('#yijieshouxinxiSearch').modal('hide');
    });

    $('.yijieshouxinxiBtnAddClose').on('click',function(){
        log.debug(" BtnAddClose del selected "+getSelRowNo());
        table.$('tr.selected').removeClass('selected');
        $('#yijieshouxinxiAdd').modal('hide');
    });


    $('#yijieshouxinxiGrid tbody').on( 'click', 'button', function (obj) {

        var selTr=$(this).parents('tr');
        table.$('tr.selected').removeClass('selected');
        $(selTr).addClass('selected');

        log.debug(" edit or delete click set selected"+getSelRowNo());

        var data = table.row( selTr ).data();
//        var data = table.row('.selected').data();
        if (obj.target.className=="yijieshouxinxiEdit"){

            var paramTmp={};
            paramTmp["id"]="yijieshouxinxiAdd";
            paramTmp["data"]=data;
            setPanelVal(paramTmp);
            yijieshouxinxiCurdStatus="edit";

            $('#yijieshouxinxiAdd').modal('show');
//            alert("edit:"+JSON.stringify(data));
        }else if (obj.target.className=="yijieshouxinxiDelete"){
            var attrsTmp=BGetConditionConfVal(fullName,"fieldType","1");
            if(attrsTmp!=null && "attrName" in attrsTmp){
                var delIdName=attrsTmp["attrName"];
                var delIdValue=data[delIdName];

                var sqlDel="delete from "+fullName+" where "+delIdName+"="+delIdValue;
                var paramDel={}
                paramDel["id"]="#yijieshouxinxi";
                paramDel["tableName"]=fullName;
                paramDel["dbId"]="ZDesk";
                paramDel["url"]="/ZDesk/ZDesk/XmlDBAction.do";
                paramDel["sqlDel"]=sqlDel;
                paramDel["delIdName"]=delIdName;
                paramDel["delIdValue"]=delIdValue;
                doDelete(paramDel);
            }
//            alert("del:"+JSON.stringify(data));
        }
    } );


//  动态按钮事件
          $('#chakanzhengwenButtonYJS').on('click',function(){
                    Z_ShowMsgZW();
            });
                        

            BRegisterExtEvent("chakanzhengwenButtonCS","","click","[{ fn:chakanzhengwenButtonCSFun, fp:{ bindMap:[ ['record_length','123456'] ], param:{ triggerFn:'Z_fujianopenluyin' } } }]","${evt.param}");
    
    //工具栏与bootstarp 结合
    // var tt = new $.fn.dataTable.TableTools(table);
    //  $(tt.fnContainer()).insertBefore('#tools');

    //筛选绑定
    /* $('#shaixuan').on( 'keyup', function () {
     table.search( this.value ).draw();

     });*/
    //自定义列插件绑定

    var colvis = new $.fn.dataTable.ColVis(table,{ buttonText: '自定义显示列',exclude: [ 0 ,1] });
    $( colvis.button()).insertBefore('#yijieshouxinxiColvis');

    var tParam={};
    tParam["id"]="#yijieshouxinxi";
    tParam["tableName"]=fullName;
    tParam["dbId"]="ZDesk";
    tParam["url"]="/ZDesk/ZDesk/XmlDBAction.do";
    tParam["selStr"]=selStr;
    var data=doSearch(tParam);

        $(".generateTime_datetime").datetimepicker({
                format: "yyyy-MM-dd HH:mm:ss",
                autoclose: true,
                todayBtn: true,
                pickerPosition: "bottom-left"
            });
         $(".msgEndTime_datetime").datetimepicker({
                format: "yyyy-MM-dd HH:mm:ss",
                autoclose: true,
                todayBtn: true,
                pickerPosition: "bottom-left"
            });
          $(".msgBeginTime_datetime").datetimepicker({
                format: "yyyy-MM-dd HH:mm:ss",
                autoclose: true,
                todayBtn: true,
                pickerPosition: "bottom-left"
            });
                        
		    $('#yijieshouxinxiAdd').modal({
		        backdrop: 'static',
		        show:false,
		        keyboard: false
		    });
		    $('#yijieshouxinxiSearch').modal({
		        backdrop: 'static',
		        show:false,
		        keyboard: false
		    });

});


/**
 *
 * selector:被填充combo的选择表达式
 * comboType：下列列表载入标识
 * comboParam：联动标识
 *
 * @desc填充指定的combo
 *
 * */

 function fillCombo(selector,comboType,comboParam){
    var url = "/ZDesk/ZDesk/XmlDBAction.do?action=Combo&comboType="+comboType;

    if(!BIsNullVal(comboParam)){
        url = "/ZDesk/ZDesk/XmlDBAction.do?action=Combo&comboType="+comboType+"&comboParam="+comboParam;
    }

    $.ajax({
        async :true,
        type : "post",
        url : url,
        dataType : "json",
        success : function(data) {
            if (data) {
                if(!BIsNullVal(data)){
                    $(selector).empty().append(function() {
                        var output = '';
                        $.each(data.rows, function(index,element) {
                            output += '<option value="'+element.code+'">' + element.name + '</option>';
                        });
                        return output;
                    });
                }
            }
        },
        error : function(r){
            alert("error");
        }
    });
}

/***
 * @TODO
 * 通用，调试完成后分文件，不要加Velocity代码
 */

var urlProc="/ZDesk/ZDesk/DBProc";
function doSearch(pVars){
   var tableTmp=$(pVars.id+"Grid").DataTable();
   tableTmp.draw(true);
  /*  var rdata=false;
    var params=commonFrom2Json("yijieshouxinxiSearchForm");
    params.tableName=pVars.tableName;
    
    commonSelect(params,false,function(data){
    
                var tableTmp=$(pVars.id+"Grid").DataTable();

                if(data&&data.data){
                    rdata=data.data;
                    tableTmp.clear();
                    tableTmp.rows.add(rdata).draw(true);
                }else{
                    tableTmp.clear().draw();
                }
    
    });*/
   /* var url = pVars.url;
    if(url.indexOf("XmlDBAction.do")!=-1){
        url=urlProc;
    }

    var swhere="";
    
    $(pVars.id+'Search :input').each(function(index,obj) {
        var type = obj.type;
        var tag = obj.tagName.toLowerCase();

        var value="";
        var needProc=false;
        if (type == 'text' || type == 'password' || tag == 'textarea'){
            value=$(obj).val();
            needProc=true;
        }else if (type == 'checkbox' || type == 'radio'){
            if($(obj).attr('checked')==true){
                value=="true";
            }else{
                value=="false";
            }
            needProc=true;
        }
        else if (tag == 'select'){
            value=$(obj).val();
            needProc=true;
        }

        if(needProc&& !BIsNullVal(value)){

            swhere+=" and ";

            var nameTmp=$(obj).attr('name');
            var compareTmp=" = ";
            if(nameTmp.indexOf("timebegin")!=-1){
                nameTmp=nameTmp.substring(0,nameTmp.indexOf('timebegin'));
                compareTmp=" >= ";

            }else if(nameTmp.indexOf("timeend")!=-1){
                nameTmp=nameTmp.substring(0,nameTmp.indexOf('timeend'));
                compareTmp=" <= ";
            }

            swhere+=nameTmp+compareTmp;

//        目前未支持 数字类型比较大小 所以暂时不需要判断是否加双引号。
            swhere+=" '";
            swhere+=value;
            swhere+="' ";
        }
    });

    var params={};
    params["action"]="LoadWinDataJson";
    params["dbId"]=pVars.dbId;
    params["tableName"]=pVars.tableName;
    params["encode"]="true";
    params["sql"]=Z_EU(pVars.selStr+swhere);
//    params["pageId"]="true";
//    params["pageSize"]="true";

*/
/*
    $.ajax({
        async :true,
        type : "post",
        url : url,
        dataType : "json",
        data : params,
        success : function(data) {
            if (data) {
                var rdata=[];
//                数据不是以Items组织的情况,可以做多个判断
                var tableTmp=$(pVars.id+"Grid").DataTable();

                if(data.retcode==0){
                    rdata=data.Items;
                    tableTmp.clear();
                    tableTmp.rows.add(rdata).draw(true);
                }else{
                    tableTmp.clear().draw();
                }
            }
        },
        error : function(r){
            alert("error");
        }
    });
    */
};

function doEditModalClean(){
    log.debug("doEditModalClean begin del selected"+getSelRowNo());
    var tableData= $('#yijieshouxinxiGrid').DataTable();
//            解决不了全部选择状态的问题，时间关系，只能禁用对话框关闭，加关闭按钮了
    tableData.$('tr.selected').removeClass('selected');
    $('#yijieshouxinxiAdd').modal('hide');
};



/***
 * @TODO
 * 通用，调试完成后分文件，不要加Velocity代码
 */

function doEdit(pVars){
   var params={};
    var cValues=zkm_getHtmlFormJsons("yijieshouxinxiAddForm");
    //主键的值
    cValues.id=pVars.editIdVal;
    params.columnValues=cValues;
    
    
    params.tableName=pVars.tableName;
    //如更改不是id 需定义 params.primarykey
    commonUpdate(params,true,function(data){
   
       try{
                    var tableTmp=$(pVars.id+"Grid").dataTable();
                    var tableDataTmp=$(pVars.id+"Grid").DataTable();
                    if(data.success){
                        try{
//                            var rowIndex=tableDataTmp.row('.selected').row().index();
//                            row indx在某些情况下不靠谱，调整为直接传选中行
                            var rowSelTr=tableDataTmp.$('tr.selected');
                            tableTmp.fnUpdate(params.columnValues, rowSelTr );
                        }catch(e){
                            logErr("Exception need see log "+e.name + ": " + e.message);
                        }
                        $(pVars.id+'Add').modal('hide');
                    }else{
                        logErr("Exception edit failed  "+data +" "+("Items" in data));
                    }
                     doEditModalClean();
                }catch(ex){
                    doEditModalClean();
                    logErr("doEdit 2222 Excep "+ex.name + ": " + ex.message);
                }
   
   
   
   });
  //  var url = pVars.url;
  //  if(url.indexOf("XmlDBAction.do")!=-1){
  //      url=urlProc;
  //  }
// update没有全置空问题
/*
    var needExec=false

    var updateSql="update "+pVars.tableName+" set ";

    $(pVars.id+'Add :input').each(function(index,obj) {
        try{
            var type = obj.type;
            var tag = obj.tagName.toLowerCase();
            var nameTmp=$(obj).attr('name');
            var value="";
            var needProc=false;
            if (type == 'text' || type == 'password' || tag == 'textarea'){

                value=$(obj).val();

                if($(obj).attr("isDataId") && $(obj).attr("isDataId")=='true'){
//                continue for jquery each is return
                    return;

//                return false; is break for jquery each
                }

                needProc=true;
            }else if (type == 'checkbox' || type == 'radio'){
                if($(obj).attr('checked')==true){
                    value=="true";
                }else{
                    value=="false";
                }
                needProc=true;
            }else if (tag == 'select'){
                value=$(obj).find("option:selected").val();
//            value=$(obj).val();
//            var selIndexTmp=$(obj).attr('selectedIndex');
                needProc=true;
            }

            if(needProc&& !BIsNullVal(value)){

//        目前未支持 数字类型比较大小 所以暂时不需要判断是否加双引号。

                updateSql+=nameTmp;
                updateSql+=" = '";
                updateSql+=value;
                updateSql+="' ";

                updateSql+=",";

//            addData[nameTmp]=value;
                needExec=true;
            }else if(BIsNullVal(value)){
                if(!BIsConfValNull(pVars.tableName,nameTmp,"timeFormat")){
                    value=" '0000-00-00 00:00:00'";
                }else{
                    value=" ''";
                }
                updateSql+=nameTmp;
                updateSql+=" = ";
                updateSql+=value;
                updateSql+=",";
            }
        }catch(eee){
            logErr("doEdit 11111 Excep "+eee.name + ": " + eee.message);
        }
    });

    if(updateSql.lastIndexOf(",") != 0){
        updateSql=updateSql.substring(0,updateSql.length-1);
    }

    var params={};
    params["action"]="EasyDBJson";
    params["dbId"]=pVars.dbId;
    params["tableName"]=pVars.tableName;
    params["encode"]="true";
    params["sql"]=Z_EU(updateSql+pVars.editWhere);
    params["selSql"]=Z_EU(pVars.selStr+" and "+pVars.editIdName+"='"+pVars.editIdVal+"'");

//    params["pageId"]="true";
//    params["pageSize"]="true";

    $.ajax({
        async :true,
        type : "post",
        url : url,
        dataType : "json",
        data : params,
        success : function(data) {
            if (data) {
                log.debug("doEdit update ok "+data.retcode+" "+getSelRowNo());

//                数据不是以Items组织的情况,可以做多个判断
                try{
                    var tableTmp=$(pVars.id+"Grid").dataTable();
                    var tableDataTmp=$(pVars.id+"Grid").DataTable();

                    if(data.retcode==0 && "Items" in data && data.Items.length>0){
                        try{
//                            var rowIndex=tableDataTmp.row('.selected').row().index();

//                            row indx在某些情况下不靠谱，调整为直接传选中行
                            var rowSelTr=tableDataTmp.$('tr.selected');

                            tableTmp.fnUpdate( data.Items[0], rowSelTr );
                        }catch(e){
                            logErr("Exception need see log "+e.name + ": " + e.message);
                        }
                        $(pVars.id+'Add').modal('hide');
                    }else{
                        logErr("Exception edit failed  "+data +" "+("Items" in data));
                    }
                    doEditModalClean();
                }catch(ex){
                    doEditModalClean();
                    logErr("doEdit 2222 Excep "+ex.name + ": " + ex.message);
                }
            }
        },
        error : function(r){
            doEditModalClean();
            logErr("doDelete ajax error");
            alert("doDelete ajax error");
        }
    });*/
//    }

};

function doAddModalClean() {
    log.debug("doAddModalClean begin del selected"+getSelRowNo());
    var tableData= $('#yijieshouxinxiGrid').DataTable();
//            解决不了全部选择状态的问题，时间关系，只能禁用对话框关闭，加关闭按钮了
    tableData.$('tr.selected').removeClass('selected');
    $('#yijieshouxinxiAdd').modal('hide');
};



/***
 * @TODO
 * 通用，调试完成后分文件，不要加Velocity代码
 */

function doAdd(pVars){
    var params={};
    var cValues=zkm_getHtmlFormJsons("yijieshouxinxiAddForm");
    //如批量需将 json放到数组中赋给params.columnValues
    //for(int i=0;i<2;i++){
     //  cValuesArr.push(cValuesArr);
    //}
    //params.columnValues=cValuesArr;
    params.columnValues=cValues;
    params.tableName=pVars.tableName;
    //使用增
    commonInsertOrUpdate(params,true,function(data){
        try{
                    if (data) {
                        var tableTmp=$(pVars.id+"Grid").DataTable();
                        if(data.success){
                            try{
                                params.columnValues.id=data.idValues.id;
                                tableTmp.row.add(params.columnValues).draw();
                            }catch(e){
                                logErr("Exception need see log "+e.name + ": " + e.message);
                            }
                            $(pVars.id+'Add').modal('hide');
                        }else{
                            logErr("Exception add failed  "+data +" "+("Items" in data));
                        }
                    }
                    doAddModalClean();
                }catch(exx){
                    logErr("Exception need see log "+exx.name + ": " + exx.message);
                    doAddModalClean();
                }
    
    });
    
                    
    
  /*  var url = pVars.url;
    if(url.indexOf("XmlDBAction.do")!=-1){
        url=urlProc;
    }

//    有可能遇到最后一个字段不是可编辑项，导致末尾带逗号的情况。需要特殊处理。
//    isDataId="true"
    if(pVars.insertStr.lastIndexOf(",", 0) === 0){
        pVars.insertStr=pVars.insertStr.substring(0,pVars.insertStr.length-1);
    }
    pVars.insertStr=pVars.insertStr+")values(";

//确保不增加空行
    var needExec=false;
//    var addData={};
    var idFieldName="false";

    $(pVars.id+'Add :input').each(function(index,obj) {
        var type = obj.type;
        var tag = obj.tagName.toLowerCase();
        var nameTmp=$(obj).attr('name');
        var value="";
        var needProc=false;
        if (type == 'text' || type == 'password' || tag == 'textarea'){

            value=$(obj).val();
            if($(obj).attr("isDataId") && $(obj).attr("isDataId")=='true'){
                value="ZSP_dataId_ZSP";
                idFieldName=nameTmp;
            }

            needProc=true;
        }else if (type == 'checkbox' || type == 'radio'){
            if($(obj).attr('checked')==true){
                value=="true";
            }else{
                value=="false";
            }
            needProc=true;
        }else if (tag == 'select'){
//            var selectText=$(obj).find("option:selected").text();
            value=$(obj).find("option:selected").val();
//            value=$(obj).val();
//            var selIndexTmp=$(obj).attr('selectedIndex');
            needProc=true;
        }

        if(needProc&& !BIsNullVal(value)){

//        目前未支持 数字类型比较大小 所以暂时不需要判断是否加双引号。

            pVars.insertStr+=" '";
            pVars.insertStr+=value;
            pVars.insertStr+="' ";
            pVars.insertStr+=",";

//            addData[nameTmp]=value;
            needExec=true;
        }else if(BIsNullVal(value)){
            if(!BIsConfValNull(pVars.tableName,nameTmp,"timeFormat")){
                value=" '0000-00-00 00:00:00'";
//                pVars.insertStr+=" '0000-00-00 00:00:00'";
//                addData[nameTmp]='0000-00-00 00:00:00';
            }else{
                value=" ''";
//                addData[nameTmp]='';
            }

            pVars.insertStr+=value;
            pVars.insertStr+=",";

        }
    });

    if(needExec){

        if(pVars.insertStr.lastIndexOf(",") != 0){
            pVars.insertStr=pVars.insertStr.substring(0,pVars.insertStr.length-1);
        }

        pVars.insertStr=pVars.insertStr+" )";

        var params={};
        params["action"]="EasyDBJson";
        params["dbId"]=pVars.dbId;
        params["tableName"]=pVars.tableName;
        params["encode"]="true";
        params["sql"]=Z_EU(pVars.insertStr);
        params["selSql"]=Z_EU(pVars.selStr+" and "+idFieldName+"=");

//    params["pageId"]="true";
//    params["pageSize"]="true";

        $.ajax({
            async :true,
            type : "post",
            url : url,
            dataType : "json",
            data : params,
            success : function(data) {

                try{
                    if (data) {

//                数据不是以Items组织的情况,可以做多个判断
                        var tableTmp=$(pVars.id+"Grid").DataTable();

                        if(data.retcode==0 && "Items" in data && data.Items.length>0){
                            try{
                                tableTmp.row.add(data.Items[0]).draw();
                            }catch(e){
                                logErr("Exception need see log "+e.name + ": " + e.message);
                            }
                            $(pVars.id+'Add').modal('hide');
                        }else{
                            logErr("Exception add failed  "+data +" "+("Items" in data));
                        }
                    }
                    doAddModalClean();
                }catch(exx){
                    logErr("Exception need see log "+exx.name + ": " + exx.message);
                    doAddModalClean();
                }
            },
            error : function(r){
                doAddModalClean();
                logErr("doDelete ajax error");
                alert("doDelete ajax error");
            }
        });
    }*/
};

 $('#example').dataTable( {
        
    } );


/***
 * @TODO
 * 通用，调试完成后分文件，不要加Velocity代码
 */

function doDelete(pVars){

   var params={};
   params.tableName=pVars.tableName;
   //主键默认为id  如不为id 加上params.primarykey
   params.columnValues=pVars.delIdValue;
   commonDelete(params,true,function(data){
         if (data) {
//                数据不是以Items组织的情况,可以做多个判断
                    var tableTmp=$(pVars.id+"Grid").DataTable();
                    if(data.success){
                        try{
                            tableTmp.row('.selected').remove().draw(false);
                        }catch(e){
                            logErr("Exception del need see log "+e.name + ": " + e.message);
                        }
                    }else{
                        logErr("Exception del failed  "+data +" "+data.retcode);
                    }
                }
       
   });
   
   //主键是id 就不用声明主键
    
  /*  var url = pVars.url;
    if(url.indexOf("XmlDBAction.do")!=-1){
        url=urlProc;
    }

    if(!BIsNullVal(pVars.sqlDel)){
        var params={};
        params["action"]="EasyDBJson";
        params["dbId"]=pVars.dbId;
        params["tableName"]=pVars.tableName;
        params["encode"]="true";
        params["sql"]=Z_EU(pVars.sqlDel);

//    params["pageId"]="true";
//    params["pageSize"]="true";

        $.ajax({
            async :true,
            type : "post",
            url : url,
            dataType : "json",
            data : params,
            success : function(data) {
                if (data) {

//                数据不是以Items组织的情况,可以做多个判断
                    var tableTmp=$(pVars.id+"Grid").DataTable();

                    if(data.retcode==0){
                        try{
//                            var selectedRow = DGetSelectedRow( tableTmp );
//                            $(selectedRow).remove().draw(false);

                            tableTmp.row('.selected').remove().draw(false);
                        }catch(e){
                            logErr("Exception del need see log "+e.name + ": " + e.message);
                        }
                    }else{
                        logErr("Exception del failed  "+data +" "+data.retcode);
                    }
                }
            },
            error : function(r){
                logErr("doDelete ajax error");
                alert("doDelete ajax error");
            }
        });
    }*/
};


/***
 * @TODO
 * 通用，调试完成后分文件，不要加Velocity代码
 */

function BCreateDelegate(dparam,method){
    return function() {
        return method.apply(dparam, arguments);
    }
};

function BRegisterExtEvent(sid,tid,sEvent,fnStr,paramStr){
    try{
        var sfn=eval(fnStr);
        for(var j=0;j<sfn.length;j++){
            var fnt=sfn[j];
            var fn=fnt.fn;
            var fp=fnt.fp;
            if(fn){
                var parm={'srcId':sid,'srcEvent':sEvent,'targetId':tid,'fn':fnt};
                //合并参数，以parm为主
                parm=$.extend(fp,parm);
                if(typeof(fn)=='function'){
                    //	obj.removeListener(sEvent,fn,parm);
                    //		obj.on(sEvent,fn,parm);
//						obj.on(sEvent,function(){ fn(parm) });
//                    var callBack = fn.createDelegate(parm,[parm],true);
//                    obj.on(sEvent,callBack,parm);

                    var callback=BCreateDelegate(parm,fn);
                    $("#"+sid).bind(sEvent,parm,callback);

                    log.debug(" register target : id - " + sid + " event : " + sEvent);
                }else{
                    log.error(" fn : " + fn + " is not a function");
                }
            }else{
                log.error(" fn is null");
            }
        }
    }catch(e){
        logErr("Exception BRegisterExtEvent need see log "+e.name + ": " + e.message);
    }


};

/***
 *
 * @desc 指定panel赋值 和清空
 * @todo 只测试了主要类型 , checkbox、radio没测试
 *
 * pVars.id panel id
 * pVars.data 赋值数据
 * pVars.isClear 字符串 "true" 清空此panel
 *
 *
 * @TODO
 * 通用，调试完成后分文件，不要加Velocity代码
 *
 */
function setPanelVal(pVars){
    $('#'+pVars.id+' :input').each(function(index,obj) {
        var type = obj.type;
        var tag = obj.tagName.toLowerCase();
        if(("isClear" in pVars) && pVars.isClear=='true'){
            if (type == 'text' || type == 'password' || tag == 'textarea')
                $(obj).val('');
            else if (type == 'checkbox' || type == 'radio')
                $(obj).attr('checked',false);
            else if (tag == 'select')
                $(obj).attr('selectedIndex',-1);
        }else{
            var vTmp=pVars.data[this.name];
            if(BIsNullVal(vTmp)){
                vTmp='';
            }
            if (type == 'text' || type == 'password' || tag == 'textarea')
                $(obj).val(vTmp);
            else if (type == 'checkbox' || type == 'radio'){
                $(obj).attr('checked',vTmp==''?false:vTmp);
//                this.checked = vTmp==''?false:vTmp;
            }
            else if (tag == 'select'){
                $(obj).attr('selectedIndex',vTmp==''?-1:vTmp);
            }
        }
    });
}
//每页显示条数
function setPageNum(obj){
    var table=$('#yijieshouxinxiGrid').DataTable();
    table.page.len(obj.value).draw();
    //alert(obj.value);
}
//刷新
//function refresh(){
//    var table=$('#test').DataTable();
//    //清空筛选
//    table.search("").draw();
//    $("#shaixuan").val('');
//    //清空数据
//    table.clear().draw();
//    //重新加载数据
//    var data=doSearch();
//    table.rows.add(data).draw(true);
//}


/***
 * @TODO
 * 通用，调试完成后分文件，不要加Velocity代码
 */
function Z_EU(str){
    return str.replace(/([\u0000-\uFFFF])/g, function($0){
        if($0.charCodeAt() <= 16){
            return '2_3000' + $0.charCodeAt().toString(16);
        }
        else if($0.charCodeAt() < 256) {
            return '2_300' + $0.charCodeAt().toString(16);
        }
        else {
            return '2_3' + $0.charCodeAt().toString(16);
        }
    });
} ;


/***
 * @TODO
 * 通用，调试完成后分文件，不要加Velocity代码
 */
function DGetSelectedRow(tableTmp){
    return tableTmp.$('tr.row_selected');
};

/***
 * @TODO
 * 通用，调试完成后分文件，不要加Velocity代码
 */
function BIsNullVal(value) {
    return typeof(value)=="undefined" || value==null ||  (typeof(value)=='string' &&(value=="undefined" || value=='' || value=='null' )) ||  (typeof(value)=='boolean' &&value==false  );
};


/***
 *
 * 获取xmlJsonMap 的字段fieldN 属性confN的值
 *
 * */
function BGetConfVal(tableN,fieldN,confN) {
    if(!BIsNullVal(xmlJsonMap[tableN][fieldN]) && !BIsNullVal(xmlJsonMap[tableN][fieldN][confN])){
        return xmlJsonMap[tableN][fieldN][confN];
    }else{
        return "";
    }
};


/***
 *
 * 判断xmlJsonMap 的字段fieldN是否包含属性confN
 *
 * @TODO
 * 通用，调试完成后分文件，不要加Velocity代码
 *
 */

 function BIsConfValNull(tableN,fieldN,confN) {
    if(!BIsNullVal(xmlJsonMap[tableN][fieldN]) && !BIsNullVal(xmlJsonMap[tableN][fieldN][confN])){
        return false;
    }else{
        return true;
    }
};

/***
 *
 * 获取xmlJsonMap 中满足条件的值
 *
 * @TODO
 * 通用，调试完成后分文件，不要加Velocity代码
 *
 * */
function BGetConditionConfVal(tableN,condition,conVal) {
    for (var fieldTmp in xmlJsonMap[tableN]) {
        if(condition in xmlJsonMap[tableN][fieldTmp] && xmlJsonMap[tableN][fieldTmp][condition]==conVal){
            return xmlJsonMap[tableN][fieldTmp];
        }
    }
    return null;
};



/***
 * 必须处理的严重错误，测试阶段可以alert 生产环境特殊标识写入日志
 * 发现就要分析原因
 * @param err
 */
function logErr(errMsg) {
    log.debug(errMsg);
//    alert(errMsg);
//    PT().log.error(errMsg);
};

function getSelRowNo() {
    try {
        var tableDataTmp=$("#yijieshouxinxiGrid").DataTable();
        return " rowNO : "+tableDataTmp.row('.selected').row().index();
    }catch(e){
        logErr("Exception getSelRowNo need see log "+e.name + ": " + e.message);
    }
};

/***
 * 嵌入ifram可以返回top parent
 * 非嵌入 可以返回 window ...
 * @returns {Window}
 * @constructor
 */
function PT(){
    return window;
//    return parent;
};


//事件测试
function chakanzhengwenButtonCSFun(paramTmp){
    alert("chakanzhengwenButtonCSFun");
};

//
/**
   拼装参数
   需定义好规则 如时间段格式 之后通用此函数
**/
function commonFrom2Json(id){
   var params={};
   var lessThan={};
   var moreThan={};
   var like={};
   var equal={};
   var columnValues={};
   params.lessThan=lessThan;
   params.moreThan=moreThan;
   params.like=like;
   params.equal=equal;
   params.columnValues=columnValues;
   $('#'+id+' :input').each(function(index,obj) {
        var type = obj.type;
        var tag = obj.tagName.toLowerCase();
        var $obj=$(obj);
        if (type == 'text' || type == 'password' || tag == 'textarea'||tag == 'select'){
            var sType=$obj.attr('data-sType');
            if(sType=="equal"){
              equal[$obj.attr('name')]=$obj.attr('name');
            
            }else if(sType=="moreThan"){
               var  nameTmp=$obj.attr('name');
               nameTmp= nameTmp.substring(0,nameTmp.lastIndexOf('timebegin"'));
               moreThan[$obj.attr('name')]=nameTmp;
            }else if(sType=="lessThan"){
               var  nameTmp=$obj.attr('name');
               nameTmp= nameTmp.substring(0,nameTmp.lastIndexOf('timeend'));
               lessThan[$obj.attr('name')]=nameTmp;
            } else{
                 //默认为like
                 like[$obj.attr('name')]=$obj.attr('name');
            }
            columnValues[$obj.attr('name')]=$obj.val();
            
          }  
      //TODO checkbox   处理
        

    });
  
   return params;
}

</script>
</head>
<body>

<div  style="margin:18px 25px 0px 25px;">
    <a href="javascript:;;" role="button" style="margin-top: 5px;margin-right: 10px;" class="btn yijieshouxinxiBtnSearch pull-left" ><i class="icon-search"></i> 搜索</a>
            <a href="javascript:;;" role="button" style="margin-top: 5px;margin-right: 10px;" class="btn yijieshouxinxiBtnAdd pull-left" ><i class="icon-book"></i>添加</a>
            <a href="javascript:;;" role="button" id="chakanzhengwenButtonYJS" style="margin-top: 5px;margin-right: 10px;" class="btn chakanzhengwenButtonYJS pull-left" ><i class="icon-search"></i>查看正文</a>
            <a href="javascript:;;" role="button" id="chakanzhengwenButtonCS" style="margin-top: 5px;margin-right: 10px;" class="btn chakanzhengwenButtonCS pull-left" ><i class="icon-search"></i>测试按钮</a>
    
    <!--<button type="button" class="btn pull-right" style="margin-top: 5px;" onclick="refresh()"><i class="icon-download"></i>刷新</button>-->
    <div id="yijieshouxinxiColvis"></div>
    <select name="yijieshouxinxipageSize" id="yijieshouxinxipageSize" style="width:70px;margin-top: 5px;margin-right: 10px;" class="pull-right" onchange="setPageNum(this)">
        <option selected="selected" value="10">
            10
        </option>
        <option value="30" >
            30
        </option>
        <option value="50" >
            50
        </option>
        <option value="100" >
            100
        </option>
        <option value="200" >
            200
        </option>
        <option value="500" >
            500
        </option>
        <option value="1000" >
            1000
        </option>
        <option value="-1" >
            全部
        </option>
    </select>
    <span class="pull-right" style="margin:8px 10px 0px 10px;">每页显示:</span>
</div>

<table width="1000" style="margin-bottom: 0px" class="table table-striped table-bordered"
       id="yijieshouxinxiGrid" cellspacing="0">
</table>


<!--@todo: .form-horizontal ie兼容模式无法正常显示-->

<div id="yijieshouxinxiSearch" class='container-fluid modal hide' style='padding: 0px;' role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class='row-fluid '  >
          <form id="yijieshouxinxiSearchForm"> 
            <div class='span12' style='padding: 10px;'>
            <br>

                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >生成时间 从:</span>
                            <div class="input-append date form_datetime generateTime_datetime">
                               <!-- data-sType 代表条件类型 ,  lessThan / moreThan /like / equal/ not equal  -->
                                <input type="text" id="generateTimetimebegin" name="generateTimetimebegin" data-sType="moreThan"   >
                                <span class="add-on"><i class="icon-th"></i></span>
                            </div>
                        </div>

                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >到:</span>
                            <div class="input-append date form_datetime generateTime_datetime">
                                <input type="text" id="generateTimetimeend" name="generateTimetimeend" data-sType="lessThan" >
                                <span class="add-on"><i class="icon-th"></i></span>
                            </div>
                        </div>
                    
                       <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;"  >重要程度:</span>
                            <input type="text" id="msgImportLevel" name="msgImportLevel" data-sType="like" >
                        </div>
                    
                       <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;"  >是否阅读:</span>
                            <input type="text" id="readFlag" name="readFlag"  data-sType="like">
                        </div>
                    
                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;"   >消息失效时间 从:</span>
                            <div class="input-append date form_datetime msgEndTime_datetime">
                                <input type="text" id="msgEndTimetimebegin" name="msgEndTimetimebegin" data-sType="moreThan" >
                                <span class="add-on"><i class="icon-th"></i></span>
                            </div>
                        </div>

                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;"   >到:</span>
                            <div class="input-append date form_datetime msgEndTime_datetime">
                                <input type="text" id="msgEndTimetimeend" name="msgEndTimetimeend" data-sType="lessThan">
                                <span class="add-on"><i class="icon-th"></i></span>
                            </div>
                        </div>
                    
                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;"   >消息标识:</span>
                            <input type="text" id="msgId" name="msgId" data-sType="like" >
                        </div>
                    
                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;"  >消息生效时间 从:</span>
                            <div class="input-append date form_datetime msgBeginTime_datetime">
                                <input type="text" id="msgBeginTimetimebegin" name="msgBeginTimetimebegin"  data-sType="moreThan">
                                <span class="add-on"><i class="icon-th"></i></span>
                            </div>
                        </div>

                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;"  >到:</span>
                            <div class="input-append date form_datetime msgBeginTime_datetime">
                                <input type="text" id="msgBeginTimetimeend" name="msgBeginTimetimeend" data-sType="lessThan" >
                                <span class="add-on"><i class="icon-th"></i></span>
                            </div>
                        </div>
                    
                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;"  >发信人:</span>
                            <input type="text" id="msgSender" name="msgSender" data-sType="like" >
                        </div>
                    
                            
            <a href="javascript:;;" role="button" style="margin-top: 5px;margin-right: 10px;" class="btn yijieshouxinxiBtnSearchSubmit" ><i class="icon-book"></i>提交</a>
         
            <a href="javascript:;;" role="button" style="margin-top: 5px;margin-right: 10px;" class="btn yijieshouxinxiBtnSearchClose" ><i class="icon-book"></i>关闭</a>
         </form>
        </div>
       
    </div>


<div id="yijieshouxinxiAdd" class='container-fluid modal hide' style='padding: 0px;' role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class='row-fluid '  >
        <div class='span12' style='padding: 10px;'>
            <br>
                <form id="yijieshouxinxiAddForm">
                    <div class='span12' style="display:none";>
                        <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >数据标识:</span>
                        <input type="text" isDataId="true" id="id" name="id" >
                    </div>
                
                            
                     <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >消息标题:</span>
                            <textarea id="msgTitle" name="msgTitle"></textarea>
                     </div>
                    
                
                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >收信人:</span>
                            <input type="text" id="msgReceiver" name="msgReceiver" >
                        </div>
                    
                
                         <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >重要程度:</span>
                            <input type="text" id="msgImportLevel" name="msgImportLevel" >
                        </div>
                    
                
                         <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >是否阅读:</span>
                            <input type="text" id="readFlag" name="readFlag" >
                        </div>
                    
                
                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >消息失效时间:</span>
                            <div class="input-append date form_datetime msgEndTime_datetime">
                                <input type="text" id="msgEndTime" name="msgEndTime" >
                                <span class="add-on"><i class="icon-th"></i></span>
                            </div>
                        </div>
                    
                
                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >消息标识:</span>
                            <input type="text" id="msgId" name="msgId" >
                        </div>
                    
                
                        <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >消息正文:</span>
                            <textarea id="msgContent" name="msgContent"></textarea>
                        </div>
                        <div class='span12'>
	                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >消息生效时间:</span>
	                            <div class="input-append date form_datetime msgBeginTime_datetime">
	                                <input type="text" id="msgBeginTime" name="msgBeginTime" >
	                                <span class="add-on"><i class="icon-th"></i></span>
	                            </div>
                        </div>
                         <div class='span12'>
                            <span class="span5" style="padding-top: 8px;padding-bottom: 4px;" >发信人:</span>
                            <input type="text" id="msgSender" name="msgSender" >
                        </div>
                    
                </form>
            <a href="javascript:;;" role="button" style="margin-top: 5px;margin-right: 10px;" class="btn yijieshouxinxiBtnAddSubmit" ><i class="icon-book"></i>提交</a>
            <a href="javascript:;;" role="button" style="margin-top: 5px;margin-right: 10px;" class="btn yijieshouxinxiBtnAddClose" ><i class="icon-book"></i>关闭</a>
        </div>
    </div>
</div>

</body>
</html>
