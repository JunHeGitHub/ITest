<!DOCTYPE  HTML>
<html lang="en">
	<head>
		<title>自定义信息管理页面</title>

		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3" />
		<meta http-equiv="description" content="this is my page" />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<link rel="stylesheet" href="../../css/bootstrap.min.css" type="text/css"></link>
		<link rel="stylesheet"
			href="../../js/dataTables/css/jquery.dataTables.css" type="text/css"></link>
		<!-- bootstrap 与 datatable结合 -->
		<link rel="stylesheet" href="../../js/dataTables/css/DT_bootstrap.css"
			type="text/css"></link>
		<!-- 工具 -->
		<link rel="stylesheet"
			href="../../js/dataTables/css/dataTables.tableTools.min.css"
			type="text/css"></link>
		<!-- 动态列CSS -->
		<link rel="stylesheet" href="../../demo/unicorn.main.css" type="text/css"></link>
		<link rel="stylesheet" href="../../js/dataTables/css/font-awesome.css"></link>
		<link rel="stylesheet"
			href="../js/dataTables/css/dataTables.colVis.min.css" type="text/css"></link>
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/bootstrap.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/jquery.dataTables.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.colReorder.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.colVis.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.tableTools.min.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/DT_bootstrap.js"></script>
		<script type="text/javascript" src="../../js/appCommonUtil.js"></script>
		<script type="text/javascript" src="../../js/common_utils.js"></script>
		<!--zTree-->
		<link rel="stylesheet" href="../../js/zTree/zTreeStyle/zTreeStyle.css" type="text/css" />
		<script type="text/javascript" src="../../js/zTree/jquery.ztree.all-3.5.min.js"></script>
<style type="text/css">
#treeDemo.ztree {border: 1px solid #617775;background: #f0f6e4;width:220px;height:180px;overflow: auto;}
		dl {margin: 0;padding: 0;margin-left: -100px;}
		dl dt{
			line-height: 30px;
}

#test tr td:first-child {
	text-align: center;
}

/* fa-square-o */
#test tr td:first-child:before {
	content: "\f096";
	font-family: FontAwesome;
}

#test tr.active td:first-child:before {
	content: "\f046"; /* fa-check-square-o */
}

#update ul li {
	float: left;
	margin-left: 16px;
	list-style: none;
}

.setLine-height {
	line-height: 30px;
}
</style>
<script type="text/javascript">
var ZKM = "ZKM";
//ztree
	var setting = {
		view: {
			dblClickExpand: false
		},
		data: {
			key:{
				name:'text'
			},
			simpleData: {
				enable: true
			}
		},
		callback: {
			onClick: onClick
		}
	};
	function onClick(e, treeId, treeNode) {
		var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
		nodes = zTree.getSelectedNodes();
		idStr ="";
		textStr = "";
		for (var i=0, l=nodes.length; i<l; i++) {
			idStr +=nodes[i].id+",";
			textStr += nodes[i].text + ",";
		}
		if (textStr.length > 0 ){ 
			textStr = textStr.substring(0, textStr.length-1);
		}
		if (idStr.length > 0 ){ 
			idStr = idStr.substring(0, idStr.length-1);
		}
		var nameObj = $("#update #templateTypeName");
		var idObj=$("#update #templateTypeId");
		nameObj.val(textStr);
		idObj.val(idStr);
		//hideMenu();
	}
		function showMenu() {
			var nameObj = $("#templateTypeName");
			var Offset = $("#templateTypeName").offset();
			$("#menuContent").css({left:Offset.left + "px", top:Offset.top + nameObj.outerHeight() + "px"}).slideDown("fast");
			$("body").bind("mousedown",onBodyDown);
		}
		function hideMenu() {
			$("#menuContent").fadeOut("fast");
			$("body").unbind("mousedown", onBodyDown);
		}
		function onBodyDown(event) {
			if (!(event.target.id == "menuBtn" || event.target.id == "menuContent" || $(event.target).parents("#menuContent").length>0)) {
				hideMenu();
			}
		}
		function getTemplateTreeData(){
			var url = "/" + window.top.PRJ_PATH + "/" +ZKM+"/TreeDataMapper" + "/" + "getTemplateTree.action";
   			var rdata=[];
   			ajaxFunction(url,null,false,
   				function(data){
   					rdata = data.data;
   			});
   			return rdata;
		}
$(document).ready(function() {
  var nodes = getTemplateTreeData();
  $.fn.zTree.init($("#treeDemo"),setting,nodes);
  clearForm('templateForm');
  var data=doSearch(); 
  $('#test').dataTable({
        //滚动条 
        //scrollY: 500,
       //scrollX: false,
        bPaginate: true, //翻页功能
		bLengthChange: false, //改变每页显示数据数量
		bFilter: true, //过滤功能
		bSort: true, //排序功能
		bInfo: true,//页脚信息
		bAutoWidth: false, //自动宽度
		sPaginationType: "bootstrap",//分页样式
		//"sDom":"<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>" ,
		//数据赋值
		data:data,
	   // dom: 'Rlfrtip',
	    dom: 'TRlrtip',
	   // dom: 'T<"clear">lfrtip',
	    //自定义列插件
       // colVis: {
       //    order: 'alpha',
       //    buttonText: "自定义显示列"
       // },
        order: [ 1, 'asc' ],
		columns: [
		 /*{ "title": 
		   "<input type='checkbox' id='selectall' onclick='toggleChecks(this);' ></input>",
		    "mDataProp": null, 
		    "sWidth": "20px", 
		    "sDefaultContent": "<input type='checkbox' class='case' onChange='setSelect()' ></input>",
		     "bSortable": false 
	
		     },*/
			{ title:"<input type='checkbox' id='selectall' onclick='toggleChecks(this);' ></input>",data: null, defaultContent: '', orderable: false,width:15},
			{ 
			  title:"id" ,
			  data: 'id',
			  visible: false,
			  searchable: false
			},
			/**title 表头  data json 对应key **/
	        {"title":"模板名称" ,data: 'name',className: "my_class" },
	        {"title":"模板分类Id",data:'templateTypeId',visible:false},
	         {"title":"模板分类",data:'templateTypeName'},
	        {"title":"模板类型",data:'templateType'},
	        {"title":"模板文本总长度",data:'maxSize'}
	        
        ],
        //列 行高亮显示
        createdRow: function ( row, data, index ) {
           // if ( data[5].replace(/[\$,]/g, '') * 1 > 4000 ) {
               // alert("123");
                //$('td', row).eq(2).addClass('red');
           // }
           
           /*修改列*/
           var v = $('td', row).eq(3).text();
           if(v=='static'){
    		  $('td', row).eq(3).text('静态');
    	   }else if(v=='dynamic'){
    		  $('td', row).eq(3).text('动态');
    	   }
    	  var text='';
    	  var array = data.templateTypeId.split(',');
    	  for(var i in array){
	    	  	var url ="/"+window.top.PRJ_PATH+"/"+ZKM+"/TreeDataMapper" + "/" + "getTreeNodeText.action";
	    	  	var pat ={};
	    	  	pat.id=array[i];
	    	  	ajaxFunction(url,pat,false,function(v){
	    	  		if(v.data.length>0){
	    	  			text+=v.data[0].text+",";
	    	  		}else{
	    	  			text='';
	    	  		}
	    	  	});
    	  }
    	  data.templateTypeName=text.substr(0,text.length-1);
    	  $('td', row).eq(2).text(text.substr(0,text.length-1));
        } ,
        //列筛选等属性 样式 可以与columns属性合并
        //columnDefs: [ {
		     //"targets": -1,
		     //"defaultContent": "<button>编辑</button>",
		      //data:null
	          //} ,
	          //{
                // The `data` parameter refers to the data for the cell (defined by the
                // `data` option, which defaults to the column being worked with, in
                // this case `data: 0`.
                //render: function ( data, type, row ) {
                    //return data +' (单元格格式化)';
                //},
                //"targets": 3
            //}
	    
	    //],
        oLanguage: {
			"sLengthMenu": "每页显示 _MENU_条",
			"sZeroRecords": "没有找到符合条件的数据",
			"sProcessing": "&lt;imgsrc=’./loading.gif’ /&gt;",
			"sInfo": "当前第 _START_ - _END_ 条　共计 _TOTAL_ 条",
			"sInfoEmpty": "木有记录",
			"sInfoFiltered": "(从 _MAX_ 条记录中过滤)",
			"sSearch": "搜索：",
			"oPaginate": {
			"sFirst": "首页",
			"sPrevious": "前一页",
			"sNext": "后一页",
			"sLast": "尾页"
		    }
        }, tableTools: {
          //single 单选 multi 多选  os 可以按ctrl 选择
           // sRowSelect:'multi',
           //回调 单选
            fnRowSelected: function ( nodes ) {
               var index=nodes[0]._DT_RowIndex;	
               var data = table.row(index).data();
               initForm(data);
               //alert(JSON.stringify(data));
            },
             sRowSelect:'os',
            //sRowSelector:'td:first-child',
            aButtons:     [ /*{
                "sExtends":    "select_all",
                "sButtonText": "选择全部",
                "target":      "#select"
              } , 'select_none' */]
        }
    }); 
     //绑定事件 on
     var table= $('#test').DataTable();
	 $('#test tbody').on( 'click','button', function (obj) {
	    var data = table.row( $(this).parents('tr') ).data();
        alert(JSON.stringify(data));
	} );
    //工具栏与bootstarp 结合
   // var tt = new $.fn.dataTable.TableTools(table);
  //  $(tt.fnContainer()).insertBefore('#tools');
    
  //筛选绑定
    $('#shaixuan').on( 'keyup', function () {
       table.search( this.value ).draw();
    
    });
    //自定义列插件绑定
     var colvis = new $.fn.dataTable.ColVis(table,{ buttonText: '自定义显示列',exclude: [ 0 ,1] });
});
function tableSearch(){
    var table=$('#test').DataTable();
    var value=$("#shaixuan").val();
    table.search(value).draw(true);
}

//================模板开始=====================
var templateId;
//查询所有模板数据
function doSearch(){
var url = "/"+window.top.PRJ_PATH+"/"+ZKM+"/CustomText/getTemplate.action";
    var rdata=[];
   	ajaxFunction(url,null,false,function(data){
   		for(var i in data.rows){
   			url="/"+window.top.PRJ_PATH+"/"+ZKM+"/TreeDataMapper/getDataByDataId.action";
   			var pat ={}
   			pat.dataId=data.rows[i].id;
   			var nodeIds='';
   			ajaxFunction(url,pat,false,function(d){
				for(var j in d[pat.dataId]){
					nodeIds+=d[pat.dataId][j].nodeId+',';
				}
   				data.rows[i].templateTypeId=nodeIds.substr(0,nodeIds.length-1);
   				data.rows[i].templateTypeName='';
   			});
   		}
   		rdata = data.rows;
   });
   return rdata;
}
var templateType;
//打开添加静态态模板
function openStaticAdd(){
	templateId='';
	$("#btn_CustomTextTemplate_dynamic_tianjia,#btn_CustomTextTemplate_static_tianjia,#btn_CustomTextTemplate_xiugai,#showBtn,#showTemplate,#dynamicTemp,#showStr").addClass("hide");
	$("#templateForm,#btn_CustomTextTemplate_baocun,#addTemplate,#btn_CustomTextTemplate_chongzhi,#staticTemp,#tempContent").removeClass("hide");
	$("#templateForm #tempDataTab,#templateForm #showStr font").html("");
	clearForm('templateForm');
	templateType='static';
	
}
//打开添加动态模板
function openDynamicAdd(){
	templateId='';
	$("#btn_CustomTextTemplate_dynamic_tianjia,#btn_CustomTextTemplate_static_tianjia,#btn_CustomTextTemplate_xiugai,#showTemplate,#staticTemp,#tempContent").addClass("hide");
	$("#templateForm,#btn_CustomTextTemplate_baocun,#addTemplate,#showBtn,#btn_CustomTextTemplate_chongzhi,#dynamicTemp,#showStr,#tempDataTab").removeClass("hide");
	$("#templateForm #tempDataTab,#templateForm #showStr font").html("");
	clearForm('templateForm');
	templateType='dynamic';
	
}
//保存模板
function saveTemplate(){
	var flag=validationData();
	if(flag==false){
		return;
	}
	if(templateId!=''){
		//解绑数据
		//注意DataTable大写 或者 $('#test').dataTable().api();
     	var table=$('#test').DataTable();
   		//获取选中行 通过dataTable查找
     	var cell=table.rows(".active").data();
    	//通过table TableTools插件 查找
     	var tt = new $.fn.dataTable.TableTools(table);
     	var selectData=tt.fnGetSelectedData();
     	if(selectData.length>1){
     		zinglabs.alert("只能选择一条记录进行修改操作");
     		return;
     	}else{
     		//删除模板
			var pat ={};
			var url="/" +window.top.PRJ_PATH+ "/"+ZKM+"/CustomText/deleteTemplate.action";
			pat.dataIdList='"'+templateId+'"';
			ajaxFunction(url,pat,false);
			url = "/" + window.top.PRJ_PATH + "/" +ZKM+"/CustomText/deleteTemplateDataByTemplateId.action";
			ajaxFunction(url,pat,false);
     		var nodeIdStr="";
     		for(var i in selectData){
     			nodeIdStr+=selectData[i].templateTypeId+",";
     		}
			nodeIdStr=nodeIdStr.substr(0,nodeIdStr.length-1);
			pat.beanName="treeDataFilterImpl";
			pat.nodeIdList=nodeIdStr;
			pat.dataIdList=templateId;
			unbundlingData(pat);
     	}
	}
	var url = "/" + window.top.PRJ_PATH + "/" +ZKM+"/CustomText/addTemplate.action";
	var params = zkm_getHtmlFormJsons("templateForm");
	params.templateType=templateType;
	delete params.templateTypeName;
	ajaxFunction(url,params,false,function(data){
		if(data.success){
			templateId=data.id;
			//绑定数据
			var d = {};
			nodeIdStr=$("#update #templateTypeId").val();
			d.beanName="treeDataFilterImpl";
			d.nodeIdList=nodeIdStr;
			d.dataIdList=templateId;
			bundlingData(d);
			saveTemplateData();
			zinglabs.alert("保存模板成功");
			refresh();
		}else{
			zinglabs.alert("保存模板失败");
		}
	});
	
}
//删除模板
function deleteTemplate(selectData){
	zinglabs.confirm("确认删除数据吗？",function(){
		var dataIdList = '';
		var nodeIdList = '';
     	for (var i in selectData) {
		dataIdList = dataIdList+'"'+selectData[i].id+'"'+',';
		nodeIdList = nodeIdList+selectData[i].templateTypeId+',';
	}
	dataId=dataIdList.substr(0,dataIdList.length-1);
	nodeIdList=nodeIdList.substr(0,nodeIdList.length-1);
	var url = "/" + window.top.PRJ_PATH + "/" +ZKM+ "/CustomText/deleteTemplate.action";
	var params = {};
	params.dataIdList=dataId;
	params.nodeIdList=nodeIdList;
	params.beanName="treeDataFilterImpl";
	//删除模板
	ajaxFunction(url,params,false);
	//删除模板关联数据
	url="/" +window.top.PRJ_PATH+"/"+ZKM+"/CustomText/deleteTemplateDataByTemplateId.action";
	ajaxFunction(url,params,false);
	//解绑数据
	unbundlingData(params);
	refresh();
	zinglabs.alert("删除模板成功");
    });
}

//================模板结束=====================

//================模板数据开始=====================
//查看模板数据
function showTemplateData(){
		$("#templateForm #tempDataTab").html("");
		var url ="/" + window.top.PRJ_PATH + "/"+ZKM+"/CustomText/getTemplateDataByTemplateId.action";
		var params = {};
		params.templateId = templateId;
		ajaxFunction(url,params,false,function(data){
			if(templateType=='静态'||templateType=='static'){
				$("#showBtn,#showStr,#tempDataTab,#dynamicTemp").addClass("hide");
				$("#tempContent,#staticTemp").removeClass("hide").val(data.rows[0].content);
				return;
			}
			if(templateType=='动态'||templateType=='dynamic'){
				$("#tempContent,#staticTemp").addClass("hide");
				$("#showBtn,#showStr,#tempDataTab,#dynamicTemp").removeClass("hide");
				var str = "";
				for(var i in data.rows){
					if(data.rows[i].type=='constant'){
						str +=data.rows[i].content;
					}else if(data.rows[i].type=='variable'){
						str+="["+data.rows[i].content+"]";
					}
					if(data.rows[i].type=='constant'){
						$("#templateForm #tempDataTab").append("<tr><td><input type='checkbox' id='chkBox'/>常量:</td><td><input type='text' id='temp_content' name='content' "
						+"value='"+data.rows[i].content+"' onchange='getStr()' style='width:1205px'/><input type='hidden' name='type' value='constant'/><input type='hidden' name='templateId' value='"+data.rows[i].id+"'/></td></tr>");
					}
					if(data.rows[i].type=='variable'){
						$("#templateForm #tempDataTab").append("<tr><td><input type='checkbox' id='chkBox'/>变量:</td><td><input type='text' name='content' value='"+data.rows[i].content+"' onchange='getStr()' style='width:1205px'/>"
						+"<input type='hidden' name='type' value='variable'/><input type='hidden' name='templateId' value='"+data.rows[i].id+"'/></td></tr>");
					}
				}
				$("#templateForm #showStr font").html(str);
				return;
			}
		});
}
//添加常量
function addConstant(){
	$("#templateForm #tempDataTab").append("<tr><td align='right'><input type='checkbox' id='chkBox'/>常量:</td><td><input type='text' name='content' onchange='getStr()' style='width:1205px'/>"
	+"<input type='hidden' name='type' value='constant'/><input type='hidden' name='templateId' value='0'/></td></tr>");
	getStr();
}
//添加变量
function addVariable(){
	$("#templateForm #tempDataTab").append("<tr><td align='right'><input type='checkbox' id='chkBox'/>变量:</td><td><input type='text' name='content' onchange='getStr()' style='width:1205px'/>"+
	"<input type='hidden' name='type' value='variable'/><input type='hidden' name='templateId' value='0'/></td></tr>");
	getStr();
}
//保存数据
function saveTemplateData(){
	var params={};
	params.templateId=templateId;
	url = "/" + window.top.PRJ_PATH + "/" +ZKM+"/CustomText/addTemplateData.action";
	if(templateType=='静态'||templateType=='static'){
		var content = $("#tempContent").val();
		params.content=content;
		params.type="constant";
		params.viewIndex=0;
		ajaxFunction(url,params,false);
		return;
	}
	if(templateType=='动态'||templateType=='dynamic'){
		var array=new Array();
		$("#templateForm #tempDataTab input").each(function(){
			array.push($(this).val());
		});
		var number=1;
		for(var i in array){
			if(i%4==1){
				params.content=array[i];
			}
			if(i%4==2){
				params.type=array[i];
				params.viewIndex=number;
				ajaxFunction(url,params,false);
				number++;
			}
		}
		return;
	}
	
}

//实时获取拼接内容
function getStr(){
	var array=new Array();
	$("#templateForm #tempDataTab input").each(function(){
		array.push($(this).val());
	});
	var str='';
	for(var i in array){
		if(array[i]=='constant'){
			str +=array[i-1];
		}else if(array[i]=='variable'){
			str+="["+array[i-1]+"]";
		}
	}	
	$("#templateForm #showStr font").html(str);	
}
//全选
function selectAllChkBox(){
	$("#templateForm #tempDataTab #chkBox").each(function(){
		$(this).attr('checked','checked');
	});
}
//删除表单
function deleteInput(){
	$("#templateForm #tempDataTab #chkBox").each(function(){
		if($(this).is(':checked')){
			var obj=$(this).parent();
			obj.parent().remove();
		};
	});
	getStr();
}
//重置数据
function refreshData(){
	$("#templateForm #tempDataTab").html("");
	$("#templateForm #showStr font").html("");
}

//验证数据
function validationData(){
	var name = $("#templateForm #name").val();
	var templateTypeName = $("#templateForm #templateTypeName").val();
	var maxSize = $("#templateForm #maxSize").val();
	if(name==''||name==undefined){
		zinglabs.alert("模板名称不能为空");
		return false;	
	}
	if(templateTypeName==''||templateTypeName==undefined){
		zinglabs.alert("模板分类不能为空");
		return false;	
	}
	if(maxSize==""||maxSize==undefined){
		zinglabs.alert("文本长度总不能为空");
		return false;
	}else{
		if(!(/^[0-9]*$/.test(maxSize))){
			zinglabs.alert("文本总长度只能是数字");
			return false;
		}
	}
	var array=new Array();
	$("#templateForm #tempDataTab input").each(function(){
		array.push($(this).val());
	});
	var str="";
	if(templateType=='动态'||templateType=='dynamic'){
		if(array.length>0){
			for(var i in array){
				if(array[i]=='constant'){
					if(array[i-1]==undefined||array[i-1]==''){
						zinglabs.alert("常量不能为空");
						return false;
					}else{
						str+=array[i-1];
					}
				}else if(array[i]=='variable'){
					if(array[i-1]==undefined||array[i-1]==''){
						zinglabs.alert("变量不能为空");
						return false;
					}else{
						str+=array[i-1];
					}
				}
			}
		}
	}
	if(templateType=='静态'||templateType=='static'){
		str=$("#tempContent").val();
		if(str==''||str==undefined){
			zinglabs.alert("静态模板中数据不能为空");
			return false;
		}
	}
	var maxSize = $("#templateForm #maxSize").val();
	if(str.length>maxSize){
		zinglabs.alert("超出文本大小限制");
		return false;
	}
	return true;
}
//================模板数据结束=====================
//获取选中行
function fnGetSelected(){
    //注意DataTable大写 或者 $('#test').dataTable().api();
     var table=$('#test').DataTable();
 //   var data =table.column().data();
    //获取选中行 通过dataTable查找
     var cell=table.rows(".active").data();
    //通过table TableTools插件 查找
     var tt = new $.fn.dataTable.TableTools(table);
     var selectData=tt.fnGetSelectedData();
     if(selectData.length==0){
     	zinglabs.alert("请选择要删除的数据");
     }else{
     	deleteTemplate(selectData);
     }
    
    //alert( JSON.stringify(selectData) );
    //console.log( JSON.stringify(selectData));
}
//全选
 function toggleChecks(obj){
       var table=$('#test').DataTable();
       var tableTools = new $.fn.dataTable.TableTools(table);
       var ischeck=$("#selectall").is(':checked');
       if(ischeck){
         tableTools.fnSelectAll();
       }else{
         tableTools.fnSelectNone();
       }
    }
	function initForm(data){
				clearForm('templateForm');
				$("#btn_CustomTextTemplate_baocun,#addTemplate,#btn_CustomTextTemplate_chongzhi").addClass("hide");
				$("#templateForm,#showTemplate,#btn_CustomTextTemplate_static_tianjia,#btn_CustomTextTemplate_dynamic_tianjia,#btn_CustomTextTemplate_xiugai").removeClass("hide");
				var cfs=$("#templateForm input[name],textarea[name]");
				templateId=data["id"];
				templateType=data["templateType"];
				for(var i=0;i<cfs.length;i++){
					var e=cfs[i];					
					var v=data[e.name];
					if(v==undefined || v==null){
						v='';
					}
					$(e).val(v);
				}
				showTemplateData();
   }
//每页显示条数
function setPageNum(obj){
  var table=$('#test').DataTable();
  table.page.len(obj.value).draw();
  //alert(obj.value);
}
//刷新
function refresh(){
	 clearForm('templateForm');
	 $("#btn_CustomTextTemplate_baocun,#btn_CustomTextTemplate_xiugai,#showBtn,#btn_CustomTextTemplate_chongzhi,#templateForm,#addTemplate,#showTemplate").addClass("hide");
	 $("#btn_CustomTextTemplate_static_tianjia,#btn_CustomTextTemplate_dynamic_tianjia").removeClass("hide");
     var table=$('#test').DataTable();
     //清空筛选
     table.search("").draw();
     $("#shaixuan").val('');
     //清空数据
     table.clear().draw();
     //重新加载数据
     var data=doSearch(); 
     table.rows.add(data).draw(true);
}

//清空表单
function clearForm(formName){
  refreshData();
  var cfs=$("#"+formName+" input[name],#"+formName+" select[name] ");
  cfs.val('');
  $("#"+formName+" textarea").val('');
}
</script>
	</head>
	<body style="overflow:auto;">
		<!-- 头 -->
		<div class="widget-box collapsible">
			<div class="widget-title"
				style="height: 40px; line-height: 40px; overflow: hidden;" id="t">
				<span class="icon" style="float: left; padding: 0px 10px;"> <i
					class="icon-search"></i> </span>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
				<input id="shaixuan" name="shaixuan" type="text" maxlength="500"
					class="input-medium search-query" value="" />
				&nbsp;&nbsp;&nbsp;
				<!--  <button id="btn_suSecurityUser_sousuo" type="button" class="btn" onclick="tableSearch();">
					<i class="icon-search"></i> 搜 索
				</button>-->
				&nbsp;&nbsp;&nbsp;每页显示条数：
				<select name="pageSize" id="pageSize"
					style="width: 80px; margin-bottom: 0px;"
					onchange="setPageNum(this)">
					<option selected="selected" value="10">
						10
					</option>
					<option value="30">
						30
					</option>
					<option value="50">
						50
					</option>
					<option value="100">
						100
					</option>
					<option value="-1">
						全部
					</option>
				</select>
				<div id="cols"></div>
			</div>
		</div>
		<!-- class 或 = display -->
		<table width="100%" class="table table-striped table-bordered"
			id="test" cellspacing="0">
		</table>
		<!-- 头 -->
		<div class="widget-box collapsible">
			<div class="widget-title"
				style="height: 40px; line-height: 40px; overflow: hidden;">
				<span class="icon" style="float: left; padding: 0px 10px;"> <i
					class="icon-cog"></i> </span>&nbsp;&nbsp;&nbsp;
				<button id="btn_CustomTextTemplate_static_tianjia" class="btn"
					onclick="openStaticAdd()">
					<i class="icon-plus"></i>新建静态模板
				</button>
				<button id="btn_CustomTextTemplate_dynamic_tianjia" class="btn"
					onclick="openDynamicAdd()">
					<i class="icon-plus"></i>新建动态模板
				</button>
				<button id="btn_CustomTextTemplate_shanchuyonghu" type="button"
					class="btn" onclick="fnGetSelected()">
					<i class="icon-remove"></i>删除模板
				</button>
				<button id="btn_CustomTextTemplate_chongzhi" type="reset"
					class="btn hide" onclick="clearForm('templateForm');">
					<i class="icon-repeat"></i>重置
				</button>
				<button id="btn_CustomTextTemplate_shuaxin" type="button"
					class="btn" onclick="refresh()">
					<i class="icon-refresh"></i>刷新
				</button>
				<a href="tree_data_msg.html" class="btn">树与数据绑定测试</a>
				<a href="UseCustomTextDemo.html" class="btn">使用自定义数据测试</a>
			</div>
		</div>
		<div style="width: 1366px;">
			<form class="form-horizontal hide" id="templateForm">
				<input type="hidden" id="id" name="id" />
				<!-- 栅格布局 -->
				<div style="text-align: center;">
					<h4>
						<span id="addTemplate" class="hide">新建</span><span
							id="showTemplate" class="hide">查看(修改)</span>自定义信息<span id="staticTemp" class="hide">静态</span><span id="dynamicTemp" class="hide">动态</span>模板
					</h4>
					<hr width="1230px">
					<button id="btn_CustomTextTemplate_xiugai" type="button"
						class="btn hide" onclick="saveTemplate()">
						<i class="icon-pencil"></i>保存模板
					</button>
					<button id="btn_CustomTextTemplate_baocun" type="button"
						class="btn hide" onclick="saveTemplate()">
						<i class="icon-ok"></i>保存模板
					</button>
					<span id="showBtn" class="hide">
						<button type="button" class="btn" onclick="addConstant()">
							<i class="icon-plus"></i>添加常量
						</button>
						<button type="button" class="btn" onclick="addVariable()">
							<i class="icon-plus"></i>添加变量
						</button>
						<button type="button" class="btn" onclick="selectAllChkBox()">
							<i class="icon-ok"></i>全选
						</button>
						<button type="button" class="btn" onclick="deleteInput()">
							<i class="icon-remove"></i>删除
						</button> </span>
					<hr width="1230px">
				</div>
				<div id="update" class="row">
					<ul>
						<li class="setLine-height">
							模板名称:
						</li>
						<li>
							<input type="text" id="name" name="name" style="width:225px;"" />
						</li>
						<li class="setLine-height" style="margin-left: 10%">
							模板分类:
						</li>
						<li>
							<input type="hidden" id="templateTypeId" name="templateTypeId"/>
							<input type="text" id="templateTypeName" name="templateTypeName" readonly style="width:225px;"/>
						</li>
						<li class="setLine-height">
							<a id="menuBtn" href="#" onclick="showMenu(); return false;">选择</a>
						</li>
						<li class="setLine-height" style="margin-left:10%">
							文本总长度:
						</li>
						<li>
							<input type="text" id="maxSize" name="maxSize" style="width:225px;"/>
						</li>
					</ul>
					<div class="pull-left" style="width: 100%;" align="center">
						<h4>
							模板数据
						</h4>
						<div id="showStr" class="hide">
							数据展示("[ ]"中内容为变量):
							<font color="red"></font>
						</div>
					</div>
					<div style="padding-left: 45px; padding-right: 45px;">
						<table id="tempDataTab" class="hide"></table>
						<textarea id="tempContent" rows="8" style="width: 1262px;" class="hide"></textarea>
					</div>
			</form>
		</div>
		<div id="menuContent" class="menuContent"
			style="display: none; position: absolute;">
			<ul id="treeDemo" class="ztree" style="margin-top: 0; width: 160px;"></ul>
		</div>
	</body>
</html>
