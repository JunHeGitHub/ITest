<!DOCTYPE  HTML>
<html lang="en">
	<head>
		<title>test.html</title>

		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
		<meta http-equiv="description" content="this is my page">
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" href="../../css/bootstrap.min.css"
			type="text/css"></link>
		<link rel="stylesheet"
			href="../../js/dataTables/css/jquery.dataTables.css" type="text/css"></link>
		<!-- bootstrap 与 datatable结合 -->
		<link rel="stylesheet" href="../../js/dataTables/css/DT_bootstrap.css"
			type="text/css"></link>
		<!-- 工具 -->
		<link rel="stylesheet"
			href="../../js/dataTables/css/dataTables.tableTools.min.css"
			type="text/css"></link>
		<!-- 动态列CSS -->
		<link rel="stylesheet" href="../../js/dataTables/css/font-awesome.css"></link>
		<link rel="stylesheet"
			href="../../js/dataTables/css/dataTables.colVis.min.css"
			type="text/css"></link>
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/bootstrap.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/jquery.dataTables.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.colReorder.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.colVis.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.tableTools.min.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/DT_bootstrap.js"></script>
		<script type="text/javascript" src="../../js/common_utils.js"></script>
		<script type="text/javascript"
			src="../../js/appCommonCurdUtils_new.js"></script>
		<script type="text/javascript" src="../../js/appCommonUtil.js"></script>
		<script type="text/javascript" src="../../js/golbal_params.js"></script>
		<script type="text/javascript" src="../../js/common_validation.js"></script>
		<script type="text/javascript"
			src="../activitiModelsManager/activiti.js"></script>
		<style type="text/css">
/**栅格布局调整开始*/ /**调整内容：一行4列，列宽：span4*/
.form-horizontal .control-label {
	float: left;
	width: 100px;
	text-align: right;
	padding-left: 0px !important;
	padding-top: 2px;
	padding-bottom: 2px;
}

.form-horizontal .controls {
	padding: 5px 0px;
	line-height: 5px;
	width: 200px !important;
	margin-left: 0px !important;
	float: left;
	padding-bottom: 2px;
	padding-top: 0px;
}
</style>
		<script>
var PROCESSDEFINTION_ID = "" ; //流程标识
var TYPE ="" ; //页面类型标识(新建流程页面&提交流程页面)
var TASK_ID="" ; //任务标识
var WORK_ID="" ; //业务标识

$(document).ready(function(){
	TYPE = getQueryString("TYPE")!=undefined? getQueryString("TYPE"):'';
	PROCESSDEFINTION_ID = getQueryString("PROCESSDEFINTION_ID");//!=undefined? getQueryString("TYPE"):'';
	TASK_ID = window.top.activitiCommonRowData!=undefined?window.top.activitiCommonRowData.a_id:'' ;
	if(TYPE=='commonProcess'){
		PROCESSDEFINTION_ID = getQueryString("PROCESSDEFINTION_ID");
		var rowData = window.top.activitiCommonRowData ; //选中的列表数据
		initForm(rowData);
		$("#finish").show() ;
	}
});
//提交方法
function doSubmit(flow_type){
	if(flow_type=="1"){
		$('#submit').click(createProcess(flow_type)) ;
	}else if(TYPE=="commonProcess"){
		$('#submit').click(submitProcess(flow_type)) ;
	}
}

//创建流程方法
function createProcess(){
	var params = {};
	params = zkm_getHtmlFormJsons('testForm') ;
	params["flow_type"]="1";
	var ACTIVITI = {} ;
	var FORM = {} ;
	if(PROCESSDEFINTION_ID==""||PROCESSDEFINTION_ID==undefined){alert("获取流程名称失败，请在url中配置（ PROCESSDEFINTION_ID） 。"); return;}
	params['A_PROCESSDEFINITIONID'] ="BOC_gongdan" ;
	doStartProcess(params,function(data){
			alert(data.mgs);
	});
}

//提交方法
function submitProcess(flow_type){
	var pat = {};
	
	pat = zkm_getHtmlFormJsons('testForm') ;
	pat['id']=window.top.activitiCommonRowData.id;
	pat['createTime'] = window.top.activitiCommonRowData.createTime ;
	pat['a_createTime'] = window.top.activitiCommonRowData.a_createTime ;
	pat['a_flowId'] = window.top.activitiCommonRowData.a_flowId ;
	pat["flow_type"]=flow_type;
	pat['taskId'] =TASK_ID ;
	pat['submitUser']=getUserInfo().loginName==undefined?"":getUserInfo().loginName;;
	if(TASK_ID!=""&&TASK_ID!=null){
		doCompletTask(pat,function(data){
			alert(data.mgs);
		});
	}else{
		alert("任务id获取失败！");	
	}
}
function doSave(){
	var pat = {} ;
	pat = zkm_getHtmlFormJsons('testForm') ;
	pat.taskId = "ff440927-9080-11e4-ad63-28e34750951e" ;
	doUpdateVariables(pat,function(data){
			alert(data.mgs);
			//此处使用通用insert方法在 activitiTest表中 更新一次数据。
	}) ;
}

function initForm(data){
	var cfs=$("#testForm input[name],textarea[name]");
	var str='';
	for(var key in data){
		if(data[key]==undefined||data[key]==null){
			data[key]="";
		}
		$("#"+key).val(data[key]);
	}
}
</script>
	</head>
	<body style="height:120px!important">
		<form class="form-horizontal orderDiv" id="testForm"
			style=" margin-top: 30px; wdith: 1100px; border-top-width: 1px">
			<div class="row" style="margin-top: 10px">
				<div class="span4">
					<div class="control-group ">
						<label class="control-label">
							业务标识:
						</label>
						<div class="controls">
							<input class="input-medium" type="text" id="customerCallTime" name="customerCallTime" />
						</div>
					</div>
				</div>
				<div class="span4">
					<div class="control-group ">
						<label class="control-label">
							业务名称:
						</label>
						<div class="controls">
							<input type="text" id="callInNum" name="callInNum" />
						</div>
					</div>
				</div>
				<div class="span6">
					<div class="control-group ">
						<label class="control-label">
							业务类型:
						</label>
						<div class="controls">
							<input type="text" id="gongdanSource" name="gongdanSource" />
						</div>
					</div>
				</div>
			</div>
			<div class="row" style="margin-top: 10px">
				<div class="span6">
					<div class="control-group ">
						<label class="control-label">
							处理人:
						</label>
						<div class="controls">
							<input type="text" id="organize" name="organize" />
						</div>
					</div>
					<div class="span6 control-group " style="float: left">
						<button id="submit" type="button" class="btn"
							style="margin-left: 10px" onclick="doSubmit('1')">
							提交
						</button>
						<button id="finish" type="button" class="btn"
							style="margin-left: 10px;display:none" onclick="doSubmit('2')">
							完成
						</button>
	<!-- 				<button id="submit" type="button" class="btn"
							style="margin-left: 10px" onclick="doSave()">
							保存
						</button>
						 -->	
					</div>
				</div>
		</form>
	</body>
</html>
