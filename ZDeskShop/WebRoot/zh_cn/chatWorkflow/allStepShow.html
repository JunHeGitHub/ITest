<!DOCTYPE html>
<html lang="en">

	<head>
		<title>查询节点</title>
		<meta http-equiv="Content-Type" content="textml; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" type="text/css" href="css/workflowPage.css?v=9999.9999" />
		<script type="text/javascript" src="js/jquery-1.8.3.min.js?v=9999.9999"></script>
		<script type="text/javascript" src="../../js/common_utils.js?v=9999.9999"></script>
		<script type="text/javascript" src="../../js/appCommonUtil.js?v=9999.9999"></script>
		<script type="text/javascript" src="../../js/appCommonCurdUtils_new.js?v=9999.9999"></script>
	</head>
<script type="text/javascript">
$(document).ready(function() {
		searchStep();
		});	  
//获取所有的节点
var workflow_id=getQueryString("workflow_id");
//var workflow_id="1011";
function searchStep(){
	var params={};
	params.workflow_id=workflow_id;
	var pdata={};
	var url="/"+PRJ_PATH+"/ZDesk/Step" + "/"+  "searchStep.action";
	params.isPagination=false;
	ajaxFunction(url, params, true, function(data) {
		if(data&&data.data){
			pdata=data.data;
			//alert(JSON.stringify(pdata));
			readStep('step', data.data);
		}
	});
	
	return pdata;
}

function readStep(id, data) {
		for (var i = 0; i < data.length; i++) {
		
			if(data[i].role="2"){
			
				data[i].role="执行";
			}else{
				data[i].role="参与";
			}
			if(data[i].staff_state==null){
				data[i].staff_state="";
			}
			var str = "<div class='step'>节点名称："+ data[i].stepName + "<br/>" + 
					 "执行人:"+data[i].user_name+ "<br/>"+
					 //"所属角色:"+data[i].role+ "<br/>"+	//当前节点人员均为执行人角色 不需要显示所属角色
					 "当前状态:"+data[i].staff_state+ "<br/><div>"+
					 "执行描述："+data[i].staff_state_describe+"<br/>"+
					"节点描述:<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+data[i].description+ "<br/>";
			
			$('#' + id).append(str);
		}
	}
</script>
<style type="text/css">
.step {
  background: #f2f2f2;
  border: 1px solid #babbbb;
  font-size: 12px;
  line-height: 25px;
  padding:5px 10px;
}
.step p{
 text-indent:2em;
 line-height: 8px;
}
	   
</style>
	<body >
	<header id="common_hd" class="c_txt rel">
   		<a id="hd_back" class="abs comm_p8" onclick="history.back();" type=item&amp;hd_back=1"></a>
        <h1 class="hd_tle">总览</h1>
        <em id="favourite_line" class="abs">&nbsp;</em>
    </header>
		<div id="step" >
		</div>
	</body>
</html>
