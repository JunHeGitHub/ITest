<!DOCTYPE  HTML>
<html lang="en">
	<head>
		<title>字典索引维护</title>

		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
		<meta http-equiv="description" content="this is my page">
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" href="../../css/bootstrap.min.css"
			type="text/css"></link>
		<link rel="stylesheet"
			href="../../js/dataTables/css/jquery.dataTables.css" type="text/css"></link>
		<link rel="stylesheet" href="../../css/bootstrap.css" type="text/css"></link>
		<!-- bootstrap 与 datatable结合 -->
		<link rel="stylesheet" href="../../js/dataTables/css/DT_bootstrap.css"
			type="text/css"></link>
		<!-- 工具 -->
		<link rel="stylesheet"
			href="../../js/dataTables/css/dataTables.tableTools.min.css"
			type="text/css"></link>
		<!-- 动态列CSS -->
		<link rel="stylesheet" href="../../js/dataTables/css/font-awesome.css"></link>
		<link rel="stylesheet"
			href="../../js/dataTables/css/dataTables.colVis.min.css"
			type="text/css"></link>
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/bootstrap.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/jquery.dataTables.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.colReorder.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.colVis.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/dataTables.tableTools.min.js"></script>
		<script type="text/javascript"
			src="../../js/dataTables/js/DT_bootstrap.js"></script>
		<script type="text/javascript" src="../../js/common_utils.js"></script>
		<script type="text/javascript" src="../../js/appCommonUtil.js"></script>
		<script type="text/javascript" src="../../js/golbal_params.js"></script>
		<script type="text/javascript" src="../../js/common_validation.js"></script>
		<style type="text/css">
table {
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

/* fa-square-o */
#dictbody tr td:first-child:before {
	content: "\f096";
	font-family: FontAwesome;
}

#dictbody tr.active td:first-child:before {
	content: "\f046"; /* fa-check-square-o */
}
</style>

	</head>
	<body style="width: 1350px">
		<!-- 
	<input id="id" " name="id" type="hidden">
	<input id="indexType" " name="indexType" type="hidden">
 -->
		<div class="widget-box collapsible" style="width: 1350px;">
			<div class="widget-title">
				<span class="icon"> <i class="icon-search"></i> </span>
				<h5>
					字典索引项搜索
				</h5>
				
				<div id="cols"></div>
				<div class="buttons" style="padding-bottom: 14px">
					<a href="#collapseOne" data-toggle="collapse" class="btn btn-mini"
						style="line-height: 30px; margin-top: -4px;"><i
						class="icon-retweet"></i>展开/关闭筛选项</a>
				</div>
				<div class="buttons">
					<div
						style="float: left; font-size: 12px; margin-top: 5px; padding-left: 13px">
						每页显示条数：
					</div>
					<div style="float: right; margin-top: -2px">
						<select name="pageSize" id="pageSize" style="width: 70px;"
							onchange="setPageNum(this)">
							<option selected="selected" value="10">
								10
							</option>
							<option value="30">
								30
							</option>
							<option value="50">
								50
							</option>
							<option value="100">
								100
							</option>
							<option value="200">
								200
							</option>
							<option value="500">
								500
							</option>
							<option value="1000">
								1000
							</option>
							<option value="-1">
								全部
							</option>
						</select>
					</div>
				</div>

			</div>
			<div class="widget-content collapse in" id="collapseOne"
				style="border-width: 0px; padding: 0; width: 1350px">
				<div style="margin-left: 0px">
					<form id="searchForm" class="form-horizontal bs-docs-example"
						style="margin-bottom: 0px; width: 1350px">
						<div style="width: 1000px; margin-top: 8px; margin-left: 200px">
							<div class="row">
								<div class="span4">
									<div class="control-group ">
										<label class="control-label">
											索引码
										</label>
										<div class="controls">
											<input type="text" class="input-medium" id="sindexCode"
												name="indexCode" />
										</div>
									</div>
								</div>
								<div class="span5">
									<div class="control-group ">
										<label class="control-label">
											索引名称
										</label>
										<div class="controls">
											<input type="text" class="input-medium" id="sname"
												name="name" />
										</div>
									</div>
								</div>
								<div class="span3">
									<div class="control-group">
										<button role="button" class="btn btn-primary"
											onclick="tableSearch()" data-toggle="modal">
											<i class="icon-search"></i>查 询
										</button>
										<button type="button" class="btn btn-primary"
											onclick="clearSearch('searchForm')">
											<i class="icon-repeat"></i> 重 置
										</button>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		<div
			style="background-color: rgb(239, 239, 239); rgb (205,205,205); width: 1350px; border: solid; border-right-color: rgb(205, 205, 205); border-width: 1px; border-left-color: rgb(205, 205, 205); border-left-width: 1px; border-right-width: 1px; border-top-width: 0px">
			<div
				style="margin-left: auto; margin-right: auto; width: 700px; margin-top: -37px; background-color: #fff;">
				<table
					class="table table-striped table-bordered table-hover datatable"
					id="dictbody" style="width: 150" cellspacing="0">
				</table>

			</div>
		</div>
		<div class="widget-box collapsible" style="margin-top: 0px">
			<div class="widget-title" style="width: 1350px;">
				<span class="icon"> <i class="icon-cog"></i> </span>
				<div style="margin-left: 45px; line-height: 40px;">
					<button type="button" id="addBtform" class="btn"
						data-toggle="modal" onclick="openAddForm();">
						<i class="icon-plus"></i>添 加
					</button>
					<button id="addBt" type="button" class="btn" style="display: none"
						onclick="tableAdd()">
						<i class="icon-ok"></i> 确认添加
					</button>
					<button id="upBt" type="button" class="btn" style="display: none"
						onclick="tableUpdate()">
						<i class="icon-ok"></i> 确认修改
					</button>
					<button type="button" class="btn" onclick="fnGetSelected()">
						<i class="icon-remove"></i> 删 除
					</button>
					<button type="button" class="btn" onclick="closeForm();">
						<i class="icon-chevron-up"></i> 关 闭
					</button>
					<button type="button" class="btn" onclick="clearSearch('addform')">
						<i class="icon-repeat"></i> 重 置
					</button>
				</div>
			</div>
		</div>
		<form class="form-horizontal" id="addform"
			style="display: none; width: 1350px; margin-bottom: 0px">
			<input id="updateid" " name="id" type="hidden">
			<input type="hidden" id="id" name="id">
			<div style="width: 1000px; margin-top: 8px; margin-left: 200px">
				<div class="row">
					<div class="span4">
						<div class="control-group ">
							<label class="control-label">
								索引码
								<span style="color: red;">*</span>
							</label>
							<div class="controls">
								<input type="text" class="input-medium" id="indexCode"
									ONBLUR="checkIndexCode()" placeholder="请填入字母或数字..."
									name="indexCode" />
								<input type="hidden" id="oldIndexCode" name="OldIndexCode">
							</div>
						</div>
					</div>
					<div class="span4">
						<div id="indexNameDiv" class="control-group ">
							<label class="control-label">
								索引名称
								<span style="color: red;">*</span>
							</label>
							<div class="controls">
								<input type="text" class="input-medium" id="indexName"
									name="indexName" ONBLUR="checkIndexName()"
									placeholder="请填入名称..." />
							</div>
						</div>
					</div>
				</div>
			</div>
		</form>
		<script type="text/javascript">
var areaData = {};
var CHECK_indexCode=false ;
var CHECK_indexName=false ;
$(document).ready(function(){
	var data=doSearch();
	$('#dictbody').dataTable({
		'bPaginate':true,//分页器
		'bLengthChange': false,
		'bStateSave':true, //保留状态
		'bSort':true,//按列排序
		'bInfo':true,//页脚信息
		'bAutoWidth':false, //自动宽度
//		'sScrollX':'1600',//垂直滚动条,滚动区域
		'sScrollY':'400px',
		'sPaginationType': 'bootstrap',//分页样式
		'dom': 'TRlrtip',
		'data':data,
		'columns': [
			{"title":"<input type='checkbox' id='selectall' onclick='toggleChecks(this);' ></input>",width:'30px',data: null, defaultContent: '', orderable: false},
			{"title":"索引码" ,data: 'indexCode' },
			{"title":"索引名称" ,data: 'indexName'}
//			{"title":"国际化" ,data: 'dicInternational'},
		],
		"oLanguage": {
  			"sSearch": "搜索:",
  			"sLengthMenu": "每页显示 _MENU_ 条记录",
 			"sZeroRecords": "Nothing found - 没有记录",
  			"sInfo": "显示第  _START_ 条到第  _END_ 条记录,一共  _TOTAL_ 条记录",
  			"sInfoEmpty": "显示0条记录",
  			"oPaginate": {
  				"sFirst": "首页",
   				"sPrevious": " 上一页 ",
   				"sNext":     " 下一页 ",
   				"sLast": "尾页"
   			}
  		}, tableTools: {
          	//single 单选 multi 多选  os 可以按ctrl 选择
           	// sRowSelect:'multi',
           	//回调 单选
           	fnRowSelected: function ( nodes ) {
            	var index=nodes[0]._DT_RowIndex;	
				var data = table.row(index).data();
               	OpenForm(data);
               	//alert(JSON.stringify(data));
            },
            sRowSelect:'multi',
            //sRowSelector:'td:first-child',
            aButtons:     [ /*{
            "sExtends":    "select_all",
            "sButtonText": "选择全部",
            "target":      "#select"
              } , 'select_none' */]
        	}
	});
	var table= $('#dictbody').DataTable();
	table.page.len('10').draw();
	$('#dictbody tbody').on( 'click', 'button', function (obj) {
		var data = table.row( $(this).parents('tr') ).data();
    	alert(JSON.stringify(data));
	});
	var colvis = new $.fn.dataTable.ColVis(table,{ buttonText: '自定义显示列',exclude: [ 0 ,-1] });
    $( colvis.button()).insertBefore('#cols')
});		
function doSearch(){
	//通用查询action路径
	var url = "/" + "ZDesk" + "/" + "*/Dicmaintenance" + "/" + "selectDicIndex.action";
	var params = {} ;
	var data1={} ;
	ajaxFunction(url,params,false,function(data){
		data1=data.data ;   
	});
    return data1;
}//每页显示条数
function setPageNum(obj){
	var table=$('#dictbody').DataTable();
	table.page.len(obj.value).draw();
 	//alert(obj.value);
}
function toggleChecks(obj){
	var table=$('#dictbody').DataTable();
	var tableTools = new $.fn.dataTable.TableTools(table);
	var ischeck=$("#selectall").is(':checked');
	if(ischeck){
		tableTools.fnSelectAll();
	}else{
		tableTools.fnSelectNone();
    }
}
function refresh(){
	var table=$('#dictbody').DataTable();
	table.search("").draw();
	table.clear().draw();
	//重新加载数据
	var data=doSearch(); 
	table.rows.add(data).draw(true);
}
function tableSearch(){
	var url = "/" + "ZDesk" + "/" + "*/Dicmaintenance" + "/" + "selectDicIndex.action";
	var params = {} ;
	params = zkm_getHtmlFormJsons('searchForm') ;
	var data1={} ;
	ajaxFunction(url,params,false,function(data){
		if(data.success){
			data1=data.data ;	
		}else{
			alert('查询失败');
		}
	});
	var table=$('#dictbody').DataTable();
	table.clear().draw();
	table.rows.add(data1).draw();
//    var table=$('#dictbody').DataTable();
//    var value=$("#shaixuan").val();
//    table.search(value).draw(true);
}
function OpenForm(data){
	reset('addform');
	$('#addform').show();
	$('#addBt').hide();
	$("#addBtform").hide() ;
	$('#upBt').show();
	var cfs=$("#addform input[name]");
	for(var i=0;i<cfs.length;i++){
		var e=cfs[i];	
	    $("#"+e.name).val(data[e.name]); 
	}
	$("#oldIndexCode").val(data.indexCode); 
	CHECK_indexCode=true ;
	CHECK_indexName=true ;
}

function openAddForm(){
	reset('addform');
	$('#addform').show();
	$('#upBt').hide();
	$("#addBtform").hide() ;
	$('#addBt').show();
}

function tableAdd(){
	var url = "/" + "ZDesk" + "/" + "*/Dicmaintenance" + "/" + "addDicIndex.action";
	params = zkm_getHtmlFormJsons('addform') ;
	if(!(CHECK_indexName&&CHECK_indexCode)){zinglabs.i18n.alert('notEnough');  return ;}
	var rdata=[];
   	ajaxFunction(url,params,false,function(data){
   		if(data.success){	
   			$("#addBt").hide() ;
			$("#upBt").hide() ;
			$("#addBtform").hide() ;
//			zinglabs.i18n.alert('system_saveSuccess');
		}else{
			if(data.mgs!=''&&data.mgs!=undefined){
				var pat = {"${0}":"索引代码"};
				alert(zinglabs.i18n.getText(data.mgs,pat));
			}else{
//				zinglabs.i18n.alert('system_saveFailed');
			}
		}
   	});
   	reset('addform');
   	closeForm();
   	refresh();
}
function tableUpdate(){
	var url = "/" + "ZDesk" + "/" + "*/Dicmaintenance" + "/" + "updateDicIndex.action";
	if(!(CHECK_indexName&&CHECK_indexCode)){
		zinglabs.i18n.alert('notEnough');
		return ;
	}
	params = zkm_getHtmlFormJsons('addform') ;
	var rdata=[];
	if(!(CHECK_indexName&&CHECK_indexCode)){zinglabs.i18n.alert('notEnough');  return ;}
   	ajaxFunction(url,params,false,function(data){
   		if(data.success){	
   			$("#addBt").hide() ;
			$("#upBt").hide() ;
			$("#addBtform").hide() ;
			zinglabs.i18n.alert('system_updateSuccess');
		}else{
			if(data.mgs!=''&&data.mgs!=undefined){
				zinglabs.i18n.alert(data.mgs);
			}else{
				if(data.mgs!=''&&data.mgs!=undefined){
					var pat = {"${0}":"索引代码"};
					alert(zinglabs.i18n.getText(data.mgs,pat));
				}else{
					zinglabs.i18n.alert('system_updateFailed');
				}
			}
		}
   	});
   	closeForm() ;
   	refresh();
}
function deleteCell(cell){
	var params = {} ;
	var url = "/" + "ZDesk" + "/" + "*/Dicmaintenance" + "/" + "deleteDicIndex.action";
	var ids='';
	for(var i in cell){
		ids = ids + cell[i].id+',';
	}
	if(ids!=''){
 		params.id = ids ;
  		ajaxFunction(url,params,false,function(data){
  			if(data.success){	
				zinglabs.i18n.alert('system_deleteSuccess');
			}else{
				zinglabs.i18n.alert('system_deleteFailed');
			}
  		});
  	}else{
  		$.alert("提示","请选择删除的列") ;
  	}
}
function fnGetSelected(){
    //注意DataTable大写 或者 $('#dictbody').dataTable().api();
	var table=$('#dictbody').DataTable();
 	//var data =table.column().data();
    //获取选中行 通过dataTable查找
    var cell=table.rows(".active").data();
    //通过table TableTools插件 查找
    var tt = new $.fn.dataTable.TableTools(table);
    var selectData=tt.fnGetSelectedData();
    deleteCell(selectData) ;
    refresh();
}
function clearSearch(addform){
	reset(addform);
}
function reset(addform){
	var cfs=$("#"+addform+" input[name],textarea[name]");
	for(var i=0;i<cfs.length;i++){
		var e=cfs[i];	
	    $(e).val(''); 
	}
	$("#"+addform+"")[0].reset();
}
function closeForm(){
	reset('addform');
	$("#addBt").hide() ;
	$("#upBt").hide() ;
	$("#addBtform").show() ;
	$('#addform').hide();
}
function checkIndexCode(){
	if(!(V_CodeAndNumberCheck($("#indexCode").val()))||$("#indexCode").val()==''){
		showTooltip('indexCodeDiv','填写不正确！');
		CHECK_indexCode = false ;
	}else{
		hideTooltip('indexCodeDiv') ;
		CHECK_indexCode = true ;
	}
} 
function checkIndexName(){
	if($("#indexName").val()==''||$("#indexName").val()==null||$("#indexName").val()==undefined){
		showTooltip('indexNameDiv','填写不正确！');
		CHECK_indexName =false ;
	}else{
		hideTooltip('indexNameDiv') ;
		CHECK_indexName =true ;
	}
}
//验证未通过样式
function showTooltip(id,title){
	$("#"+id).attr('title',title) ;
	$("#"+id).tooltip('show') ;
	$("#"+id).addClass('control-group error') ;
}
//还原样式
function hideTooltip(id){
	$("#"+id).tooltip('destroy') ;
	$("#"+id).removeClass('error') ;
}
		</script>
	</body>
</html>
