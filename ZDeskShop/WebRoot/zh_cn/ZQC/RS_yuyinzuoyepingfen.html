<!DOCTYPE HTML>
<html>
	<head>
		<title>语音作业评分</title>
		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
		<meta http-equiv="description" content="this is my page">
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" href="../../js/zTree/zTreeStyle/metroZJ.css"
			type="text/css" />
		<link rel="stylesheet" href="../../css/bootstrap.min.css"
			type="text/css"></link>
		<link rel="stylesheet" href="../../css/bootstrap-responsive.min.css"
			type="text/css" />
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/bootstrap.min.js"></script>
		<script type="text/javascript" src="RS_yuyinzuoyepingfen.js"></script>
		<script type="text/javascript"
			src="../../js/zTree/jquery.ztree.all-3.5.min.js"></script>
		<script type="text/javascript" src="../../js/appCommonUtil.js"></script>
		<script type="text/javascript" src="../../js/appCommonCurdUtils.js"></script>
		<script type="text/javascript" src="../../js/common_validation.js"></script>
		<script type="text/javascript" src="../../js/common_utils.js"></script>
		<script type="text/javascript" src="./ZQC_common.js"></script>
		<style type="text/css">
</style>
		<script type="text/javascript">
		var suoyou=[];
		 var fenshuArray = new Array();
		var pingyushuju={};			//评语数据
		var count=0;
		var grade_index;
		var description;
		var getCanshu={};
		$(document).ready(function(){
		var data_source=getQueryString("data_source");//判断是初检，复检，复审
		var peixun=getQueryString("peixun");
		var lj=getQueryString("lujing");
		var id=getQueryString("id");
		var score_state=getQueryString("score_state");//评分状态
		var data_state=getQueryString("score_state");//数据状态
		var grade_name=getQueryString("grade_name");//评分指标名
		var file_name=getQueryString("file_name");//文件名
		var file_location=getQueryString("file_location");
		var desId=doSearchIdByDescription(grade_name);//根据grade_name查询SA_QC_GRADE_DICTINFO表
		document.getElementById("grade_index_td").innerHTML="评分指标："+grade_name;
		var commonTreeParam=doSearchZhibiaoByDescription(grade_name);//评分项
		var chujian=lookScore();
		var fujian=FujianScore();
		var fushen=FushenScore();
		var shangsu=doSearchShangSuYuanYinByGrade_id();
		//初检
		if(data_source=="chujian"){
			$("#btn_chujianbaocun").removeClass('hide');
		    document.getElementById('btn_fabu').disabled = true;
		    $("#btn_fabu").removeClass('hide');
		    document.getElementById('grade_remark').readOnly=false;
		    var aa=zinglabs.zqc.getState("chujianweipingfen");
			if(data_state==zinglabs.zqc.getState("chujianyifenpei")||score_state==zinglabs.zqc.getState("chujianweipingfen")){
			//if(score_state=="初检已分配||score_state=="初检未评分"){
			    for(var i=0;i<commonTreeParam.length;i++){
			    	 $("#pingfenxiang").append("<tr ><td style='height:30px'>"+commonTreeParam[i].DESCRIPTION+"&nbsp;&nbsp;&nbsp;权重:(<span id='is_involve"+i+"' name='is_involve"+i+"' >"+commonTreeParam[i].weight+"</span>%)</td></tr>");
			    	 $("#pingfenzhi").append("<tr><td style='height:30px'><select class='span2' onchange='jisuanzongfen()'  id='pfx_00"+i+"'  name='pfx_00"+i+"' style='padding: 0; margin: 0; height:70%'></select></td></tr>");
					 var select=$("#pfx_00"+i).empty();//清空select下拉框
					 var option = commonTreeParam[i].reference2_value.split(","); //定义数组
					 for(var j=0;j<option.length;j++){
					 	if(option[j]==getMaxValue(option)){
					 	 	$("<option selected='selected'  value='" + parseInt(getMaxValue(option)) + "'>" + parseInt(getMaxValue(option)) + "</option>").appendTo(select)//动态添加Option子项
					 	}else if(j<option.length){
					 		$("<option id='optionj"+j+"'  value='" + option[j] + "'>" + option[j] + "</option>").appendTo(select)//动态添加Option子项
					 	}
					 }
					 if(commonTreeParam[i].weight!=0){
					 	$("<option id='bushejicixiang'  value='bushejicixiang'>不涉及此项</option>").appendTo(select)//动态添加Option子项
					  }
					  $("#pingyu").append("<tr><td style='height:30px'><input id='"+commonTreeParam[i].grade_index+"' onclick='remarkButton("+i+","+commonTreeParam[i].ID+")' type='button' class='span2 btn' value='评语' /><span style=' float: right; ' id='shifouyipingyu"+i+"'>未评语</span></td></tr>");
			    }
			   jisuanzongfen();
			}else{
				document.getElementById('btn_fabu').disabled = false;
				 for(var i=0;i<commonTreeParam.length;i++){
			    	 $("#pingfenxiang").append("<tr><td style='height:30px'>"+commonTreeParam[i].DESCRIPTION+"&nbsp;&nbsp;&nbsp;权重:(<span id='is_involve"+i+"' name='is_involve"+i+"' >"+commonTreeParam[i].weight+"</span>%)</td></tr>");
			    	 $("#pingfenzhi").append("<tr><td style='height:30px'><select class='span2' onchange='jisuanzongfen()'  id='pfx_00"+i+"'  name='pfx_00"+i+"' style='padding: 0; margin: 0; height:70%'></select></td></tr>");
					 
					 var pfx="pfx_00"+i+"";
					 var select=$("#pfx_00"+i).empty();//清空select下拉框
					 var option = commonTreeParam[i].reference2_value.split(","); //定义数组
					 for(var j=0;j<option.length;j++){
					 	if(option[j]==parseInt(chujian[0][pfx]) ){
					 	 	$("<option selected='selected'  value='" + parseInt(chujian[0][pfx]) + "'>" + parseInt(chujian[0][pfx]) + "</option>").appendTo(select)//动态添加Option子项
					 	}
					 	if(j<option.length){
					 		$("<option id='optionj"+j+"'  value='" + option[j] + "'>" + option[j] + "</option>").appendTo(select)//动态添加Option子项
					 	}
					 }
					if(commonTreeParam[i].weight!=0){
						if(parseInt(chujian[0][pfx])==-1){
					 		$("<option id='bushejicixiang' selected='selected'  value='bushejicixiang'>不涉及此项</option>").appendTo(select)//动态添加Option子项
					 	}else{
					 		$("<option id='bushejicixiang'  value='bushejicixiang'>不涉及此项</option>").appendTo(select)//动态添加Option子项
					  	}
					  }
					  $("#pingyu").append("<tr><td style='height:30px'><input id='pingYuButton"+i+"' onclick='remarkButton("+i+","+commonTreeParam[i].ID+")' type='button' class='span2 btn' value='评语' /><span style=' float: right; ' id='shifouyipingyu"+i+"'>未评语</span></td></tr>");
			   
			    }
			    if(chujian[0].grade_remark!=null&&chujian[0].grade_remark!=""&&chujian[0].grade_remark!=undefined){
			    	 $("#grade_remark").val(chujian[0].grade_remark);//初检评语
			    }
			 	jisuanzongfen()
			    loadPingYuCss('');
			}
		}
		
		if(data_source=="fujian"){
			 $("#btn_fujianbaocun").removeClass('hide');
		    document.getElementById('grade_remark').readOnly=true;
		    document.getElementById('fujian_remark').readOnly=false;
			if(score_state==zinglabs.zqc.getState("chujianyipingfen")||data_state==zinglabs.zqc.getState("fujianyifenpei")||score_state==zinglabs.zqc.getState("fujianweipingfen")){
			 for(var i=0;i<commonTreeParam.length;i++){
			    	 $("#pingfenxiang").append("<tr><td style='height:30px'>"+commonTreeParam[i].DESCRIPTION+"&nbsp;&nbsp;&nbsp;权重:(<span id='is_involve"+i+"' name='is_involve"+i+"' >"+commonTreeParam[i].weight+"</span>%)</td></tr>");
			    	 $("#pingfenzhi").append("<tr><td style='height:30px'><select class='span2' onchange='jisuanzongfen()'  id='pfx_00"+i+"'  name='pfx_00"+i+"' style='padding: 0; margin: 0; height:70%'></select></td></tr>");
					 
					 var pfx="pfx_00"+i+"";
					 var select=$("#pfx_00"+i).empty();//清空select下拉框
					 var option = commonTreeParam[i].reference2_value.split(","); //定义数组
					 for(var j=0;j<option.length;j++){
					 	if(option[j]==parseInt(chujian[0][pfx]) ){
					 	 	$("<option selected='selected'  value='" + parseInt(chujian[0][pfx]) + "'>" + parseInt(chujian[0][pfx]) + "</option>").appendTo(select)//动态添加Option子项
					 	}else if(j<option.length){
					 		$("<option id='optionj"+j+"'  value='" + option[j] + "'>" + option[j] + "</option>").appendTo(select)//动态添加Option子项
					 	}
					 }
					if(commonTreeParam[i].weight!=0){
					 	if(parseInt(chujian[0][pfx])==-1){
					 		$("<option id='bushejicixiang' selected='selected'  value='bushejicixiang'>不涉及此项</option>").appendTo(select)//动态添加Option子项
					 	}else{
					 		$("<option id='bushejicixiang'  value='bushejicixiang'>不涉及此项</option>").appendTo(select)//动态添加Option子项
					  	}
					  }
					  $("#pingyu").append("<tr><td style='height:30px'><input id='pingYuButton"+i+"' onclick='remarkButton("+i+","+commonTreeParam[i].ID+")' type='button' class='span2 btn' value='评语' /><span style=' float: right; ' id='shifouyipingyu"+i+"'>未评语</span></td></tr>");
			   
			    }
			    if(chujian[0].grade_remark!=null&&chujian[0].grade_remark!=""&&chujian[0].grade_remark!=undefined){
			    	 $("#grade_remark").val(chujian[0].grade_remark);//初检评语
			    }
			 	jisuanzongfen();
			 	loadPingYuCss("chujian");
			}else{
				 for(var i=0;i<commonTreeParam.length;i++){
			    	 $("#pingfenxiang").append("<tr><td style='height:30px'>"+commonTreeParam[i].DESCRIPTION+"&nbsp;&nbsp;&nbsp;权重:(<span id='is_involve"+i+"' name='is_involve"+i+"' >"+commonTreeParam[i].weight+"</span>%)</td></tr>");
			    	 $("#pingfenzhi").append("<tr><td style='height:30px'><select class='span2' onchange='jisuanzongfen()'  id='pfx_00"+i+"'  name='pfx_00"+i+"' style='padding: 0; margin: 0; height:70%'></select></td></tr>");
					 var pfx="pfx_00"+i+"";
					 var select=$("#pfx_00"+i).empty();//清空select下拉框
					 var option = commonTreeParam[i].reference2_value.split(","); //定义数组
					 for(var j=0;j<option.length;j++){
					 	if(option[j]==parseInt(fujian[0][pfx]) ){
					 	 	$("<option selected='selected'  value='" + parseInt(fujian[0][pfx]) + "'>" + parseInt(fujian[0][pfx]) + "</option>").appendTo(select)//动态添加Option子项
					 	}else if(j<option.length){
					 		$("<option id='optionj"+j+"'  value='" + option[j] + "'>" + option[j] + "</option>").appendTo(select)//动态添加Option子项
					 	}
					 }
					if(commonTreeParam[i].weight!=0){
					if(parseInt(fujian[0][pfx])==-1){
					 		$("<option id='bushejicixiang' selected='selected'  value='bushejicixiang'>不涉及此项</option>").appendTo(select)//动态添加Option子项
					 	}else{
					 		$("<option id='bushejicixiang'  value='bushejicixiang'>不涉及此项</option>").appendTo(select)//动态添加Option子项
					  	}
					 }
					  $("#pingyu").append("<tr><td style='height:30px'><input id='pingYuButton"+i+"' onclick='remarkButton("+i+","+commonTreeParam[i].ID+")' type='button' class='span2 btn' value='评语' /><span style=' float: right; ' id='shifouyipingyu"+i+"'>未评语</span></td></tr>");
			   
			    }
			    if(chujian[0].grade_remark!=null&&chujian[0].grade_remark!=""&&chujian[0].grade_remark!=undefined){
			    	 $("#grade_remark").val(chujian[0].grade_remark);//初检评语
			    }
			   	if(fujian[0].grade_remark_fj!=null&&fujian[0].grade_remark_fj!=""&&fujian[0].grade_remark_fj!=undefined){
			    	$("#fujian_remark").val(fujian[0].grade_remark_fj);//复检评语
			    }
			 	jisuanzongfen();
			 	loadPingYuCss('');
			}
		}
		
		if(data_source=="fushen"){
			 $("#btn_fushenbaocun").removeClass('hide');
		    document.getElementById('grade_remark').readOnly=true;
		    document.getElementById('fujian_remark').readOnly=true;
		    document.getElementById('fushen_remark').readOnly=false;
			if(score_state==zinglabs.zqc.getState("zuoxishangsu")){
			 for(var i=0;i<commonTreeParam.length;i++){
			    	 $("#pingfenxiang").append("<tr><td style='height:30px'>"+commonTreeParam[i].DESCRIPTION+"&nbsp;&nbsp;&nbsp;权重:(<span id='is_involve"+i+"' name='is_involve"+i+"' >"+commonTreeParam[i].weight+"</span>%)</td></tr>");
			    	 $("#pingfenzhi").append("<tr><td style='height:30px'><select class='span2' onchange='jisuanzongfen()'  id='pfx_00"+i+"'  name='pfx_00"+i+"' style='padding: 0; margin: 0; height:70%'></select></td></tr>");
					 
					 var pfx="pfx_00"+i+"";
					 var select=$("#pfx_00"+i).empty();//清空select下拉框
					 var option = commonTreeParam[i].reference2_value.split(","); //定义数组
					 for(var j=0;j<option.length;j++){
					 	if(option[j]==parseInt(chujian[0][pfx]) ){
					 	 	$("<option selected='selected'  value='" + parseInt(chujian[0][pfx]) + "'>" + parseInt(chujian[0][pfx]) + "</option>").appendTo(select)//动态添加Option子项
					 	}else if(j<option.length){
					 		$("<option id='optionj"+j+"'  value='" + option[j] + "'>" + option[j] + "</option>").appendTo(select)//动态添加Option子项
					 	}
					 }
					if(commonTreeParam[i].weight!=0){
					 	if(parseInt(chujian[0][pfx])==-1){
					 		$("<option id='bushejicixiang' selected='selected'  value='bushejicixiang'>不涉及此项</option>").appendTo(select)//动态添加Option子项
					 	}else{
					 		$("<option id='bushejicixiang'  value='bushejicixiang'>不涉及此项</option>").appendTo(select)//动态添加Option子项
					  	}
					  }
					  $("#pingyu").append("<tr><td style='height:30px'><input id='pingYuButton"+i+"' onclick='remarkButton("+i+","+commonTreeParam[i].ID+")' type='button' class='span2 btn' value='评语' /><span style=' float: right; ' id='shifouyipingyu"+i+"'>未评语</span></td></tr>");
			    }
			    if(chujian[0].grade_remark!=null&&chujian[0].grade_remark!=""&&chujian[0].grade_remark!=undefined){
			    	 $("#grade_remark").val(chujian[0].grade_remark);//初检评语
			    }
			    if(shangsu[0].agent_user_remark!=null&&shangsu[0].agent_user_remark!=""&&shangsu[0].agent_user_remark!=undefined){
			    	$("#shangsu_remark").val(shangsu[0].agent_user_remark);//上诉原因
			    }
			 	jisuanzongfen();
			 	loadPingYuCss("chujian");
			}else{
				document.getElementById('fushen_remark').readOnly=true;
				 for(var i=0;i<commonTreeParam.length;i++){
			    	 $("#pingfenxiang").append("<tr><td style='height:30px'>"+commonTreeParam[i].DESCRIPTION+"&nbsp;&nbsp;&nbsp;权重:(<span id='is_involve"+i+"' name='is_involve"+i+"' >"+commonTreeParam[i].weight+"</span>%)</td></tr>");
			    	 $("#pingfenzhi").append("<tr><td style='height:30px'><select class='span2' onchange='jisuanzongfen()'  id='pfx_00"+i+"'  name='pfx_00"+i+"' style='padding: 0; margin: 0; height:70%'></select></td></tr>");
					 
					 var pfx="pfx_00"+i+"";
					 var select=$("#pfx_00"+i).empty();//清空select下拉框
					 var option = commonTreeParam[i].reference2_value.split(","); //定义数组
					 for(var j=0;j<option.length;j++){
					 	if(option[j]==parseInt(fushen[0][pfx]) ){
					 	 	$("<option selected='selected'  value='" + parseInt(fushen[0][pfx]) + "'>" + parseInt(fushen[0][pfx]) + "</option>").appendTo(select)//动态添加Option子项
					 	}else if(j<option.length){
					 		$("<option id='optionj"+j+"'  value='" + option[j] + "'>" + option[j] + "</option>").appendTo(select)//动态添加Option子项
					 	}
					 }
					if(commonTreeParam[i].weight!=0){
					 	if(parseInt(fushen[0][pfx])==-1){
					 		$("<option id='bushejicixiang' selected='selected'  value='bushejicixiang'>不涉及此项</option>").appendTo(select)//动态添加Option子项
					 	}else{
					 		$("<option id='bushejicixiang'  value='bushejicixiang'>不涉及此项</option>").appendTo(select)//动态添加Option子项
					  	}
					  }
					  $("#pingyu").append("<tr><td style='height:30px'><input id='pingYuButton"+i+"' onclick='remarkButton("+i+","+commonTreeParam[i].ID+")' type='button' class='span2 btn' value='评语' /><span style=' float: right; ' id='shifouyipingyu"+i+"'>未评语</span></td></tr>");
			    }
			    if(chujian[0].grade_remark!=null&&chujian[0].grade_remark!=""&&chujian[0].grade_remark!=undefined){
			    	 $("#grade_remark").val(chujian[0].grade_remark);//初检评语
			    }
			   	if(shangsu[0].admin_remark!=null&&shangsu[0].admin_remark!=""&&shangsu[0].admin_remark!=undefined){
			    	$("#fushen_remark").val(shangsu[0].admin_remark);//复审评语
			    }
			    if(shangsu[0].agent_user_remark!=null&&shangsu[0].agent_user_remark!=""&&shangsu[0].agent_user_remark!=undefined){
			    	$("#shangsu_remark").val(shangsu[0].agent_user_remark);//上诉原因
			    }
			 	jisuanzongfen();
			 	loadPingYuCss('');
			}
			if(score_state!=zinglabs.zqc.getState("zuoxishangsu")){
				$("#btn_fushenbaocun").hide();
			}
		}
		});
		</script>

	</head>
	<body >
		<div id="player2mp3"></div>
		<table class="table table-bordered table-condensed"
			id="xitongguanliyuanfushen" >
			<tbody>
				<tr class="warning">
					<td colspan='3' id="chakanwenben_trtd">
					</td>
				</tr>
				<tr class="warning">
					<td colspan='1' style="text-align: left;" id="grade_index_td">
						评分指标:
					</td>
					<td  colspan='2'>
						<span  id='scoreSum'>00</span>
					</td>
				</tr>
				
				<tr class="info">
					
					<td style="width:33%;">
						<div style=" height:auto;">
							<form id="pingfenxiangForm">
								<table id="pingfenxiang" style="width: 100%">
								</table>
							</form>
						</div>
					</td>
					<td style="width:33%;">
						<div style=" height:auto; ">
							<form id="pingfenzhiForm">
								<table id="pingfenzhi" style="width: 100%"></table>
							</form>	
						</div>
					</td>
					<td style="width:33%;">
						<div style="height:auto;" >
							<form id="pingyuForm">
								<table id="pingyu" style="width: 100%"></table>
							</form>
						</div>
					</td>
				</tr>
				<tr class="warning">
					<td colspan="3" style="text-align: left;">
						语音内容/评分评语
					</td>
				
				</tr>
				
				<tr class="warning">
					<td colspan="3">
						<textarea id="grade_remark" name="grade_remark"
							readonly="readonly"
							style="padding: 0; margin: 0; background-color: #CAE1FF; width: 100%; height: 50px"></textarea>
					</td>
				</tr>
				<tr class="warning">
					<td colspan="3" style="text-align: left;">
						复检说明
					</td>
				</tr>
				<tr class="warning">
					<td colspan="3">
						<textarea id="fujian_remark" name="fujian_remark"
							readonly="readonly"
							style="padding: 0; margin: 0; background-color: #CAE1FF; width: 100%; height: 50px"></textarea>
					</td>
				</tr>
				<tr class="warning">
					<td colspan="3" style="text-align: left;">
						复审说明
					</td>
				</tr>
				<tr class="warning">
					<td colspan="3">
						<textarea id="fushen_remark" name="fushen_remark"
							readonly="readonly"
							style="padding: 0; margin: 0; background-color: #CAE1FF; width: 100%; height: 50px"></textarea>
					</td>
				</tr>
				<tr class="warning">
					<td colspan="3" style="text-align: left;">
						上诉原因
					</td>
				</tr>
				<tr class="warning">
					<td colspan="3">
						<textarea id="shangsu_remark" name="shangsu_remark"
							readonly="readonly"
							style="padding: 0; margin: 0; background-color: #CAE1FF; width: 100%; height: 50px"></textarea>
					</td>
				</tr>
				<tr class="info">
					<td colspan="3">
						<input type="hidden" id="file_address" name="file_address" />
						<!-- <button type="button" id="btn_wenbenneirongchakan" class="btn"
							style="margin-left: 30%; margin-top: 0px"
							onclick="chaKanWenBenNeiRong();" id="btn_wenbenneirongchaxun">
							<i class="icon-tag"></i> 语音内容查看
						</button>
						 <button type="button" id="btn_jisuanzongfen" class="btn"
							style="margin-left: 20px; margin-top: 0px"
							onclick="jisuanzongfen();" id="btn_jisuanzongfen">
							<i class="icon-tag"></i> 计算总分
						</button>
						<input type="text" id="jisuanzongfen" readonly="readonly"
							style="margin-left: 20px; margin-top: 10px; width: 35px">-->
						<button type="button" id="btn_chujianbaocun" class="btn hide"
							style="margin-left: 40%; margin-top: 0px"
							onclick="delete_insert_Data('chujian');" id="btn_baocun">
							<i class="icon-tag"></i> 初检保存
						</button>
						<button type="button" id="btn_fujianbaocun" class="btn hide"
							style="margin-left: 40%; margin-top: 0px"
							onclick="delete_insert_Data('fujian');" id="btn_baocun">
							<i class="icon-tag"></i> 复检保存
						</button>
						<button type="button" id="btn_fushenbaocun" class="btn hide"
							style="margin-left: 40%; margin-top: 0px"
							onclick="delete_insert_Data('fushen');" id="btn_baocun">
							<i class="icon-tag"></i> 复审保存
						</button>
						<button type="button" id="btn_fabu" class="btn hide"
							style="margin-left: 20px; margin-top: 0px" onclick="fabu();">
							<i class="icon-tag"></i> 发布
						</button>
					</td>
				</tr>

			</tbody>
		</table>
	</body>
</html>

