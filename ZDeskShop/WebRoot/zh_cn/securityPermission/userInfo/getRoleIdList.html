<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>角色授权--添加</title>

		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3" />
		<meta http-equiv="description" content="this is my page" />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=9;IE=8;IE=EDGE" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/bootstarp/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/bootstarp/bootstrap-responsive.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/css/zinglabs.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/jquery.dataTables.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/DT_bootstrap.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/dataTables.tableTools.min.css"/>
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/font-awesome.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/dataTables.colVis.min.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/dataTables/css/dataTables.responsive.css" />
		<link rel="stylesheet" type="text/css" href="/JsLib/dist/component/artdialog/ui-dialog.css" />
	</head>
	<body>
		<br />
		<br />
		<table width="700" align="center" border="0" cellpadding="0"
			cellspacing="0" class="newContTab">
			<tr>
				<th>
				</th>
				<td>
					<div>
						<div>
							<select multiple="multiple" id="select1"
								style="width: 300px; height: 200px; float: left;">
							</select>
						</div>
						<div style="float: left">
							<br />
							<br />
							<br />
							<span id="add"> <input type="button" class="btn"
									value="》》" /> </span>
							<br />
							<span id="remove"> <input type="button" class="btn"
									value="《《" /> </span>
							<br />
						</div>
						<div>
							<select multiple="multiple" name="s" id="select2"
								style="width: 300px; height: 200px; float: left;">
							</select>
						</div>
					</div>
				</td>
			</tr>
			<tr>
				<th>
				</th>
				<td>
					<div>
						<div>
							<span style="width: 300px; height: 30px; float: left;"> </span>
						</div>
						<div style="float: left">
							<span>
								<button type="button" class="btn btn-default"
									style="width: 70px" data-toggle="modal" onclick="doSave()">
									提交
								</button> </span>
						</div>
						<div>
							<span style="width: 300px; height: 30px; float: left;"> </span>
						</div>
					</div>
				</td>
			</tr>
		</table>
		<!-[if IE]>
		<!-- script src=”http://html5shiv.googlecode.com/svn/trunk/html5.js”></script> -->
		<![endif]–>
		<script type="text/javascript" src="../../../js/jquery.js"></script>
		<script type="text/javascript" src="../../../js/bootstrap.js"></script>
		<script type="text/javascript" src="../../../js/common_utils.js"></script>
		<script type="text/javascript">
			var data_getRoleByloginName;
			var loginname;
			var pwin = window.parent
			var ZKM = "ZKM";
			//左边保存的数组
			var right_row_arr={};
			var left_row_arr={};
			//下拉框交换JQuery
			$(document).ready(function(){
			     var data_all=doSearch();
			     var select1 = $("#select1"); 
			      select1.empty();//清空select下拉框
			
			    for(var i=0;i<data_all.length;i++){
			        $("<option value='" + data_all[i].id + "'>" + data_all[i].name + "</option>").appendTo(select1)//动态添加Option子项
			        left_row_arr[data_all[i].id]=true;
			    }
			     data_getRoleByloginName=doSearch_getRoleByloginName();
			      var select2 = $("#select2"); 
			      select2.empty();//清空select下拉框
			
			    for(var i=0;i<data_getRoleByloginName.length;i++){
			        $("<option value='" + data_getRoleByloginName[i].id + "'>" + data_getRoleByloginName[i].name + "</option>").appendTo(select2)//动态添加Option子项
			       //right_row_arr.push(data_getRoleByloginName[i].id);
			        right_row_arr[data_getRoleByloginName[i].id]=true;
			    }
			       
			    //移到右边
			    $('#add').click(function() {
			      //获取选中的选项，删除并追加给对方
			        var array = new Array(); //定义数组
			        $("#select2 option").each(function(){ //遍历全部option
			        var txt = $(this).val(); //获取option的内容
			            array.push(txt); //添加到数组中
			        });
			       var sid=$('#select1 option:selected').val();
			       if($.inArray(sid, array)==-1){
			          $('#select1 option:selected').appendTo('#select2');
			          left_row_arr[sid]=false;
			          right_row_arr[sid]=true;
			       }
			        
			    });
			     //双击选项
			    $('#select1').dblclick(function(){ //绑定双击事件
			        //获取全部的选项,删除并追加给对方
			         
			        //$("option:selected",this).appendTo('#select2'); //追加给对方
			        //判断当前的值在对方select 是否有
			         var sid=$("option:selected",this).val();
			         //如果右侧没有追加过去
			         if(!right_row_arr[sid]){
			             $('#select1 option:selected').appendTo('#select2');
			              left_row_arr[sid]=false;
			              right_row_arr[sid]=true;
			         }
			    });
			    //双击选项
			    $('#select2').dblclick(function(){
			        var sid=$('#select2 option:selected').val();
			       // $("option:selected",this).appendTo('#select1');
			          if(!left_row_arr[sid]){
			             $("option:selected",this).appendTo('#select1');
			              left_row_arr[sid]=true;
			              right_row_arr[sid]=false;
			          }else{
			              left_row_arr[sid]=true;
			              right_row_arr[sid]=false;
			              $("option:selected",this).remove();   
			          }
			    });
			    //移到左边
			    $('#remove').click(function() {
			         var sid=$('#select2 option:selected').val();
			        if(!left_row_arr[sid]) {
			           $('#select2 option:selected').appendTo('#select1');
			            left_row_arr[sid]=true;
			            right_row_arr[sid]=false;
			        }else{
			              left_row_arr[sid]=true;
			              right_row_arr[sid]=false;
			             // alert($("option:selected",this).html());
			              $('#select2 option:selected').remove();  
			        }  
			         
			       
			    });
			    /**
			    //全部移到右边
			    $('#add_all').click(function() {
			        //获取全部的选项,删除并追加给对方
			        $('#select1 option').appendTo('#select2');
			    });
			    //全部移到左边
			    $('#remove_all').click(function() {
			        $('#select2 option').appendTo('#select1');
			    });
			   **/             
			});
			
			function doSearch(){	
					//通用查询action路径
					   var url = "/" + window.top.PRJ_PATH + "/" + ZKM +"/CommonsCurd" + "/" + "Find.action";		
					   var params={};
					   params.tableName ="suSecurityRole";
					   params.nameSpace ="com.zinglabs.apps.commons.pojo";
					   params.nameSpaceId = "getList";
					   var rdata=[];
					   	$.ajax({
							async :false,
							type : "post",
							url : url,
							dataType : "json",
							data : params,
							success : function(data) {
								if (data) {
					              rdata=data.rows;
								}
							}
							});
					     return rdata;
					}
									
					function doSearch_getRoleByloginName(){	
					 loginname=getQueryString("loginName");
					//通用查询action路径
					  var url = "/" + window.top.PRJ_PATH + "/" + ZKM +"/RoleCurd" + "/" + "getRoleByLoginName.action?loginName="+loginname;
					    var params={};
					    //params.tableName ="suSecurityUserAndRole";
				        params.nameSpace ="com.zinglabs.apps.suPermission";
					    params.nameSpaceId = "getRoleByLoginName";		    
					   var rdata=[];
					   	$.ajax({
							async :false,
							type : "post",
							url : url,
							dataType : "json",
							data : params,
							success : function(data) {
								if (data) {
					              rdata=data.rows;
								}
							}
							});
					     return rdata;
					}
					
					
					function doSave(){
					var reFillFn = getQueryString("reFillFn");
					var idArray = new Array(); //定义数组
					var nameArray = new Array();
			        $("#select2 option").each(function(){ //遍历全部option
			        var ids = $(this).val(); //获取option的内容
			        var names = $(this).text();
			            idArray.push(ids); //添加到数组中
			            nameArray.push(names)
			        });
			        pwin[reFillFn](idArray,nameArray);
					}
		</script>
	</body>
</html>