<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="UTF-8">
		<title>商品详情</title>
		<meta name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		
		<link rel="stylesheet" href="/JsLib/dist/css/bootstrap.min.css?v=9999.9999" />
		<link rel="stylesheet" href="/JsLib/dist/component/bootstrap-dialog/css/bootstrap-dialog.min.css?v=9999.9999" />
		
		<link rel="stylesheet" href="/JsLib/dist/css/font-awesome.min.css?v=9999.9999" />
		<link rel="stylesheet" href="/JsLib/dist/css/ace.min.css?v=9999.9999" />
		
		<link rel="stylesheet" href="/JsLib/dist/css/zmobile.min.css?v=9999.9999" />
		<!-- <link rel="stylesheet"	href="/ZingMH/zh_cn/chatWorkflow/css/workflowPage.css?v=9999.9999" /> -->

		
		<link rel="stylesheet" type="text/css" href="/ZingMH/css/appCss/shopping/base.css" />
		<link rel="stylesheet" type="text/css" href="/ZingMH/css/appCss/shopping/mobile.min.css" />
		<link rel="stylesheet" type="text/css" href="/ZingMH/css/appCss/shopping/detail.css"	  />
		<link rel="stylesheet" type="text/css" href="/ZingMH/css/appCss/shopping/phoneTheme.css"  />



		<script src="/JsLib/dist/component/jquery1x.min.js?v=9999.9999"></script>
		<script type="text/javascript" src="/ZingMH/js/appGolbalConf.js?v=9999.9999"></script>
		<script language="javascript" type="text/javascript" src="/JsLib/dist/js/common_utils.js?v=9999.9999"></script>
		<script type="text/javascript" src="/ZingMH/js/appJs/hrManager/hrUtiljs.js?v=9999.9999"></script>
		<script language="javascript" type="text/javascript" src="/JsLib/dist/js/mobile_utils.js?v=9999.9999"></script>
	   <!--公用js ZingMH/nodeJs/tpls == SRender 因为nginx规则原因-->
	
	    <script src="/ZingMH/nodeJs/tpls/util/mh.js?v=9999.9999"></script>
	    
	    
	    <!-- 幻灯片js -->
	    <script type="text/javascript" src="/ZingMH/js/jquery.touchslider.min.js?v=9999.9999"></script>
		
		<!--  
		<script type="text/javascript" src="../../../js/jquery.js"></script>
		<script type="text/javascript" src="../../../js/golbal_params.js"></script>
		<script type="text/javascript" src="../../../js/common_utils.js"></script>
		<script type="text/javascript" src="../js/detail.js"></script> -->

	<style>
		a:link{text-decoration:none ; }
		a:visited {text-decoration:none ; }
		a:hover {text-decoration:none ;}
		a:active {text-decoration:none;} 
		
		#bg{ 
			display: none; 
			position: absolute;  
			left: 0%; 
			top:0%; 
			width: 100%; 
			height: 100%; 
			background-color: black; 
			z-index:1001; 
			-moz-opacity: 0.7; 
			opacity:.70; 
			filter: alpha(opacity=70);
		}
		 
		 #selectProp{
		 	display: none; 
		 	position: fixed; 
		 	bottom: 0%; 
		 	/*top:60%;*/
		 	/*left: 22%; */
		 	width: 100%; 
		 /*	height: 50%;*/
		  	background-color: white; 
		  	z-index:1002; 
		  	/*overflow: auto;*/
		  	}
		  	
		  div.wid{  
		    width:230px;
		    white-space:normal;
		    text-overflow:ellipsis;
		    -o-text-overflow:ellipsis;
		    overflow: hidden;
		 }  	
		 
		 #hd_back:before,#hd_back_none:before,#quickbuyback:before{
		    content:"";
		    width:15px;
		    height:15px;
		    position:absolute;
		    top:10px;
		    left:10px;
		    border-bottom:1px solid #afafae;
		    border-right:1px solid #afafae;
		    -webkit-transform: rotate(135deg);
		    -moz-transform: rotate(135deg);
		    -o-transform: rotate(135deg);
		    transform: rotate(135deg);
		}
		 
		#hd_back:after,#hd_back_none:after,#quickbuyback:after{
		    right:0;
		}
		
		.font-size-Style{
			font-size:18px !important;
		}
		
		.tabV2  li{
			background:white;
		}
		
		.tabV2 .cur a{
			color:#FF5511 ;
		}
		
		.tabV2 .cur a:after{
			content: ' ';
			position: absolute;
			background: #FF5511 ;
			display: block;
			/*bottom: 0;*/
			height: 2px;
			margin:0 3px; 
			width: 33%;
		}
		
		/*最新增加样式 2016-01-20*/
		.propBtn{
			width: 50px;
		    height: 30px;
		    margin: 5px 5px;
		    border-radius: 3px;
		    border: 0;
		    padding:0;
		}
		/* 选中的属性样式 */ 
		.propSelectCss{
			color: white !important;
    		background: #CC0000 !important;
		}
		
		.showImg{
			border: 1px solid #DDDDDD;
		    position: absolute;
		    top: -10px;
		    background: white;
		}
		
		
		.touchslider,.touchslider div,.touchslider a,.touchslider img{
		    font-style: normal;
		    vertical-align: top;
			padding:0px; margin:0px;
			border:0px;
		}
		.touchslider{position:relative;margin:0 -12px;}
		.touchslider .touchslider-viewport{ overflow:hidden; height:250px;}
		.touchslider .touchslider-viewport .touchslider-item a{z-index:1;width:100%;display:block;}
		.touchslider .touchslider-viewport .touchslider-item img{ width:100%;}
		.touchslider .touchslider-navtag{text-align:center;height:34px;display:inline-block;vertical-align:middle;margin-top:-8px;width:100%}
		.touchslider .touchslider-navtag span{width:14px;height:2px;background:#c1c1c1;overflow:hidden;display:inline-block; }
		.touchslider .touchslider-navtag .touchslider-nav-item-current{background:#ff7363;}
		
		
		
	</style>

	<script type="text/javascript">
	
		var count = 1;
		var clickTime = 0;
		var optStatus = "addCart";
		
		var cartData = {};
		
		var companyId = null;
		
			
		var mhUserVars = null;	
		$(document).ready(function(){ 
		 	
		 	mhUserVars=<%- JSON.stringify(mhUserVars) %>;
		 	
		 	loadData(mhUserVars.goodInfo);
		 	
 			//点击加入购物车和立即购买
 			//加入购物车
 			$("#addCart").on('click',function(){
 				openPropWin();
 			});
 			
 			// 立即购买
 			$("#buyNow").on('click',function(){
 				optStatus = "buyNow";
 				openPropWin();
 			});
 			
 			
 			//弹出框的确定按钮
 			$("#addShoppingCart").on('click',function(){
 				addShopCart();
 			});
 			
 			
 
 			$(".closeThis").on('click',function(){
 				$("#bg").css("display","none");
 				$("#selectProp").slideUp(1000);
 				$("body").css('overflow-y','auto');
 			});
 			
 			// tab 页切换
			$(".first").on('click',function(){ 
				goBaseInfo();
			});
			$(".second").on('click',function(){
				goDetail();
			});
			$(".third").on('click',function(){
				goScore();
			}); 
			
		});
		
		
		// 初始化页面信息
		function loadData(data){
		
			//全局存放companyId
			companyId = data.data[0].reserved7;
			
			$("#goodsTitle").html(data.data[0].reserved1); 
			$("#goodsSalePrice").html(data.data[0].reserved4);
			
			cartData.goodId = data.data[0].dataId; //保存商品Id;
			cartData.goodTitle = data.data[0].reserved1;
			
			var imgArr = data.data[0].reserved3.split(","); 
			
			loadPic(imgArr); //加载轮播图片
					
		}
		
		
		
		function loadPic(imgArr){
			var imgHtml = '';
			var tagHtml = '';
		
			for(var i = 0; i <imgArr.length; i++){
			   imgHtml += '	<div class="touchslider-item">'+
						  '		<a href="#"><img src="'+imgArr[i]+'" '+
						  '			style="vertical-align: top;height:250px;" />'+
						  '		</a>'+
						  '	</div>';
						  
				if(i == 0){
					tagHtml += '<span class="touchslider-nav-item touchslider-nav-item-current"></span>'
				}else{
					tagHtml += '<span class="touchslider-nav-item"></span>'
				}
			}
			
			$(".touchslider-viewport").html(imgHtml);					
			$(".touchslider-navtag").html(tagHtml);		
			
			
			// 初始化
			$(window).resize(function(){ 
				var width=$('#js-com-header-area').width();
				$('.touchslider-item a').css('width','100%');
				$('.touchslider-item a').css('height','200px;');
			}).resize();	
			$(".touchslider").touchSlider({mouseTouch: true, autoplay: true});
			
						
		}
		
		
		
		
		
		//弹出选择属性框和数量
		 function  openPropWin(v){
		 	if(!Z_IsEmpty20(v)){
		 		optStatus="select";
		 	}
		 	
		 	
		 	$("body").css("overflow-y","hidden");
		 	
		 	$("#bg").css("display","block");
		 	$("#selectProp").slideDown(1000);
		 	
		 	
		 	var data = mhUserVars.goodInfo;
			var propData = mhUserVars.goodInfo.propList;	
		 	
		 	
			var imgList = data.data[0].reserved3.split(",")[0];
			cartData.goodImg = imgList;  // 加入购物车--图片
			
			$("#showImg").attr("src",imgList);   // 图片
			$(".wid").html(data.data[0].reserved1); // 标题
			$(".goodsSalePrice").html(data.data[0].reserved4); // 价格
			$(".goodsCount").html("99");  // 数量 
			$(".goodsProp").html(""); //属性

			
			
			var str = "";		
			for(var j = 0 ; j < data.propList.length; j++ ){
				var propVal = data.propList[j].goodsProp  + "-" + 
							  data.propList[j].goodsPrice + "-" +
							  data.propList[j].goodsCount + "-" +
							  data.propList[j].id;
				
				//动态设置按钮宽度	
				var width = data.propList[j].goodsProp.length > 3 ? data.propList[j].goodsProp.length * 20 : 50;
				
				//如果已选，不为空，弹出框后默认选中上次选择的。
				if(!Z_IsEmpty20(cartData.propId) && cartData.propId == data.propList[j].id){
					str +="<button class='propBtn propCss propSelectCss' onclick='changeSelect(this,\""+propVal+"\");' style='width:"+ width +"px;' >"+data.propList[j].goodsProp+"</button>";
							changeSelect(null,propVal);
				}else{
					str +="<button class='propBtn propCss' onclick='changeSelect(this,\""+propVal+"\");' style='width:"+ width +"px;' >"+data.propList[j].goodsProp+"</button>";
				}
				
				
			}		
				
			$("#prop").html(str); // 属性下拉框
		 }
		 
		
		// 修改属性时触发。
		function changeSelect(_this,_prop){
				
			if(!Z_IsEmpty20(_this)){
				if($(".propCss").hasClass("propSelectCss")){
					$(".propCss").removeClass("propSelectCss");
				}
				$(_this).addClass("propSelectCss");  
			}	
			
			var arr = _prop.split("-");
			$(".goodsProp").html(arr[0]);
			$(".isSelect").html(arr[0]); // 页面 已选显示
			$(".goodsSalePrice").html(arr[1]);
			$(".goodsCount").html(arr[2]);
			
			cartData.propId = arr[3];
			
		}
		 
		//数量减
		function subtract() {
			if (parseInt($("#count").val()) == 1) {
				return;
			}
			$("#count").val(parseInt($("#count").val()) - 1);
		}
				
		//数量加
		function add() {
			$("#count").val(parseInt($("#count").val()) + 1);
		} 
			
		// tab页切换到商品基本信息页	
		function goBaseInfo(){
			$("#first").addClass("cur"); 
			$("#second").removeClass("cur"); 
			$("#third").removeClass("cur"); 
			$("#base").css("display","block");
			$("#detail").css("display","none");
			$("#peopleSay").css("display","none");
		}	
			
		// tab页切换到页面详情入口
		function goDetail(){
			$("#first").removeClass("cur"); 
			$(".second").addClass("cur"); 
			$("#third").removeClass("cur");  
			$("#base").css("display","none"); 
			$("#detail").css("display","block"); 
			$("#peopleSay").css("display","none");
			
			// 加载详情
			var data = mhUserVars.goodInfo;
			var descStr = "";
			if(!Z_IsEmpty20(data.data[0].reserved2)){
				descStr += data.data[0].reserved2;
			}
			
			var imgList = data.data[0].reserved3.split(","); 			
			
			// 创建图片详情		
			for(var i = 0; i <imgList.length; i++){
				descStr += "<img src="+imgList[i]+" width='100%' height='100%' />";
			}
			
			$("#detail").html(descStr);
		}		
			
		// tab页切换到页面评价入口
		function goScore(){
			//clickTime++; // 点击次数，
			$("#first").removeClass("cur");  
			$("#second").removeClass("cur");  
			$("#third").addClass("cur");   
			$("#base").css("display","none");  
			$("#detail").css("display","none");  
			$("#peopleSay").css("display","block");
		}	
	
		
	
		//加入购物车；
		function addShopCart(){
			
			// 1. 验证库库存
			var reCount = $(".goodsCount").html(); 
			var count = $("#count").val(); //买家选择的数量
			
			/* 后台验证库存
			ajaxFunction(MH_PATH+"",params, true, function(data){
						 
			});*/
			
			// 2. 表数据对象
			cartData.goodCount  = count ; //购买数量
			cartData.companyId = companyId; 
			
			
			if(optStatus == "select"){
				$("#bg").css("display","none");
				$("#selectProp").slideUp(1000); 
				$("body").css('overflow-x','hidden'); 
				return;
			}
			
			// 如果买家选择的数量小于 商品剩余数量
			if(parseInt(reCount) < parseInt(count)){
				alert("库存不足,详情请咨询客服人员");
				//openB3AjaxAlertDialog("库存不足,详情请咨询客服人员","提示", true); 
				return;
			}
			
			//验证是否选择属性。
			if(Z_IsEmpty20(cartData.propId)){
				alert("请选择您要购买的产品规格");
				//openB3AjaxAlertDialog("请选择您要购买的产品规格","提示", true); 
				return;
			}
			
			/*console.log(cartData);*/
			/*return;*/
			
			var url = "/ZingMH/ZDesk/Shopping/shoppingCart/joinCart.action";
			ajaxFunction(url, cartData, true, function(data){
				if(data.retcode == 0){
					$("#bg").css("display","none");
					$("#selectProp").slideUp(1000); 
					$("body").css('overflow-x','hidden'); 
					
					//如果是立即购买则跳转确认订单界面
					if(optStatus == "buyNow"){
						window.location.href="/SRender?jsLoader=shopping%2FshoppingCartLoader&tpl=shopping%2FshoppingCart";
					}
				}else if(data.retcode == -2){
					alert("库存不足，请联系客服。"); 
				}else{
					alert("加入购物车失败"); 
				}
			});
	}

	</script>
 
	</head>
	<body style="overflow-x: hidden;">
		<div id="top">
			<a id="hd_back"  href="javascript:void(0);"  onclick="javascript:history.go(-1);"></a>
			<span  style="padding-left:18px;margin-top: -10px;position: absolute;color:#afafae;"
				onclick="javascript:history.go(-1);"></span>
		</div>
		
		<div class="wrap">
			<ul class="tabV2 clearfix" style="border-bottom:1px solid #DDDDDD;">
				<li id="first" class="cur first cur2">
					<a href="javascript:void(0);" >基本信息</a>
				</li>
				<li id="second" class="second cur2">
					<a href="javascript:void(0);" >商品详情</a>
				</li>
				<li id="third" class="third cur2">
					<a href="javascript:void(0);" >评价</a>
				</li>
			</ul>
		</div>
		
		<div style="padding-bottom:45px;">
		<div id="base">
			<div class="touchslider" style="margin:0 0;">
					<div class="touchslider-viewport">
					</div>
					<div class="touchslider-navtag">
					</div>
				</div>

			<!-- 商品基本信息 -->
			<div class=".container">
				<ul class="list-group">
					<!--  标题 栏 -->
					<li class="list-group-item">
						<div class="row">
						  <div class="col-xs-10 col-md-10" style="color:#666;">
						  		<span id="goodsTitle" class=" font-size-Style"></span>
						  		<!-- <span class="pull-right" style="color:#ddd;">|</span> -->
						  </div>
						  <div class="col-xs-2 col-md-2 text-center"> <!--  style="line-height:2;" -->
						  		<i class="fa fa-share-alt fa-lg"></i>
						  </div>
						</div>
					</li>
					<!--  -->
					<li class="list-group-item">
						<div class="row">
							<div class="col-xs-12 col-md-12">
							   <p  class="font-size-Style" style="color:#fff;">
								 <span style="color:red;">&yen;</span>
								 <span id="goodsSalePrice" style="color:red; font-size:18px;"></span>
							   </p>
							</div>
						</div>
					</li>
					<!-- 
					<li class="list-group-item">
						<label class="inline">
							<span class="lbl">参数</span>
						</label>
						<span class="pull-right"><i class="glyphicon glyphicon-chevron-right"></i></span>
					</li> -->
					<li class="list-group-item" onclick="openPropWin(0);">
						<label class="inline">
							<span class="lbl font-size-Style">已选:&nbsp;<span class="isSelect"></span></span>
						</label>
						<span class="pull-right"><i class="glyphicon glyphicon-chevron-right"></i></span>
					</li>
					
					
					<li class="list-group-item second" style="margin-top: 40px;" >
						<label class="inline">
							<span class="lbl font-size-Style">详情</span>
						</label>
						<span class="pull-right"><i class="glyphicon glyphicon-chevron-right"></i></span>
					</li>
					<li class="list-group-item third">
						<label class="inline">
							<span class="lbl font-size-Style">评价</span>
						</label>
						<span class="pull-right"><i class="glyphicon glyphicon-chevron-right"></i></span>
					</li>
				</ul>
			</div>
		
		</div>	
		<!-- 商品基本信息  end -->
		
		<!-- 详情页面 -->
		<div id="detail" style="display:none; width:99%;" ></div>
		
		<!-- 评价 -->
		<div id="peopleSay" style="display:none;margin:0 5;overflow-x:hidden;" >
			<div class="commt clearfix">
		        <!--评价百分比和背景图片高度的计算：90%的好评率=0.9*50px=45px, 91%的好评率是0.91*50px=45.5px，依此类推-->
		        <div class="commtSpanOut">
		            <span class="commtSum">66%<br>全部</span>
		        </div>
		        <div class="commtSpanOut goodCmmt">
		            <span class="commtScore goodCommtScore"><em></em><i style="height:33px;"></i></span>
		        </div>
		        <div class="commtSpanOut mediumCmmt">
		            <span class="commtScore centerCommtScore"><em></em><i style="height:33px;"></i></span>
		        </div>
		        <div class="commtSpanOut badCmmt">
		            <span class="commtScore badCommtScore"><em></em><i style="height:16px;"></i></span>
		        </div>
		
		        <ul class="commtNum clearfix">
		            <li class="allPJ">全部<br>(3)</li>
		            <li class="goodPJ">好评<br>(2)</li>
		            <li class="centerPJ">中评<br>(2)</li>
		            <li class="badPJ">差评<br>(1)</li>
		        </ul>
		    </div>	
		</div>
	</div>
		
		
		<div style="position: fixed;bottom:0px;display:inline;width:100%;">
			<div id="addCart" style="float:left;height:40px;width:48%;background:#FFAA33;text-align:center;">
				<p style="padding-top:10px;color:white;">加入购物车</p>
			</div>
			<div id="buyNow" style="height:40px;widht:48%;background:red;text-align:center;">
				<p style="padding-top:10px;color:white;">立即购买</p>
			</div>
		</div>
		
		<!-- 弹出选择框 遮罩 -->
		<div id="bg"></div>
		
		<div id="selectProp">
			<div class="container">
				<!--  图片、已选属性、价格、 关闭按钮 -->
				<div class="row">
					<div class="col-xs-4 col-md-4">
						<div class="showImg">
							<img  id="showImg" style="width:80px;height:80px;" />
						</div>
					</div>
					<div class="col-xs-6 col-md-6" style="top: 8px;">
						<p style="color:#fff;">
							<span style="color:red;">¥</span>
							<span class="goodsSalePrice" style="color:red; font-size:18px;"></span>
						</p>
						<p style="color:black;">库存<span class="goodsCount"></span>件</p>
						<p style="color:black;">已选:<span class="goodsProp"></span></p>
					</div>
					<div class="col-xs-2 col-md-2" style="top: 8px;">
						<span class="pull-right closeThis" style="color:black;">
							<i class="fa fa-times fa-lg"></i>
						</span>
					</div>
					
					<!--  分割线 -->
					<div style="padding-top:80px;"></div>
					<div class='zdy-line' style='border-top: 1px solid black;opacity: 0.2;width:90%; margin:0px auto;'></div>
				</div>
				<!-- end -->
				
				
				<!-- 选择属性  和 数量--> 
				<div class="row"  style="height:180px;overflow-x:hidden;">
					<div class="col-xs-12 col-md-12">
						<p style="margin-top: 10px;">规格:</p>
						<div id="prop"  style="margin-top: 8px;"></div>
						<div class='zdy-line' style='border-top: 1px solid black;opacity: 0.2;width:98%; margin:5px auto;'></div>
					</div>
					<div class="col-xs-12 col-md-12" style=" margin: 10px 10px 20px 0;">
						<span class="pull-left" style="line-height: 2;">购买数量:</span>
						<span  class="pull-right">
					         <input type="button" value="一" style="width:35px;height:30px;border-radius:0px;" onclick="subtract();"/>
					         <input type="text" value=1 id="count" style="height:30px;width:50px;text-align:center;" onkeyup="javascript:this.value=this.value.replace(/[^\d]/g,'');" />
					         <input type="button" value="十" style="width:35px;height:30px; border-radius:0px;" onclick="add();"/>
						</span>
					</div>
				</div>
				<!-- 数量 end-->
			</div>
			
			<!--  确定按钮 -->
			<div id="addShoppingCart" style="height:40px;widht:48%;background:red;text-align:center;">
				<p style="padding-top:10px;color:white;">确定</p>
			</div>	
		</div>
	</body>
	</html>